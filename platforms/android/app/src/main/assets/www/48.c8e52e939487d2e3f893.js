(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{bxKJ:function(n,e,t){"use strict";t.r(e),t.d(e,"AddonMessagesContacts35PageModule",(function(){return I}));var s=t("tyNb"),o=t("vY5A"),a=t("muSn"),i=t("Y+03"),c=t("L3Fv"),r=t("PM4H"),g=t("mrSG"),d=t("9+EE"),l=t("KMk0"),_=t("3LXp"),m=t("nvXB"),h=t("fjkH"),M=t("j3ag"),C=t("pHTc"),P=t("46ml"),u=t("fXoL"),O=t("TEn/"),f=t("fQ68"),p=t("nt/U"),b=t("9zps"),v=t("PgjG"),x=t("ofXK"),y=t("r8G5"),w=t("FeAf"),A=t("sYmb");function AddonMessagesContacts35Page_core_empty_box_19_Template(n,e){1&n&&(u.zc(0,"core-empty-box",9),u.Pc(1,"translate")),2&n&&u.Vc("message",u.Qc(1,1,"addon.messages.contactlistempty"))}function AddonMessagesContacts35Page_core_empty_box_20_Template(n,e){1&n&&(u.zc(0,"core-empty-box",9),u.Pc(1,"translate")),2&n&&u.Vc("message",u.Qc(1,1,"addon.messages.nousersfound"))}function AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_ion_item_1_Template(n,e){if(1&n){const n=u.Fc();u.Ec(0,"ion-item",16),u.Mc("click",(function AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_ion_item_1_Template_ion_item_click_0_listener(){u.fd(n);const e=u.Oc().$implicit;return u.Oc(3).gotoDiscussion(e.id)})),u.zc(1,"core-user-avatar",17),u.Ec(2,"ion-label"),u.Ec(3,"p",12),u.pd(4),u.Dc(),u.Dc(),u.Dc()}if(2&n){const n=u.Oc().$implicit,e=u.Oc(3);u.mc("aria-label",n.fullname)("aria-current",n.id==e.discussionUserId?"page":"false"),u.lc(1),u.Vc("user",n)("checkOnline",n.showonlinestatus),u.lc(3),u.qd(n.fullname)}}function AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_Template(n,e){if(1&n&&(u.Cc(0),u.nd(1,AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_ion_item_1_Template,5,5,"ion-item",15),u.Bc()),2&n){const n=e.$implicit;u.lc(1),u.Vc("ngIf",n.profileimageurl||n.profileimageurlsmall)}}function AddonMessagesContacts35Page_ion_list_21_ng_container_1_Template(n,e){if(1&n&&(u.Cc(0),u.Ec(1,"ion-item-divider"),u.Ec(2,"ion-label"),u.Ec(3,"p",12),u.pd(4),u.Pc(5,"translate"),u.Dc(),u.Dc(),u.Ec(6,"ion-note",13),u.Ec(7,"ion-badge"),u.pd(8),u.Dc(),u.Dc(),u.Dc(),u.nd(9,AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_Template,2,1,"ng-container",14),u.Bc()),2&n){const n=u.Oc().$implicit,e=u.Oc();u.lc(4),u.qd(u.Qc(5,3,"addon.messages.type_"+n)),u.lc(4),u.qd(e.contacts[n].length),u.lc(1),u.Vc("ngForOf",e.contacts[n])}}function AddonMessagesContacts35Page_ion_list_21_Template(n,e){if(1&n&&(u.Ec(0,"ion-list",10),u.nd(1,AddonMessagesContacts35Page_ion_list_21_ng_container_1_Template,10,5,"ng-container",11),u.Dc()),2&n){const n=e.$implicit,t=u.Oc();u.lc(1),u.Vc("ngIf",t.contacts[n]&&(t.contacts[n].length>0||n===t.searchType))}}let D=(()=>{class AddonMessagesContacts35Page{constructor(n){this.route=n,this.noSearchTypes=["online","offline","blocked","strangers"],this.loaded=!1,this.contactTypes=["online","offline","blocked","strangers"],this.searchType="search",this.loadingMessage="",this.hasContacts=!1,this.contacts={online:[],offline:[],strangers:[],search:[]},this.searchString="",this.siteId=d.b.getCurrentSiteId(),this.searchingMessages=M.I.instant("core.searching"),this.loadingMessages=M.I.instant("core.loading"),this.loadingMessage=this.loadingMessages,this.memberInfoObserver=h.b.on(l.b.MEMBER_INFO_CHANGED_EVENT,(n=>{n.contactRequestConfirmed&&this.refreshData()}),d.b.getCurrentSiteId())}ngOnInit(){return Object(g.a)(this,void 0,void 0,(function*(){const n=C.a.getRouteNumberParam("discussionUserId")||C.a.getRouteNumberParam("userId")||void 0;if(!this.loaded||this.discussionUserId!=n){this.discussionUserId=n,this.discussionUserId&&this.gotoDiscussion(this.discussionUserId);try{if(yield this.fetchData(),!this.discussionUserId&&this.hasContacts&&i.a.isTablet){let n;for(const e in this.contacts)if(this.contacts[e].length>0){n=this.contacts[e][0];break}n&&this.gotoDiscussion(n.id)}}finally{this.loaded=!0}}}))}refreshData(n){return Object(g.a)(this,void 0,void 0,(function*(){try{this.searchString?yield this.performSearch(this.searchString):(yield l.a.invalidateAllContactsCache(),yield this.fetchData())}finally{null==n?void 0:n.complete()}}))}fetchData(){return Object(g.a)(this,void 0,void 0,(function*(){this.loadingMessage=this.loadingMessages;try{const n=yield l.a.getAllContacts();for(const e in n)this.contacts[e]=n[e].length>0?this.sortUsers(n[e]):[];this.clearSearch()}catch(n){_.a.showErrorModalDefault(n,"addon.messages.errorwhileretrievingcontacts",!0)}}))}sortUsers(n){return n.sort(((n,e)=>{const t=n.fullname.toLowerCase(),s=e.fullname.toLowerCase();return t.localeCompare(s)}))}clearSearch(){this.searchString="",this.contactTypes=this.noSearchTypes,this.hasContacts=!1;for(const n in this.contacts)if(this.contacts[n].length>0)return this.hasContacts=!0,void 0}search(n){return m.a.closeKeyboard(),this.loaded=!1,this.loadingMessage=this.searchingMessages,this.performSearch(n).finally((()=>{this.loaded=!0}))}performSearch(n){return Object(g.a)(this,void 0,void 0,(function*(){try{const e=yield l.a.searchContacts(n);this.hasContacts=e.length>0,this.searchString=n,this.contactTypes=["search"],this.contacts.search=this.sortUsers(e)}catch(n){_.a.showErrorModalDefault(n,"addon.messages.errorwhileretrievingcontacts",!0)}}))}gotoDiscussion(n){this.discussionUserId=n;const e=C.a.getRelativePathToParent("/messages/contacts-35")+`discussion/user/${n}`;C.a.navigate(e,{reset:i.a.isTablet&&!!this.splitView&&!this.splitView.isNested})}ngOnDestroy(){var n;null===(n=this.memberInfoObserver)||void 0===n?void 0:n.off()}}return AddonMessagesContacts35Page.ɵfac=function AddonMessagesContacts35Page_Factory(n){return new(n||AddonMessagesContacts35Page)(u.yc(s.a))},AddonMessagesContacts35Page.ɵcmp=u.sc({type:AddonMessagesContacts35Page,selectors:[["addon-messages-contacts"]],viewQuery:function AddonMessagesContacts35Page_Query(n,e){var t;(1&n&&u.ud(P.a,!0),2&n)&&(u.dd(t=u.Nc())&&(e.splitView=t.first))},decls:22,vars:19,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["autocorrect","off","spellcheck","false","lengthCheck","2","searchArea","AddonMessagesContacts",3,"placeholder","disabled","onSubmit","onClear"],[3,"hideUntil","message"],["icon","fas-address-book",3,"message",4,"ngIf"],["class","ion-no-margin",4,"ngFor","ngForOf"],["icon","fas-address-book",3,"message"],[1,"ion-no-margin"],[4,"ngIf"],[1,"item-heading"],["slot","end",1,"ion-padding-end"],[4,"ngFor","ngForOf"],["class","ion-text-wrap addon-messages-conversation-item","detail","true","button","",3,"click",4,"ngIf"],["detail","true","button","",1,"ion-text-wrap","addon-messages-conversation-item",3,"click"],["slot","start",3,"user","checkOnline"]],template:function AddonMessagesContacts35Page_Template(n,e){1&n&&(u.Ec(0,"ion-header"),u.Ec(1,"ion-toolbar"),u.Ec(2,"ion-buttons",0),u.zc(3,"ion-back-button",1),u.Pc(4,"translate"),u.Dc(),u.Ec(5,"ion-title"),u.Ec(6,"h1"),u.pd(7),u.Pc(8,"translate"),u.Dc(),u.Dc(),u.Ec(9,"ion-buttons",2),u.zc(10,"core-context-menu"),u.Dc(),u.Dc(),u.Dc(),u.Ec(11,"ion-content"),u.Ec(12,"core-split-view"),u.Ec(13,"ion-refresher",3),u.Mc("ionRefresh",(function AddonMessagesContacts35Page_Template_ion_refresher_ionRefresh_13_listener(n){return e.refreshData(n.target)})),u.zc(14,"ion-refresher-content",4),u.Pc(15,"translate"),u.Dc(),u.Ec(16,"core-search-box",5),u.Mc("onSubmit",(function AddonMessagesContacts35Page_Template_core_search_box_onSubmit_16_listener(n){return e.search(n)}))("onClear",(function AddonMessagesContacts35Page_Template_core_search_box_onClear_16_listener(){return e.clearSearch()})),u.Pc(17,"translate"),u.Dc(),u.Ec(18,"core-loading",6),u.nd(19,AddonMessagesContacts35Page_core_empty_box_19_Template,2,3,"core-empty-box",7),u.nd(20,AddonMessagesContacts35Page_core_empty_box_20_Template,2,3,"core-empty-box",7),u.nd(21,AddonMessagesContacts35Page_ion_list_21_Template,2,1,"ion-list",8),u.Dc(),u.Dc(),u.Dc()),2&n&&(u.lc(3),u.Vc("text",u.Qc(4,11,"core.back")),u.lc(4),u.qd(u.Qc(8,13,"addon.messages.contacts")),u.lc(6),u.Vc("disabled",!e.loaded),u.lc(1),u.Wc("pullingText",u.Qc(15,15,"core.pulltorefresh")),u.lc(2),u.Vc("placeholder",u.Qc(17,17,"addon.messages.contactname"))("disabled",!e.loaded),u.lc(2),u.Vc("hideUntil",e.loaded)("message",e.loadingMessage),u.lc(1),u.Vc("ngIf",!e.hasContacts&&""==e.searchString),u.lc(1),u.Vc("ngIf",!e.hasContacts&&""!=e.searchString),u.lc(1),u.Vc("ngForOf",e.contactTypes))},directives:[O.C,O.Ab,O.m,O.h,O.i,O.yb,f.a,p.a,O.v,P.a,O.bb,O.cb,b.a,v.a,x.t,x.s,y.a,O.P,O.J,O.O,O.W,O.k,O.I,w.a],pipes:[A.d],styles:["[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-right:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:2px;margin-inline-end:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesContacts35Page})();const T=[{path:"",component:D},...a.DISCUSSION_ROUTES],E=[{path:"",component:D,children:a.DISCUSSION_ROUTES}],k=[...Object(o.c)(T,(()=>i.a.isMobile)),...Object(o.c)(E,(()=>i.a.isTablet))];let I=(()=>{class AddonMessagesContacts35PageModule{}return AddonMessagesContacts35PageModule.ɵmod=u.wc({type:AddonMessagesContacts35PageModule}),AddonMessagesContacts35PageModule.ɵinj=u.vc({factory:function AddonMessagesContacts35PageModule_Factory(n){return new(n||AddonMessagesContacts35PageModule)},imports:[[s.m.forChild(k),c.a,r.a],s.m]}),AddonMessagesContacts35PageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&u.kd(I,{declarations:[D],imports:[s.m,c.a,r.a],exports:[s.m]}))}}]);