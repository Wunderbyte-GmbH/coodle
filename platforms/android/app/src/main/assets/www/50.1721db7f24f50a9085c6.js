(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{fArg:function(s,e,n){"use strict";n.r(e),n.d(e,"AddonMessagesDiscussions35PageModule",(function(){return G}));var t=n("tyNb"),o=n("Y+03"),i=n("vY5A"),a=n("muSn"),c=n("L3Fv"),d=n("PM4H"),r=n("mrSG"),g=n("fjkH"),l=n("9+EE"),_=n("KMk0"),u=n("3LXp"),m=n("bFG1"),h=n("nvXB"),M=n("2eZG"),P=n("j3ag"),p=n("pHTc"),f=n("YyYz"),O=n("r2Z7"),C=n("46ml"),b=n("fXoL"),D=n("TEn/"),v=n("fQ68"),x=n("C1x5"),A=n("nt/U"),I=n("9zps"),w=n("PgjG"),E=n("3CSS"),y=n("ofXK"),T=n("FeAf"),k=n("hMzs"),V=n("r8G5"),S=n("sYmb"),R=n("Cg42");function AddonMessagesDiscussions35Page_ng_container_28_ion_item_9_Template(s,e){if(1&s){const s=b.Fc();b.Ec(0,"ion-item",16),b.Mc("click",(function AddonMessagesDiscussions35Page_ng_container_28_ion_item_9_Template_ion_item_click_0_listener(){b.fd(s);const n=e.$implicit;return b.Oc(2).gotoDiscussion(n.userid,n.messageid)})),b.zc(1,"core-user-avatar",17),b.Ec(2,"ion-label"),b.Ec(3,"p",10),b.pd(4),b.Dc(),b.Ec(5,"p"),b.zc(6,"core-format-text",18),b.Dc(),b.Dc(),b.Dc()}if(2&s){const s=e.$implicit,n=b.Oc(2);b.mc("aria-label",s.fullname)("aria-current",s.userid==n.discussionUserId?"page":"false"),b.lc(1),b.Vc("user",s)("checkOnline",s.showonlinestatus),b.lc(3),b.qd(s.fullname),b.lc(2),b.Vc("text",s.lastmessage)("contextInstanceId",0)}}function AddonMessagesDiscussions35Page_ng_container_28_Template(s,e){if(1&s&&(b.Cc(0),b.Ec(1,"ion-item-divider"),b.Ec(2,"ion-label"),b.Ec(3,"h2"),b.pd(4),b.Pc(5,"translate"),b.Dc(),b.Dc(),b.Ec(6,"ion-note",14),b.Ec(7,"ion-badge"),b.pd(8),b.Dc(),b.Dc(),b.Dc(),b.nd(9,AddonMessagesDiscussions35Page_ng_container_28_ion_item_9_Template,7,7,"ion-item",15),b.Bc()),2&s){const s=b.Oc();b.lc(4),b.qd(b.Qc(5,3,"core.searchresults")),b.lc(4),b.qd(s.search.results.length),b.lc(1),b.Vc("ngForOf",s.search.results)}}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_1_Template(s,e){if(1&s&&(b.Ec(0,"span",24),b.pd(1),b.Pc(2,"coreDateDayOrTime"),b.Dc()),2&s){const s=b.Oc(2).$implicit;b.lc(1),b.rd(" ",b.Qc(2,1,s.message.timecreated/1e3)," ")}}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_ion_icon_2_Template(s,e){1&s&&b.zc(0,"ion-icon",25)}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_3_Template(s,e){1&s&&(b.Ec(0,"span",26),b.pd(1),b.Pc(2,"translate"),b.Dc()),2&s&&(b.lc(1),b.rd(" ",b.Qc(2,1,"addon.messages.unreadmessages")," "))}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_Template(s,e){if(1&s&&(b.Ec(0,"ion-note"),b.nd(1,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_1_Template,3,3,"span",21),b.nd(2,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_ion_icon_2_Template,1,0,"ion-icon",22),b.nd(3,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_3_Template,3,3,"span",23),b.Dc()),2&s){const s=b.Oc().$implicit;b.lc(1),b.Vc("ngIf",s.message.timecreated>0),b.lc(1),b.Vc("ngIf",s.unread),b.lc(1),b.Vc("ngIf",s.unread)}}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_Template(s,e){if(1&s){const s=b.Fc();b.Ec(0,"ion-item",16),b.Mc("click",(function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_Template_ion_item_click_0_listener(){b.fd(s);const n=e.$implicit;return b.Oc(2).gotoDiscussion(n.message.user)})),b.zc(1,"core-user-avatar",19),b.Ec(2,"ion-label"),b.Ec(3,"div",20),b.Ec(4,"p",10),b.pd(5),b.Dc(),b.nd(6,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_Template,4,3,"ion-note",11),b.Dc(),b.Ec(7,"p"),b.zc(8,"core-format-text",18),b.Dc(),b.Dc(),b.Dc()}if(2&s){const s=e.$implicit,n=b.Oc(2);b.mc("aria-label",s.fullname)("aria-current",s.message.user==n.discussionUserId?"page":"false"),b.lc(1),b.Vc("user",s),b.lc(4),b.qd(s.fullname),b.lc(1),b.Vc("ngIf",s.message.timecreated>0||s.unread),b.lc(2),b.Vc("text",s.message.message)("contextInstanceId",0)}}function AddonMessagesDiscussions35Page_ng_container_29_Template(s,e){if(1&s&&(b.Cc(0),b.nd(1,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_Template,9,7,"ion-item",15),b.Bc()),2&s){const s=b.Oc();b.lc(1),b.Vc("ngForOf",s.discussions)}}function AddonMessagesDiscussions35Page_core_empty_box_30_Template(s,e){1&s&&(b.zc(0,"core-empty-box",27),b.Pc(1,"translate")),2&s&&b.Vc("message",b.Qc(1,1,"addon.messages.nomessagesfound"))}function AddonMessagesDiscussions35Page_core_empty_box_31_Template(s,e){1&s&&(b.zc(0,"core-empty-box",28),b.Pc(1,"translate")),2&s&&b.Vc("message",b.Qc(1,1,"core.noresults"))}let U=(()=>{class AddonMessagesDiscussions35Page{constructor(s){this.route=s,this.loaded=!1,this.loadingMessage="",this.discussions=[],this.search={showResults:!1,results:[],loading:"",text:""},this.search.loading=P.I.instant("core.searching"),this.loadingMessages=P.I.instant("core.loading"),this.siteId=l.b.getCurrentSiteId(),this.newMessagesObserver=g.b.on(_.b.NEW_MESSAGE_EVENT,(s=>{if(s.userId&&this.discussions){const e=this.discussions.find((e=>e.message.user==s.userId));void 0===e?(this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0}))):(e.message.message=s.message,e.message.timecreated=s.timecreated)}}),this.siteId),this.readChangedObserver=g.b.on(_.b.READ_CHANGED_EVENT,(s=>{if(s.userId&&this.discussions){const e=this.discussions.find((e=>e.message.user==s.userId));void 0!==e&&(e.unread=!1,_.a.invalidateConversations(this.siteId),_.a.refreshUnreadConversationCounts(this.siteId))}}),this.siteId),this.appResumeSubscription=O.a.resume.subscribe((()=>{this.loaded&&(this.loaded=!1,this.refreshData())})),this.pushObserver=M.a.on("receive").subscribe((s=>{m.a.isFalseOrZero(s.notif)&&s.site==this.siteId&&this.refreshData(void 0,!1)}))}ngOnInit(){return Object(r.a)(this,void 0,void 0,(function*(){this.route.queryParams.subscribe((s=>Object(r.a)(this,void 0,void 0,(function*(){var e;this.discussionUserId=null!==(e=p.a.getRouteNumberParam("userId",{params:s}))&&void 0!==e?e:this.discussionUserId}))));const s=new f.a;yield this.fetchData(),!this.discussionUserId&&this.discussions.length>0&&o.a.isTablet&&(yield this.gotoDiscussion(this.discussions[0].message.user)),s.treatLink()}))}refreshData(s,e=!0){return Object(r.a)(this,void 0,void 0,(function*(){const n=[];n.push(_.a.invalidateDiscussionsCache(this.siteId)),e&&n.push(_.a.invalidateUnreadConversationCounts(this.siteId)),yield m.a.allPromises(n).finally((()=>this.fetchData().finally((()=>{s&&(null==s?void 0:s.complete())}))))}))}fetchData(){return Object(r.a)(this,void 0,void 0,(function*(){this.loadingMessage=this.loadingMessages;const s=[];s.push(_.a.getDiscussions(this.siteId).then((s=>{const e=[];for(const n in s)s[n].unread=!!s[n].unread,e.push(s[n]);this.discussions=e.sort(((s,e)=>{var n,t;return((null===(n=e.message)||void 0===n?void 0:n.timecreated)||0)-((null===(t=s.message)||void 0===t?void 0:t.timecreated)||0)}))}))),s.push(_.a.getUnreadConversationCounts(this.siteId));try{yield Promise.all(s)}catch(s){u.a.showErrorModalDefault(s,"addon.messages.errorwhileretrievingdiscussions",!0)}this.loaded=!0}))}clearSearch(){this.loaded=!1,this.search.showResults=!1,this.search.text="",this.fetchData().finally((()=>{this.loaded=!0}))}searchMessage(s){return Object(r.a)(this,void 0,void 0,(function*(){h.a.closeKeyboard(),this.loaded=!1,this.loadingMessage=this.search.loading;try{const e=yield _.a.searchMessages(s,void 0,void 0,void 0,this.siteId);this.search.showResults=!0,this.search.results=e.messages}catch(s){u.a.showErrorModalDefault(s,"addon.messages.errorwhileretrievingmessages",!0)}this.loaded=!0}))}gotoDiscussion(s,e){return Object(r.a)(this,void 0,void 0,(function*(){this.discussionUserId=s;const n={};e&&(n.message=e);const t=p.a.getRelativePathToParent("/messages/index")+`discussion/user/${s}`;yield p.a.navigate(t,{params:n,reset:o.a.isTablet&&!!this.splitView&&!this.splitView.isNested})}))}gotoContacts(){const s={};o.a.isTablet&&this.discussionUserId&&(s.discussionUserId=this.discussionUserId),p.a.navigateToSitePath("contacts-35",{params:s})}ngOnDestroy(){var s,e,n,t;null===(s=this.newMessagesObserver)||void 0===s?void 0:s.off(),null===(e=this.readChangedObserver)||void 0===e||e.off(),null===(n=this.appResumeSubscription)||void 0===n||n.unsubscribe(),null===(t=this.pushObserver)||void 0===t||t.unsubscribe()}}return AddonMessagesDiscussions35Page.ɵfac=function AddonMessagesDiscussions35Page_Factory(s){return new(s||AddonMessagesDiscussions35Page)(b.yc(t.a))},AddonMessagesDiscussions35Page.ɵcmp=b.sc({type:AddonMessagesDiscussions35Page,selectors:[["addon-messages-discussions"]],viewQuery:function AddonMessagesDiscussions35Page_Query(s,e){var n;(1&s&&b.ud(C.a,!0),2&s)&&(b.dd(n=b.Nc())&&(e.splitView=n.first))},decls:32,vars:27,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["autocorrect","off","spellcheck","false","lengthCheck","2","searchArea","AddonMessagesDiscussions",3,"placeholder","disabled","autoFocus","onSubmit","onClear"],[3,"hideUntil","message"],[1,"ion-no-margin"],["detail","true","button","",1,"ion-text-wrap","addon-message-discussion",3,"click"],["name","fas-address-book","slot","start","aria-hidden","true"],[1,"item-heading"],[4,"ngIf"],["icon","far-comments",3,"message",4,"ngIf"],["icon","fas-search",3,"message",4,"ngIf"],["slot","end",1,"ion-padding-end"],["class","ion-text-wrap addon-message-discussion","button","","detail","false",3,"click",4,"ngFor","ngForOf"],["button","","detail","false",1,"ion-text-wrap","addon-message-discussion",3,"click"],["slot","start",3,"user","checkOnline"],["clean","true","singleLine","true","contextLevel","system",3,"text","contextInstanceId"],["slot","start","checkOnline","false",3,"user"],[1,"flex-row","ion-justify-content-between"],["class","addon-message-last-message-date",4,"ngIf"],["name","fas-circle","color","primary","aria-hidden","true",4,"ngIf"],["class","sr-only",4,"ngIf"],[1,"addon-message-last-message-date"],["name","fas-circle","color","primary","aria-hidden","true"],[1,"sr-only"],["icon","far-comments",3,"message"],["icon","fas-search",3,"message"]],template:function AddonMessagesDiscussions35Page_Template(s,e){1&s&&(b.Ec(0,"ion-header"),b.Ec(1,"ion-toolbar"),b.Ec(2,"ion-buttons",0),b.zc(3,"ion-back-button",1),b.Pc(4,"translate"),b.Dc(),b.Ec(5,"ion-title"),b.Ec(6,"h1"),b.pd(7),b.Pc(8,"translate"),b.Dc(),b.Dc(),b.Ec(9,"ion-buttons",2),b.zc(10,"core-context-menu"),b.zc(11,"core-user-menu-button"),b.Dc(),b.Dc(),b.Dc(),b.Ec(12,"ion-content"),b.Ec(13,"core-split-view"),b.Ec(14,"ion-refresher",3),b.Mc("ionRefresh",(function AddonMessagesDiscussions35Page_Template_ion_refresher_ionRefresh_14_listener(s){return e.refreshData(s.target)})),b.zc(15,"ion-refresher-content",4),b.Pc(16,"translate"),b.Dc(),b.Ec(17,"core-search-box",5),b.Mc("onSubmit",(function AddonMessagesDiscussions35Page_Template_core_search_box_onSubmit_17_listener(s){return e.searchMessage(s)}))("onClear",(function AddonMessagesDiscussions35Page_Template_core_search_box_onClear_17_listener(){return e.clearSearch()})),b.Pc(18,"translate"),b.Dc(),b.Ec(19,"core-loading",6),b.Ec(20,"ion-list",7),b.Ec(21,"ion-item",8),b.Mc("click",(function AddonMessagesDiscussions35Page_Template_ion_item_click_21_listener(){return e.gotoContacts()})),b.Pc(22,"translate"),b.zc(23,"ion-icon",9),b.Ec(24,"ion-label"),b.Ec(25,"p",10),b.pd(26),b.Pc(27,"translate"),b.Dc(),b.Dc(),b.Dc(),b.nd(28,AddonMessagesDiscussions35Page_ng_container_28_Template,10,5,"ng-container",11),b.nd(29,AddonMessagesDiscussions35Page_ng_container_29_Template,2,1,"ng-container",11),b.Dc(),b.nd(30,AddonMessagesDiscussions35Page_core_empty_box_30_Template,2,3,"core-empty-box",12),b.nd(31,AddonMessagesDiscussions35Page_core_empty_box_31_Template,2,3,"core-empty-box",13),b.Dc(),b.Dc(),b.Dc()),2&s&&(b.lc(3),b.Vc("text",b.Qc(4,15,"core.back")),b.lc(4),b.qd(b.Qc(8,17,"addon.messages.messages")),b.lc(7),b.Vc("disabled",!e.loaded),b.lc(1),b.Wc("pullingText",b.Qc(16,19,"core.pulltorefresh")),b.lc(2),b.Vc("placeholder",b.Qc(18,21,"addon.messages.message"))("disabled",!e.loaded)("autoFocus",!1),b.lc(2),b.Vc("hideUntil",e.loaded)("message",e.loadingMessage),b.lc(2),b.mc("aria-label",b.Qc(22,23,"addon.messages.contacts")),b.lc(5),b.qd(b.Qc(27,25,"addon.messages.contacts")),b.lc(2),b.Vc("ngIf",e.search.showResults),b.lc(1),b.Vc("ngIf",!e.search.showResults),b.lc(1),b.Vc("ngIf",(!e.discussions||e.discussions.length<=0)&&!e.search.showResults),b.lc(1),b.Vc("ngIf",(!e.search.results||e.search.results.length<=0)&&e.search.showResults))},directives:[D.C,D.Ab,D.m,D.h,D.i,D.yb,v.a,x.a,A.a,D.v,C.a,D.bb,D.cb,I.a,w.a,D.P,D.I,D.D,E.a,D.O,y.t,D.J,D.W,D.k,y.s,T.a,k.a,V.a],pipes:[S.d,R.a],styles:["[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-right:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:2px;margin-inline-end:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesDiscussions35Page})();var z=n("OQOI"),Q=n("dQ3M");const j=[{path:"",data:{mainMenuTabRoot:z.b.PAGE_NAME},component:U},...a.DISCUSSION_ROUTES],F=[{path:"",data:{mainMenuTabRoot:z.b.PAGE_NAME},component:U,children:a.DISCUSSION_ROUTES}],N=[...Object(i.c)(j,(()=>o.a.isMobile)),...Object(i.c)(F,(()=>o.a.isTablet))];let G=(()=>{class AddonMessagesDiscussions35PageModule{}return AddonMessagesDiscussions35PageModule.ɵmod=b.wc({type:AddonMessagesDiscussions35PageModule}),AddonMessagesDiscussions35PageModule.ɵinj=b.vc({factory:function AddonMessagesDiscussions35PageModule_Factory(s){return new(s||AddonMessagesDiscussions35PageModule)},imports:[[t.m.forChild(N),c.a,d.a,Q.a],t.m]}),AddonMessagesDiscussions35PageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&b.kd(G,{declarations:[U],imports:[t.m,c.a,d.a,Q.a],exports:[t.m]}))}}]);