(window.webpackJsonp=window.webpackJsonp||[]).push([[120],{IcH5:function(e,t,c){"use strict";c.r(t),c.d(t,"CoreSettingsSpaceUsagePageModule",(function(){return T}));var i=c("tyNb"),a=c("L3Fv"),n=c("mrSG"),o=c("9+EE"),s=c("bFG1"),r=c("fjkH"),l=c("1gmh"),g=c("fXoL"),d=c("TEn/"),_=c("ACV2"),p=c("nt/U"),u=c("PgjG"),S=c("ofXK"),m=c("hMzs"),f=c("iSJP"),h=c("NcPy"),U=c("ACYt"),P=c("3CSS"),C=c("sYmb"),E=c("1iFe");function CoreSettingsSpaceUsagePage_ion_card_17_ng_container_9_Template(e,t){1&e&&g.Ac(0)}function CoreSettingsSpaceUsagePage_ion_card_17_ion_item_10_ng_container_1_Template(e,t){1&e&&g.Ac(0)}const _c0=function(e){return{site:e}};function CoreSettingsSpaceUsagePage_ion_card_17_ion_item_10_Template(e,t){if(1&e&&(g.Ec(0,"ion-item"),g.nd(1,CoreSettingsSpaceUsagePage_ion_card_17_ion_item_10_ng_container_1_Template,1,0,"ng-container",17),g.Dc()),2&e){const e=t.$implicit;g.Oc(2);const c=g.ed(28);g.lc(1),g.Vc("ngTemplateOutlet",c)("ngTemplateOutletContext",g.ad(2,_c0,e))}}function CoreSettingsSpaceUsagePage_ion_card_17_Template(e,t){if(1&e&&(g.Ec(0,"ion-card"),g.Ec(1,"ion-item-divider",13),g.Ec(2,"ion-label"),g.Ec(3,"p",10),g.zc(4,"core-format-text",14),g.Dc(),g.Ec(5,"p"),g.Ec(6,"a",15),g.pd(7),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Ec(8,"ion-item",16),g.nd(9,CoreSettingsSpaceUsagePage_ion_card_17_ng_container_9_Template,1,0,"ng-container",17),g.Dc(),g.nd(10,CoreSettingsSpaceUsagePage_ion_card_17_ion_item_10_Template,2,4,"ion-item",9),g.Dc()),2&e){const e=g.Oc(),t=g.ed(28);g.lc(4),g.Vc("text",e.accountsList.currentSite.siteName)("siteId",e.accountsList.currentSite.id),g.lc(2),g.Vc("href",e.accountsList.currentSite.siteUrl,g.id),g.lc(1),g.qd(e.accountsList.currentSite.siteUrlWithoutProtocol),g.lc(2),g.Vc("ngTemplateOutlet",t)("ngTemplateOutletContext",g.ad(7,_c0,e.accountsList.currentSite)),g.lc(1),g.Vc("ngForOf",e.accountsList.sameSite)}}function CoreSettingsSpaceUsagePage_ion_card_18_ion_item_divider_1_Template(e,t){if(1&e&&(g.Ec(0,"ion-item-divider",13),g.Ec(1,"ion-label"),g.Ec(2,"p",10),g.zc(3,"core-format-text",14),g.Dc(),g.Ec(4,"p"),g.Ec(5,"a",19),g.pd(6),g.Dc(),g.Dc(),g.Dc(),g.Dc()),2&e){const e=g.Oc().$implicit;g.lc(3),g.Vc("text",e[0].siteName)("siteId",e[0].id),g.lc(2),g.Vc("href",e[0].siteUrl,g.id),g.lc(1),g.qd(e[0].siteUrlWithoutProtocol)}}function CoreSettingsSpaceUsagePage_ion_card_18_ion_item_2_ng_container_1_Template(e,t){1&e&&g.Ac(0)}function CoreSettingsSpaceUsagePage_ion_card_18_ion_item_2_Template(e,t){if(1&e&&(g.Ec(0,"ion-item"),g.nd(1,CoreSettingsSpaceUsagePage_ion_card_18_ion_item_2_ng_container_1_Template,1,0,"ng-container",17),g.Dc()),2&e){const e=t.$implicit;g.Oc(2);const c=g.ed(28);g.lc(1),g.Vc("ngTemplateOutlet",c)("ngTemplateOutletContext",g.ad(2,_c0,e))}}function CoreSettingsSpaceUsagePage_ion_card_18_Template(e,t){if(1&e&&(g.Ec(0,"ion-card"),g.nd(1,CoreSettingsSpaceUsagePage_ion_card_18_ion_item_divider_1_Template,7,4,"ion-item-divider",18),g.nd(2,CoreSettingsSpaceUsagePage_ion_card_18_ion_item_2_Template,2,4,"ion-item",9),g.Dc()),2&e){const e=t.$implicit;g.lc(1),g.Vc("ngIf",e[0]),g.lc(1),g.Vc("ngForOf",e)}}function CoreSettingsSpaceUsagePage_ng_template_27_ion_badge_6_Template(e,t){if(1&e&&(g.Ec(0,"ion-badge",25),g.pd(1),g.Pc(2,"coreBytesToSize"),g.Dc()),2&e){const e=g.Oc().site;g.lc(1),g.qd(g.Qc(2,1,e.spaceUsage))}}const _c1=function(e){return{$a:e}},_c2=function(e){return{name:e}};function CoreSettingsSpaceUsagePage_ng_template_27_Template(e,t){if(1&e){const e=g.Fc();g.Ec(0,"ion-avatar",0),g.zc(1,"img",20),g.Pc(2,"translate"),g.Dc(),g.Ec(3,"ion-label",21),g.Ec(4,"p",10),g.pd(5),g.Dc(),g.nd(6,CoreSettingsSpaceUsagePage_ng_template_27_ion_badge_6_Template,3,3,"ion-badge",22),g.Dc(),g.Ec(7,"ion-button",23),g.Mc("click",(function CoreSettingsSpaceUsagePage_ng_template_27_Template_ion_button_click_7_listener(){g.fd(e);const c=t.site;return g.Oc().deleteSiteStorage(c)})),g.zc(8,"ion-icon",24),g.Pc(9,"translate"),g.Dc()}if(2&e){const e=t.site;g.lc(1),g.Wc("alt",g.Rc(2,7,"core.pictureof",g.ad(13,_c1,e.fullName))),g.Vc("src",e.avatar,g.id)("siteId",e.id),g.lc(4),g.qd(e.fullName),g.lc(1),g.Vc("ngIf",void 0!==e.spaceUsage),g.lc(1),g.Vc("hidden",e.spaceUsage<=0&&!e.hasCacheEntries),g.lc(1),g.mc("aria-label",g.Rc(9,10,"addon.storagemanager.deletedatafrom",g.ad(15,_c2,e.siteName)))}}let b=(()=>{class CoreSettingsSpaceUsagePage{constructor(){this.loaded=!1,this.totalSpaceUsage=0,this.accountsList={sameSite:[],otherSites:[]},this.sitesObserver=r.b.on(r.b.SITE_UPDATED,(e=>Object(n.a)(this,void 0,void 0,(function*(){var t;const c=e.siteId;let i=c===(null===(t=this.accountsList.currentSite)||void 0===t?void 0:t.id)?this.accountsList.currentSite:void 0;if(i||(i=this.accountsList.sameSite.find((e=>e.id===c))),i||this.accountsList.otherSites.some((e=>(i=e.find((e=>e.id===c)),i))),!i)return;const a=yield o.b.getSite(c),n=a.getInfo();i.siteName=a.getSiteName(),n&&(i.siteUrl=n.siteurl,i.fullName=n.fullname)}))))}ngOnInit(){this.loadSiteData().finally((()=>{this.loaded=!0}))}loadSiteData(){return Object(n.a)(this,void 0,void 0,(function*(){let e=0;const t=yield s.a.ignoreErrors(o.b.getSortedSites(),[]),c=yield Promise.all(t.map((e=>this.getSiteWithUsage(e))));let i="";const a=o.b.getCurrentSiteId();if(a){const t=c.findIndex((e=>e.id===a)),n=c.splice(t,1)[0];this.accountsList.currentSite=n,e+=n.spaceUsage||0,i=this.accountsList.currentSite.siteUrlWithoutProtocol}const n={};c.forEach((t=>{e+=t.spaceUsage||0,t.siteUrlWithoutProtocol===i?this.accountsList.sameSite.push(t):(void 0===n[t.siteUrlWithoutProtocol]&&(n[t.siteUrlWithoutProtocol]=[]),n[t.siteUrlWithoutProtocol].push(t))})),this.accountsList.otherSites=s.a.objectToArray(n),this.totalSpaceUsage=e}))}getSiteWithUsage(e){return Object(n.a)(this,void 0,void 0,(function*(){const t=yield l.a.getSiteSpaceUsage(e.id);return Object.assign(e,{hasCacheEntries:t.cacheEntries>0,spaceUsage:t.spaceUsage})}))}refreshData(e){this.loadSiteData().finally((()=>{null==e?void 0:e.complete()}))}deleteSiteStorage(e){return Object(n.a)(this,void 0,void 0,(function*(){try{const t=yield l.a.deleteSiteStorage(e.siteName||"",e.id);this.totalSpaceUsage-=e.spaceUsage-t.spaceUsage,e.spaceUsage=t.spaceUsage,e.hasCacheEntries=t.cacheEntries>0}catch(e){}}))}ngOnDestroy(){this.sitesObserver.off()}}return CoreSettingsSpaceUsagePage.ɵfac=function CoreSettingsSpaceUsagePage_Factory(e){return new(e||CoreSettingsSpaceUsagePage)},CoreSettingsSpaceUsagePage.ɵcmp=g.sc({type:CoreSettingsSpaceUsagePage,selectors:[["page-core-app-settings-space-usage"]],decls:29,vars:19,consts:[["slot","start"],[3,"text"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[1,"core-sitelist","limited-width"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"item-heading"],["slot","end",1,"ion-margin-end"],["siteUsage",""],["sticky","true",1,"core-sitelist-sitename"],["clean","true",3,"text","siteId"],["core-link","","autoLogin","yes",3,"href"],[1,"item-current"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["sticky","true","class","core-sitelist-sitename",4,"ngIf"],["core-link","","autoLogin","no",3,"href"],["core-external-content","","onError","this.src='assets/img/user-avatar.png'",3,"src","siteId","alt"],[1,"ion-text-wrap"],["color","light",4,"ngIf"],["fill","clear","color","danger","slot","end",3,"hidden","click"],["name","fas-trash","slot","icon-only"],["color","light"]],template:function CoreSettingsSpaceUsagePage_Template(e,t){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.Ec(6,"h1"),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Dc(),g.Ec(9,"ion-buttons",2),g.zc(10,"core-navbar-buttons"),g.Dc(),g.Dc(),g.Dc(),g.Ec(11,"ion-content",3),g.Ec(12,"ion-refresher",4),g.Mc("ionRefresh",(function CoreSettingsSpaceUsagePage_Template_ion_refresher_ionRefresh_12_listener(e){return t.refreshData(e.target)})),g.zc(13,"ion-refresher-content",5),g.Pc(14,"translate"),g.Dc(),g.Ec(15,"core-loading",6),g.Ec(16,"ion-list",7),g.nd(17,CoreSettingsSpaceUsagePage_ion_card_17_Template,11,9,"ion-card",8),g.nd(18,CoreSettingsSpaceUsagePage_ion_card_18_Template,3,2,"ion-card",9),g.Ec(19,"ion-item-divider"),g.Ec(20,"ion-label"),g.Ec(21,"p",10),g.pd(22),g.Pc(23,"translate"),g.Dc(),g.Dc(),g.Ec(24,"p",11),g.pd(25),g.Pc(26,"coreBytesToSize"),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.nd(27,CoreSettingsSpaceUsagePage_ng_template_27_Template,10,17,"ng-template",null,12,g.od)),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,9,"core.back")),g.lc(4),g.qd(g.Qc(8,11,"core.settings.spaceusage")),g.lc(5),g.Vc("disabled",!t.loaded),g.lc(1),g.Wc("pullingText",g.Qc(14,13,"core.pulltorefresh")),g.lc(2),g.Vc("hideUntil",t.loaded),g.lc(2),g.Vc("ngIf",t.accountsList.currentSite),g.lc(1),g.Vc("ngForOf",t.accountsList.otherSites),g.lc(4),g.qd(g.Qc(23,15,"core.settings.total")),g.lc(3),g.rd(" ",g.Qc(26,17,t.totalSpaceUsage)," "))},directives:[d.C,d.Ab,d.m,d.h,d.i,d.yb,_.a,p.a,d.v,d.bb,d.cb,u.a,d.P,S.t,S.s,d.J,d.O,d.n,m.a,f.a,d.I,S.A,d.g,h.a,U.a,d.l,d.D,P.a,d.k],pipes:[C.d,E.a],encapsulation:2}),CoreSettingsSpaceUsagePage})();const D=[{path:"",component:b}];let T=(()=>{class CoreSettingsSpaceUsagePageModule{}return CoreSettingsSpaceUsagePageModule.ɵmod=g.wc({type:CoreSettingsSpaceUsagePageModule}),CoreSettingsSpaceUsagePageModule.ɵinj=g.vc({factory:function CoreSettingsSpaceUsagePageModule_Factory(e){return new(e||CoreSettingsSpaceUsagePageModule)},imports:[[i.m.forChild(D),a.a],i.m]}),CoreSettingsSpaceUsagePageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&g.kd(T,{declarations:[b],imports:[i.m,a.a],exports:[i.m]}))}}]);