(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{"617G":function(e,t,n){"use strict";n.r(t),n.d(t,"AddonMessagesContactsPageModule",(function(){return L}));var s=n("tyNb"),o=n("vY5A"),a=n("muSn"),i=n("Y+03"),c=n("L3Fv"),r=n("mrSG"),d=n("fjkH"),g=n("9+EE"),l=n("KMk0"),_=n("pHTc"),m=n("3LXp"),u=n("46ml"),f=n("fXoL"),h=n("TEn/"),M=n("ACYt"),C=n("3CSS"),P=n("fQ68"),p=n("nt/U"),O=n("vWwc"),b=n("JYLr"),v=n("PgjG"),x=n("ofXK"),q=n("xpMl"),T=n("FeAf"),A=n("hMzs"),E=n("r8G5"),y=n("sYmb");function AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_ion_icon_5_Template(e,t){1&e&&(f.zc(0,"ion-icon",20),f.Pc(1,"translate")),2&e&&f.mc("aria-label",f.Qc(1,1,"addon.messages.contactblocked"))}function AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_Template(e,t){if(1&e){const e=f.Fc();f.Ec(0,"ion-item",15),f.Mc("click",(function AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_Template_ion_item_click_0_listener(){f.fd(e);const n=t.$implicit;return f.Oc(3).selectUser(n.id)})),f.zc(1,"core-user-avatar",16),f.Ec(2,"ion-label"),f.Ec(3,"p",17),f.zc(4,"core-format-text",18),f.nd(5,AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_ion_icon_5_Template,2,3,"ion-icon",19),f.Dc(),f.Dc(),f.Dc()}if(2&e){const e=t.$implicit,n=f.Oc(3);f.mc("aria-label",e.fullname)("aria-current",e.id==n.selectedUserId?"page":"false"),f.lc(1),f.Vc("user",e)("checkOnline",e.showonlinestatus)("linkProfile",!1),f.lc(3),f.Vc("text",e.fullname)("contextInstanceId",0),f.lc(1),f.Vc("ngIf",e.isblocked)}}function AddonMessagesContactsPage_ng_template_19_ion_list_4_Template(e,t){if(1&e&&(f.Ec(0,"ion-list",13),f.nd(1,AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_Template,6,8,"ion-item",14),f.Dc()),2&e){const e=f.Oc(2);f.lc(1),f.Vc("ngForOf",e.confirmedContacts)}}function AddonMessagesContactsPage_ng_template_19_core_empty_box_5_Template(e,t){1&e&&(f.zc(0,"core-empty-box",21),f.Pc(1,"translate")),2&e&&f.Vc("message",f.Qc(1,1,"addon.messages.nocontactsgetstarted"))}function AddonMessagesContactsPage_ng_template_19_Template(e,t){if(1&e){const e=f.Fc();f.Ec(0,"ion-refresher",8),f.Mc("ionRefresh",(function AddonMessagesContactsPage_ng_template_19_Template_ion_refresher_ionRefresh_0_listener(t){f.fd(e);return f.Oc().refreshData(t.target)})),f.zc(1,"ion-refresher-content",9),f.Pc(2,"translate"),f.Dc(),f.Ec(3,"core-loading",5),f.nd(4,AddonMessagesContactsPage_ng_template_19_ion_list_4_Template,2,1,"ion-list",10),f.nd(5,AddonMessagesContactsPage_ng_template_19_core_empty_box_5_Template,2,3,"core-empty-box",11),f.Ec(6,"core-infinite-loading",12),f.Mc("action",(function AddonMessagesContactsPage_ng_template_19_Template_core_infinite_loading_action_6_listener(t){f.fd(e);return f.Oc().loadMore(t)})),f.Dc(),f.Dc()}if(2&e){const e=f.Oc();f.Vc("disabled",!e.confirmedLoaded),f.lc(1),f.Wc("pullingText",f.Qc(2,7,"core.pulltorefresh")),f.lc(2),f.Vc("hideUntil",e.confirmedLoaded),f.lc(1),f.Vc("ngIf",e.confirmedContacts.length),f.lc(1),f.Vc("ngIf",!e.confirmedContacts.length),f.lc(1),f.Vc("enabled",e.confirmedCanLoadMore)("error",e.confirmedLoadMoreError)}}function AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_p_4_Template(e,t){1&e&&(f.Ec(0,"p"),f.pd(1),f.Pc(2,"translate"),f.Dc()),2&e&&(f.lc(1),f.rd(" ",f.Qc(2,1,"addon.messages.wouldliketocontactyou")," "))}function AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_Template(e,t){if(1&e){const e=f.Fc();f.Ec(0,"ion-item",15),f.Mc("click",(function AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_Template_ion_item_click_0_listener(){f.fd(e);const n=t.$implicit;return f.Oc(3).selectUser(n.id)})),f.zc(1,"core-user-avatar",22),f.Ec(2,"ion-label"),f.zc(3,"core-format-text",18),f.nd(4,AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_p_4_Template,3,3,"p",23),f.Dc(),f.Dc()}if(2&e){const e=t.$implicit,n=f.Oc(3);f.mc("aria-label",e.fullname)("aria-current",e.id==n.selectedUserId?"page":"false"),f.lc(1),f.Vc("user",e)("linkProfile",!1),f.lc(2),f.Vc("text",e.fullname)("contextInstanceId",0),f.lc(1),f.Vc("ngIf",!e.iscontact)}}function AddonMessagesContactsPage_ng_template_22_ion_list_4_Template(e,t){if(1&e&&(f.Ec(0,"ion-list",13),f.nd(1,AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_Template,5,7,"ion-item",14),f.Dc()),2&e){const e=f.Oc(2);f.lc(1),f.Vc("ngForOf",e.requests)}}function AddonMessagesContactsPage_ng_template_22_core_empty_box_5_Template(e,t){1&e&&(f.zc(0,"core-empty-box",21),f.Pc(1,"translate")),2&e&&f.Vc("message",f.Qc(1,1,"addon.messages.nocontactrequests"))}function AddonMessagesContactsPage_ng_template_22_Template(e,t){if(1&e){const e=f.Fc();f.Ec(0,"ion-refresher",8),f.Mc("ionRefresh",(function AddonMessagesContactsPage_ng_template_22_Template_ion_refresher_ionRefresh_0_listener(t){f.fd(e);return f.Oc().refreshData(t.target)})),f.zc(1,"ion-refresher-content",9),f.Pc(2,"translate"),f.Dc(),f.Ec(3,"core-loading",5),f.nd(4,AddonMessagesContactsPage_ng_template_22_ion_list_4_Template,2,1,"ion-list",10),f.nd(5,AddonMessagesContactsPage_ng_template_22_core_empty_box_5_Template,2,3,"core-empty-box",11),f.Ec(6,"core-infinite-loading",12),f.Mc("action",(function AddonMessagesContactsPage_ng_template_22_Template_core_infinite_loading_action_6_listener(t){f.fd(e);return f.Oc().loadMore(t)})),f.Dc(),f.Dc()}if(2&e){const e=f.Oc();f.Vc("disabled",!e.requestsLoaded),f.lc(1),f.Wc("pullingText",f.Qc(2,7,"core.pulltorefresh")),f.lc(2),f.Vc("hideUntil",e.requestsLoaded),f.lc(1),f.Vc("ngIf",e.requests.length),f.lc(1),f.Vc("ngIf",!e.requests.length),f.lc(1),f.Vc("enabled",e.requestsCanLoadMore)("error",e.requestsLoadMoreError)}}let D=(()=>{class AddonMessagesContactsPage{constructor(){this.selected="confirmed",this.requestsBadge="",this.confirmedLoaded=!1,this.confirmedInitialising=!1,this.confirmedCanLoadMore=!1,this.confirmedLoadMoreError=!1,this.confirmedContacts=[],this.requestsLoaded=!1,this.requestsInitialising=!1,this.requestsCanLoadMore=!1,this.requestsLoadMoreError=!1,this.requests=[],this.siteId=g.b.getCurrentSiteId(),this.contactRequestsCountObserver=d.b.on(l.b.CONTACT_REQUESTS_COUNT_EVENT,(e=>{this.requestsBadge=e.count>0?String(e.count):""}),this.siteId),this.memberInfoObserver=d.b.on(l.b.MEMBER_INFO_CHANGED_EVENT,(e=>{if(e.userBlocked||e.userUnblocked){const t=this.confirmedContacts.find((t=>t.id==e.userId));t&&(t.isblocked=!!e.userBlocked)}else if(e.contactRemoved){const t=this.confirmedContacts.findIndex((t=>t.id==e.userId));t>=0&&this.confirmedContacts.splice(t,1)}else e.contactRequestConfirmed&&this.confirmedFetchData(!0);if(e.contactRequestConfirmed||e.contactRequestDeclined){const t=this.requests.findIndex((t=>t.id==e.userId));t>=0&&this.requests.splice(t,1)}}),g.b.getCurrentSiteId())}ngOnInit(){return Object(r.a)(this,void 0,void 0,(function*(){l.a.getContactRequestsCount(this.siteId),"confirmed"===this.selected?yield this.initConfirmed():yield this.initRequests()}))}initConfirmed(){return Object(r.a)(this,void 0,void 0,(function*(){if(!this.confirmedInitialising)try{this.confirmedInitialising=!0,yield this.confirmedFetchData(),this.confirmedContacts.length&&i.a.isTablet&&this.selectUser(this.confirmedContacts[0].id,!0)}finally{this.confirmedInitialising=!1,this.confirmedLoaded=!0}}))}initRequests(){return Object(r.a)(this,void 0,void 0,(function*(){if(!this.requestsInitialising)try{this.requestsInitialising=!0,yield this.requestsFetchData(),this.requests.length&&i.a.isTablet&&this.selectUser(this.requests[0].id,!0)}finally{this.requestsInitialising=!1,this.requestsLoaded=!0}}))}confirmedFetchData(e=!1){return Object(r.a)(this,void 0,void 0,(function*(){this.confirmedLoadMoreError=!1;const t=e?0:this.confirmedContacts.length;0===t&&(yield l.a.invalidateUserContacts());try{const n=yield l.a.getUserContacts(t);this.confirmedContacts=e?n.contacts:this.confirmedContacts.concat(n.contacts),this.confirmedCanLoadMore=n.canLoadMore}catch(e){this.confirmedLoadMoreError=!0,m.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)}}))}requestsFetchData(e=!1){return Object(r.a)(this,void 0,void 0,(function*(){this.requestsLoadMoreError=!1;const t=e?0:this.requests.length;0===t&&(yield l.a.invalidateContactRequestsCache());try{const n=yield l.a.getContactRequests(t);this.requests=e?n.requests:this.requests.concat(n.requests),this.requestsCanLoadMore=n.canLoadMore}catch(e){this.requestsLoadMoreError=!0,m.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)}}))}refreshData(e){return Object(r.a)(this,void 0,void 0,(function*(){try{"confirmed"==this.selected?yield this.confirmedFetchData(!0):(l.a.refreshContactRequestsCount(),yield this.requestsFetchData(!0))}finally{null==e?void 0:e.complete()}}))}loadMore(e){return Object(r.a)(this,void 0,void 0,(function*(){try{"confirmed"==this.selected?yield this.confirmedFetchData():yield this.requestsFetchData()}finally{e&&e()}}))}gotoSearch(){_.a.navigateToSitePath("search")}selectTab(e){"confirmed"!==e&&"requests"!==e||(this.selected=e,"confirmed"!=this.selected||this.confirmedLoaded||this.initConfirmed(),"requests"!=this.selected||this.requestsLoaded||this.initRequests())}selectUser(e,t=!1){if(e==this.selectedUserId&&i.a.isTablet)return;if(t&&i.a.isMobile)return;this.selectedUserId=e;const n=_.a.getRelativePathToParent("/messages/contacts")+`discussion/user/${e}`;_.a.navigate(n,{reset:i.a.isTablet&&!!this.splitView&&!this.splitView.isNested})}ngOnDestroy(){var e;null===(e=this.contactRequestsCountObserver)||void 0===e?void 0:e.off()}}return AddonMessagesContactsPage.ɵfac=function AddonMessagesContactsPage_Factory(e){return new(e||AddonMessagesContactsPage)},AddonMessagesContactsPage.ɵcmp=f.sc({type:AddonMessagesContactsPage,selectors:[["page-addon-messages-contacts"]],viewQuery:function AddonMessagesContactsPage_Query(e,t){var n;(1&e&&f.ud(u.a,!0),2&e)&&(f.dd(n=f.Nc())&&(t.splitView=n.first))},decls:23,vars:17,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["name","fas-search","slot","icon-only","aria-hidden","true"],[3,"hideUntil"],[3,"title","ionSelect"],["badgeA11yText","addon.messages.pendingcontactrequests",3,"title","badge","ionSelect"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["class","ion-no-margin",4,"ngIf"],["icon","far-address-book",3,"message",4,"ngIf"],["position","bottom",3,"enabled","error","action"],[1,"ion-no-margin"],["class","ion-text-wrap addon-messages-conversation-item","button","","detail","true",3,"click",4,"ngFor","ngForOf"],["button","","detail","true",1,"ion-text-wrap","addon-messages-conversation-item",3,"click"],["slot","start",3,"user","checkOnline","linkProfile"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId"],["name","fas-user-slash","slot","end",4,"ngIf"],["name","fas-user-slash","slot","end"],["icon","far-address-book",3,"message"],["slot","start",3,"user","linkProfile"],[4,"ngIf"]],template:function AddonMessagesContactsPage_Template(e,t){1&e&&(f.Ec(0,"ion-header"),f.Ec(1,"ion-toolbar"),f.Ec(2,"ion-buttons",0),f.zc(3,"ion-back-button",1),f.Pc(4,"translate"),f.Dc(),f.Ec(5,"ion-title"),f.Ec(6,"h1"),f.pd(7),f.Pc(8,"translate"),f.Dc(),f.Dc(),f.Ec(9,"ion-buttons",2),f.Ec(10,"ion-button",3),f.Mc("click",(function AddonMessagesContactsPage_Template_ion_button_click_10_listener(){return t.gotoSearch()})),f.Pc(11,"translate"),f.zc(12,"ion-icon",4),f.Dc(),f.zc(13,"core-context-menu"),f.Dc(),f.Dc(),f.Dc(),f.Ec(14,"ion-content"),f.Ec(15,"core-split-view"),f.Ec(16,"core-tabs",5),f.Ec(17,"core-tab",6),f.Mc("ionSelect",(function AddonMessagesContactsPage_Template_core_tab_ionSelect_17_listener(){return t.selectTab("confirmed")})),f.Pc(18,"translate"),f.nd(19,AddonMessagesContactsPage_ng_template_19_Template,7,9,"ng-template"),f.Dc(),f.Ec(20,"core-tab",7),f.Mc("ionSelect",(function AddonMessagesContactsPage_Template_core_tab_ionSelect_20_listener(){return t.selectTab("requests")})),f.Pc(21,"translate"),f.nd(22,AddonMessagesContactsPage_ng_template_22_Template,7,9,"ng-template"),f.Dc(),f.Dc(),f.Dc(),f.Dc()),2&e&&(f.lc(3),f.Vc("text",f.Qc(4,7,"core.back")),f.lc(4),f.qd(f.Qc(8,9,"addon.messages.contacts")),f.lc(3),f.mc("aria-label",f.Qc(11,11,"addon.messages.searchcombined")),f.lc(6),f.Vc("hideUntil",!0),f.lc(1),f.Vc("title",f.Qc(18,13,"addon.messages.contacts")),f.lc(3),f.Vc("title",f.Qc(21,15,"addon.messages.requests"))("badge",t.requestsBadge))},directives:[h.C,h.Ab,h.m,h.h,h.i,h.yb,M.a,h.l,h.D,C.a,P.a,p.a,h.v,u.a,O.a,b.a,h.bb,h.cb,v.a,x.t,q.a,h.P,x.s,h.I,T.a,h.O,A.a,E.a],pipes:[y.d],styles:["[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-right:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:2px;margin-inline-end:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesContactsPage})();const I=[{path:"",component:D},...a.DISCUSSION_ROUTES],k=[{path:"",component:D,children:a.DISCUSSION_ROUTES}],w=[...Object(o.c)(I,(()=>i.a.isMobile)),...Object(o.c)(k,(()=>i.a.isTablet))];let L=(()=>{class AddonMessagesContactsPageModule{}return AddonMessagesContactsPageModule.ɵmod=f.wc({type:AddonMessagesContactsPageModule}),AddonMessagesContactsPageModule.ɵinj=f.vc({factory:function AddonMessagesContactsPageModule_Factory(e){return new(e||AddonMessagesContactsPageModule)},imports:[[s.m.forChild(w),c.a],s.m]}),AddonMessagesContactsPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&f.kd(L,{declarations:[D],imports:[s.m,c.a],exports:[s.m]}))}}]);