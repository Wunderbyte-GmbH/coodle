(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{"N/A2":function(e,n,o){"use strict";o.r(n),o.d(n,"AddonModLessonUserRetakePageModule",(function(){return x}));var t=o("tyNb"),c=o("L3Fv"),s=o("mrSG"),a=o("93ts"),d=o("4pns"),i=o("pHTc"),_=o("9+EE"),r=o("3LXp"),l=o("vuGA"),g=o("bFG1"),m=o("j3ag"),u=o("ovS5"),p=o("2kx2"),f=o("8vmT"),v=o("fXoL"),h=o("TEn/"),k=o("nt/U"),I=o("PgjG"),P=o("ofXK"),M=o("nu3w"),E=o("FeAf"),R=o("TKc2"),D=o("3Pt+"),b=o("hMzs"),L=o("edOc"),A=o("ACYt"),U=o("sYmb"),T=o("uYHD");function AddonModLessonUserRetakePage_div_14_ion_item_7_ion_select_option_6_Template(e,n){if(1&e&&(v.Ec(0,"ion-select-option",15),v.pd(1),v.Dc()),2&e){const e=n.$implicit;v.Vc("value",e.try),v.lc(1),v.rd(" ",e.label," ")}}const _c0=function(e){return{header:e}};function AddonModLessonUserRetakePage_div_14_ion_item_7_Template(e,n){if(1&e){const e=v.Fc();v.Ec(0,"ion-item",12),v.Ec(1,"ion-label"),v.pd(2),v.Pc(3,"translate"),v.Dc(),v.Ec(4,"ion-select",13),v.Mc("ngModelChange",(function AddonModLessonUserRetakePage_div_14_ion_item_7_Template_ion_select_ngModelChange_4_listener(n){v.fd(e);return v.Oc(2).selectedRetake=n}))("ionChange",(function AddonModLessonUserRetakePage_div_14_ion_item_7_Template_ion_select_ionChange_4_listener(){v.fd(e);const n=v.Oc(2);return n.changeRetake(n.selectedRetake)})),v.Pc(5,"translate"),v.nd(6,AddonModLessonUserRetakePage_div_14_ion_item_7_ion_select_option_6_Template,2,2,"ion-select-option",14),v.Dc(),v.Dc()}if(2&e){const e=v.Oc(2);v.lc(2),v.qd(v.Qc(3,4,"addon.mod_lesson.attemptheader")),v.lc(2),v.Vc("ngModel",e.selectedRetake)("interfaceOptions",v.ad(8,_c0,v.Qc(5,6,"addon.mod_lesson.attemptheader"))),v.lc(2),v.Vc("ngForOf",e.student.attempts)}}const _c1=function(e){return{$a:e}};function AddonModLessonUserRetakePage_div_14_ion_list_8_Template(e,n){if(1&e&&(v.Ec(0,"ion-list",16),v.Ec(1,"ion-item"),v.Ec(2,"ion-label",12),v.Ec(3,"ion-grid",17),v.Ec(4,"ion-row"),v.Ec(5,"ion-col"),v.Ec(6,"p",18),v.pd(7),v.Pc(8,"translate"),v.Dc(),v.Ec(9,"p"),v.pd(10),v.Pc(11,"translate"),v.Dc(),v.Dc(),v.Ec(12,"ion-col"),v.Ec(13,"p",18),v.pd(14),v.Pc(15,"translate"),v.Dc(),v.Ec(16,"p"),v.pd(17),v.Dc(),v.Dc(),v.Dc(),v.Dc(),v.Dc(),v.Dc(),v.Ec(18,"ion-item",12),v.Ec(19,"ion-label"),v.Ec(20,"p",18),v.pd(21),v.Pc(22,"translate"),v.Dc(),v.Ec(23,"p"),v.pd(24),v.Dc(),v.Dc(),v.Dc(),v.Ec(25,"ion-item",12),v.Ec(26,"ion-label"),v.Ec(27,"p",18),v.pd(28),v.Pc(29,"translate"),v.Dc(),v.Ec(30,"p"),v.pd(31),v.Pc(32,"coreFormatDate"),v.Dc(),v.Dc(),v.Dc(),v.Dc()),2&e){const e=v.Oc(2);v.lc(7),v.qd(v.Qc(8,9,"addon.mod_lesson.grade")),v.lc(3),v.qd(v.Rc(11,11,"core.percentagenumber",v.ad(22,_c1,e.retake.userstats.grade))),v.lc(4),v.qd(v.Qc(15,14,"addon.mod_lesson.rawgrade")),v.lc(3),v.sd("",e.retake.userstats.gradeinfo.earned," / ",e.retake.userstats.gradeinfo.total,""),v.lc(4),v.qd(v.Qc(22,16,"addon.mod_lesson.timetaken")),v.lc(3),v.qd(e.timeTakenReadable),v.lc(4),v.qd(v.Qc(29,18,"addon.mod_lesson.completed")),v.lc(3),v.qd(v.Qc(32,20,1e3*e.retake.userstats.completed))}}function AddonModLessonUserRetakePage_div_14_ion_item_9_Template(e,n){1&e&&(v.Ec(0,"ion-item",12),v.Ec(1,"ion-label"),v.pd(2),v.Pc(3,"translate"),v.Dc(),v.Dc()),2&e&&(v.lc(2),v.qd(v.Qc(3,1,"addon.mod_lesson.notcompleted")))}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_ion_item_16_Template(e,n){1&e&&(v.Ec(0,"ion-item",12),v.Ec(1,"ion-label"),v.Ec(2,"p"),v.pd(3),v.Pc(4,"translate"),v.Dc(),v.Dc(),v.Dc()),2&e&&(v.lc(3),v.qd(v.Qc(4,1,"addon.mod_lesson.didnotanswerquestion")))}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_1_Template(e,n){if(1&e&&(v.Ec(0,"ion-item"),v.Ec(1,"ion-label",12),v.Ec(2,"ion-grid",17),v.Ec(3,"ion-row"),v.Ec(4,"ion-col"),v.Ec(5,"ion-button",25),v.pd(6),v.Dc(),v.Dc(),v.Ec(7,"ion-col"),v.zc(8,"p",26),v.Dc(),v.Dc(),v.Dc(),v.Dc(),v.Dc()),2&e){const e=v.Oc().$implicit;v.lc(5),v.Vc("disabled",!0),v.lc(1),v.rd(" ",e[0].buttonText," "),v.lc(2),v.Vc("innerHTML",e[0].content,v.gd)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_4_Template(e,n){if(1&e&&(v.Ec(0,"ion-badge",32),v.zc(1,"core-format-text",29),v.Dc()),2&e){const e=v.Oc(3).$implicit,n=v.Oc(5);v.lc(1),v.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}const _c2=function(e){return{"addon-mod_lesson-highlight":e}};function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_Template(e,n){if(1&e&&(v.Ec(0,"ion-item",28),v.Ec(1,"ion-label"),v.Ec(2,"p"),v.zc(3,"core-format-text",29),v.Dc(),v.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_4_Template,2,5,"ion-badge",30),v.Dc(),v.zc(5,"ion-checkbox",31),v.Dc()),2&e){const e=v.Oc(2).$implicit,n=v.Oc(5);v.Vc("ngClass",v.ad(10,_c2,e[0].highlight)),v.lc(3),v.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0].content)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),v.lc(1),v.Vc("ngIf",e[1]),v.lc(1),v.Vc("ngModel",e[0].checked)("disabled",!0),v.mc("name",e[0].name)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_ion_badge_4_Template(e,n){if(1&e&&(v.Ec(0,"ion-badge",32),v.zc(1,"core-format-text",29),v.Dc()),2&e){const e=v.Oc(3).$implicit,n=v.Oc(5);v.lc(1),v.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_Template(e,n){if(1&e&&(v.Ec(0,"ion-item",12),v.Ec(1,"ion-label"),v.Ec(2,"p"),v.pd(3),v.Dc(),v.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_ion_badge_4_Template,2,5,"ion-badge",30),v.Dc(),v.Dc()),2&e){const e=v.Oc(2).$implicit;v.lc(3),v.qd(e[0].value),v.lc(1),v.Vc("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_ion_badge_10_Template(e,n){if(1&e&&(v.Ec(0,"ion-badge",32),v.zc(1,"core-format-text",29),v.Dc()),2&e){const e=v.Oc(3).$implicit,n=v.Oc(5);v.lc(1),v.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_Template(e,n){if(1&e&&(v.Ec(0,"ion-item"),v.Ec(1,"ion-label",12),v.Ec(2,"ion-grid",17),v.Ec(3,"ion-row"),v.Ec(4,"ion-col"),v.Ec(5,"p"),v.zc(6,"core-format-text",29),v.Dc(),v.Dc(),v.Ec(7,"ion-col"),v.Ec(8,"p"),v.pd(9),v.Dc(),v.nd(10,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_ion_badge_10_Template,2,5,"ion-badge",30),v.Dc(),v.Dc(),v.Dc(),v.Dc(),v.Dc()),2&e){const e=v.Oc(2).$implicit,n=v.Oc(5);v.lc(6),v.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0].content)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),v.lc(3),v.qd(e[0].value),v.lc(1),v.Vc("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_ion_badge_4_Template(e,n){if(1&e&&(v.Ec(0,"ion-badge",32),v.zc(1,"core-format-text",29),v.Dc()),2&e){const e=v.Oc(3).$implicit,n=v.Oc(5);v.lc(1),v.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_Template(e,n){if(1&e&&(v.Ec(0,"ion-item",12),v.Ec(1,"ion-label"),v.Ec(2,"p"),v.zc(3,"core-format-text",29),v.Dc(),v.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_ion_badge_4_Template,2,5,"ion-badge",30),v.Dc(),v.Dc()),2&e){const e=v.Oc(2).$implicit,n=v.Oc(5);v.lc(3),v.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),v.lc(1),v.Vc("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_Template(e,n){if(1&e&&(v.Cc(0),v.nd(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_Template,6,12,"ion-item",27),v.nd(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_Template,5,2,"ion-item",10),v.nd(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_Template,11,7,"ion-item",6),v.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_Template,5,6,"ion-item",10),v.Bc()),2&e){const e=v.Oc().$implicit;v.lc(1),v.Vc("ngIf",e[0].isCheckbox),v.lc(1),v.Vc("ngIf",e[0].isText),v.lc(1),v.Vc("ngIf",e[0].isSelect),v.lc(1),v.Vc("ngIf",!e[0].isCheckbox&&!e[0].isText&&!e[0].isSelect)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_ion_badge_4_Template(e,n){if(1&e&&(v.Ec(0,"ion-badge",32),v.zc(1,"core-format-text",29),v.Dc()),2&e){const e=v.Oc(2).$implicit,n=v.Oc(5);v.lc(1),v.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_Template(e,n){if(1&e&&(v.Ec(0,"ion-item",12),v.Ec(1,"ion-label"),v.Ec(2,"p"),v.zc(3,"core-format-text",29),v.Dc(),v.nd(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_ion_badge_4_Template,2,5,"ion-badge",30),v.Dc(),v.Dc()),2&e){const e=v.Oc().$implicit,n=v.Oc(5);v.lc(3),v.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),v.lc(1),v.Vc("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_Template(e,n){if(1&e&&(v.Cc(0),v.nd(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_1_Template,9,3,"ion-item",6),v.nd(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_Template,5,4,"ng-container",6),v.nd(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_Template,5,6,"ion-item",10),v.Bc()),2&e){const e=v.Oc(2).$implicit;v.lc(1),v.Vc("ngIf",e.isContent),v.lc(1),v.Vc("ngIf",e.isQuestion),v.lc(1),v.Vc("ngIf",!e.isContent&&!e.isQuestion)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_2_Template(e,n){if(1&e&&(v.Ec(0,"ion-item",12),v.Ec(1,"ion-label"),v.Ec(2,"p",18),v.pd(3),v.Pc(4,"translate"),v.Dc(),v.Ec(5,"p"),v.zc(6,"core-format-text",29),v.Dc(),v.Dc(),v.Dc()),2&e){const e=v.Oc(2).$implicit,n=v.Oc(3);v.lc(3),v.qd(v.Qc(4,6,"addon.mod_lesson.response")),v.lc(3),v.Vc("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e.answerdata.response)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_3_Template(e,n){if(1&e&&(v.Ec(0,"ion-item",12),v.Ec(1,"ion-label"),v.Ec(2,"p"),v.pd(3),v.Dc(),v.Dc(),v.Dc()),2&e){const e=v.Oc(2).$implicit;v.lc(3),v.qd(e.answerdata.score)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_Template(e,n){if(1&e&&(v.Ec(0,"div",23),v.nd(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_Template,4,3,"ng-container",24),v.nd(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_2_Template,7,8,"ion-item",10),v.nd(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_3_Template,4,1,"ion-item",10),v.Dc()),2&e){const e=v.Oc().$implicit;v.lc(1),v.Vc("ngForOf",e.answerdata.answers),v.lc(1),v.Vc("ngIf",e.answerdata.response),v.lc(1),v.Vc("ngIf",e.answerdata.score)}}const _c3=function(e){return{"text-dimmed":e}};function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_Template(e,n){if(1&e&&(v.Ec(0,"ion-card",20),v.Ec(1,"ion-card-header",12),v.Ec(2,"ion-card-title"),v.pd(3),v.Dc(),v.Dc(),v.Ec(4,"ion-item",12),v.Ec(5,"ion-label"),v.Ec(6,"p",18),v.pd(7),v.Pc(8,"translate"),v.Dc(),v.Ec(9,"p"),v.zc(10,"core-format-text",21),v.Dc(),v.Dc(),v.Dc(),v.Ec(11,"ion-item",12),v.Ec(12,"ion-label"),v.Ec(13,"p",18),v.pd(14),v.Pc(15,"translate"),v.Dc(),v.Dc(),v.Dc(),v.nd(16,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_ion_item_16_Template,5,3,"ion-item",10),v.nd(17,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_Template,4,3,"div",22),v.Dc()),2&e){const e=n.$implicit,o=v.Oc(3);v.Vc("ngClass",v.ad(16,_c3,e.grayout)),v.lc(3),v.sd("",e.qtype,": ",e.title,""),v.lc(4),v.qd(v.Qc(8,12,"addon.mod_lesson.question")),v.lc(3),v.Vc("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e.contents)("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId),v.lc(4),v.qd(v.Qc(15,14,"addon.mod_lesson.answer")),v.lc(2),v.Vc("ngIf",!e.answerdata||!e.answerdata.answers||!e.answerdata.answers.length),v.lc(1),v.Vc("ngIf",e.answerdata&&e.answerdata.answers&&e.answerdata.answers.length)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_Template(e,n){if(1&e&&(v.Cc(0),v.nd(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_Template,18,18,"ion-card",19),v.Bc()),2&e){const e=v.Oc(2);v.lc(1),v.Vc("ngForOf",e.retake.answerpages)}}function AddonModLessonUserRetakePage_div_14_Template(e,n){if(1&e&&(v.Ec(0,"div"),v.Ec(1,"ion-item",7),v.zc(2,"core-user-avatar",8),v.Ec(3,"ion-label"),v.Ec(4,"h2"),v.pd(5),v.Dc(),v.zc(6,"core-progress-bar",9),v.Dc(),v.Dc(),v.nd(7,AddonModLessonUserRetakePage_div_14_ion_item_7_Template,7,10,"ion-item",10),v.nd(8,AddonModLessonUserRetakePage_div_14_ion_list_8_Template,33,24,"ion-list",11),v.nd(9,AddonModLessonUserRetakePage_div_14_ion_item_9_Template,4,3,"ion-item",10),v.nd(10,AddonModLessonUserRetakePage_div_14_ng_container_10_Template,2,1,"ng-container",6),v.Dc()),2&e){const e=v.Oc();v.lc(1),v.Vc("userId",e.student.id)("courseId",e.courseId),v.mc("aria-label",e.student.fullname),v.lc(1),v.Vc("user",e.student)("userId",e.student.id)("courseId",e.courseId)("linkProfile",!1),v.lc(3),v.qd(e.student.fullname),v.lc(1),v.Vc("progress",e.student.bestgrade),v.lc(1),v.Vc("ngIf",e.student.attempts&&e.student.attempts.length>1),v.lc(1),v.Vc("ngIf",e.retake&&e.retake.userstats&&e.retake.userstats.gradeinfo),v.lc(1),v.Vc("ngIf",e.retake&&(!e.retake.userstats||!e.retake.userstats.gradeinfo)),v.lc(1),v.Vc("ngIf",e.retake)}}let w=(()=>{class AddonModLessonUserRetakePage{constructor(){this.component=u.b.COMPONENT}ngOnInit(){try{this.cmId=i.a.getRequiredRouteNumberParam("cmId"),this.courseId=i.a.getRequiredRouteNumberParam("courseId"),this.userId=i.a.getRouteNumberParam("userId")||_.b.getCurrentSiteUserId(),this.retakeNumber=i.a.getRouteNumberParam("retake")}catch(e){return r.a.showErrorModal(e),i.a.back(),void 0}this.fetchData().finally((()=>{this.loaded=!0}))}changeRetake(e){return Object(s.a)(this,void 0,void 0,(function*(){this.loaded=!1;try{yield this.setRetake(e)}catch(e){this.selectedRetake=this.previousSelectedRetake,r.a.showErrorModal(g.a.addDataNotDownloadedError(e,"Error getting attempt."))}finally{this.loaded=!0}}))}doRefresh(e){this.refreshData().finally((()=>{null==e?void 0:e.complete()}))}fetchData(){var e;return Object(s.a)(this,void 0,void 0,(function*(){try{this.lesson=yield u.a.getLesson(this.courseId,this.cmId);const n=yield u.a.getRetakesOverview(this.lesson.id,{cmId:this.cmId}),o=null===(e=null==n?void 0:n.students)||void 0===e?void 0:e.find((e=>e.id==this.userId));if(!o)throw new a.a(m.I.instant("addon.mod_lesson.cannotfinduser"));if(!o.attempts.length)throw new a.a(m.I.instant("addon.mod_lesson.cannotfindattempt"));o.bestgrade=l.a.roundToDecimals(o.bestgrade,2),o.attempts.forEach((e=>{this.selectedRetake||this.retakeNumber!=e.try||(this.selectedRetake=this.retakeNumber),e.label=p.a.getRetakeLabel(e)})),this.selectedRetake||(this.selectedRetake=o.attempts[o.attempts.length-1].try);const t=yield g.a.ignoreErrors(d.a.getProfile(o.id,this.courseId,!0));this.student=o,this.student.profileimageurl=null==t?void 0:t.profileimageurl,yield this.setRetake(this.selectedRetake)}catch(e){r.a.showErrorModalDefault(e,"Error getting data.",!0)}}))}refreshData(){return Object(s.a)(this,void 0,void 0,(function*(){const e=[];e.push(u.a.invalidateLessonData(this.courseId)),this.lesson&&(e.push(u.a.invalidateRetakesOverview(this.lesson.id)),e.push(u.a.invalidateUserRetakesForUser(this.lesson.id,this.userId))),yield g.a.ignoreErrors(Promise.all(e)),yield this.fetchData()}))}setRetake(e){return Object(s.a)(this,void 0,void 0,(function*(){this.selectedRetake=e;const n=yield u.a.getUserRetake(this.lesson.id,e,{cmId:this.cmId,userId:this.userId});this.retake=this.formatRetake(n),this.previousSelectedRetake=this.selectedRetake}))}formatRetake(e){const n=e;return n.userstats.gradeinfo&&(n.userstats.grade=l.a.roundToDecimals(n.userstats.grade,2),this.timeTakenReadable=f.a.formatTime(n.userstats.timetotake)),n.answerpages.forEach((e=>{var n,o;u.a.answerPageIsContent(e)?(e.isContent=!0,(null===(n=e.answerdata)||void 0===n?void 0:n.answers)&&e.answerdata.answers.forEach((e=>{e[0]=p.a.getContentPageAnswerDataFromHtml(e[0])}))):u.a.answerPageIsQuestion(e)&&(e.isQuestion=!0,(null===(o=e.answerdata)||void 0===o?void 0:o.answers)&&e.answerdata.answers.forEach((e=>{e[0]=p.a.getQuestionPageAnswerDataFromHtml(e[0])})))})),n}}return AddonModLessonUserRetakePage.ɵfac=function AddonModLessonUserRetakePage_Factory(e){return new(e||AddonModLessonUserRetakePage)},AddonModLessonUserRetakePage.ɵcmp=v.sc({type:AddonModLessonUserRetakePage,selectors:[["page-addon-mod-lesson-user-retake"]],decls:15,vars:12,consts:[["slot","start"],[3,"text"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["core-user-link","",1,"ion-text-wrap",3,"userId","courseId"],["slot","start",3,"user","userId","courseId","linkProfile"],["a11yText","addon.mod_lesson.grade",3,"progress"],["class","ion-text-wrap",4,"ngIf"],["class","addon-mod_lesson-userstats",4,"ngIf"],[1,"ion-text-wrap"],["interface","action-sheet",3,"ngModel","interfaceOptions","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"addon-mod_lesson-userstats"],[1,"ion-no-padding"],[1,"item-heading"],["class","addon-mod_lesson-answerpage",3,"ngClass",4,"ngFor","ngForOf"],[1,"addon-mod_lesson-answerpage",3,"ngClass"],["collapsible-item","","contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["class","addon-mod_lesson-answer",4,"ngIf"],[1,"addon-mod_lesson-answer"],[4,"ngFor","ngForOf"],["expand","block","fill","outline",1,"ion-text-wrap",3,"disabled"],[3,"innerHTML"],["class","ion-text-wrap",3,"ngClass",4,"ngIf"],[1,"ion-text-wrap",3,"ngClass"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["color","dark",4,"ngIf"],["slot","end",3,"ngModel","disabled"],["color","dark"]],template:function AddonModLessonUserRetakePage_Template(e,n){1&e&&(v.Ec(0,"ion-header"),v.Ec(1,"ion-toolbar"),v.Ec(2,"ion-buttons",0),v.zc(3,"ion-back-button",1),v.Pc(4,"translate"),v.Dc(),v.Ec(5,"ion-title"),v.Ec(6,"h1"),v.pd(7),v.Pc(8,"translate"),v.Dc(),v.Dc(),v.Dc(),v.Dc(),v.Ec(9,"ion-content",2),v.Ec(10,"ion-refresher",3),v.Mc("ionRefresh",(function AddonModLessonUserRetakePage_Template_ion_refresher_ionRefresh_10_listener(e){return n.doRefresh(e.target)})),v.zc(11,"ion-refresher-content",4),v.Pc(12,"translate"),v.Dc(),v.Ec(13,"core-loading",5),v.nd(14,AddonModLessonUserRetakePage_div_14_Template,11,13,"div",6),v.Dc(),v.Dc()),2&e&&(v.lc(3),v.Vc("text",v.Qc(4,6,"core.back")),v.lc(4),v.qd(v.Qc(8,8,"addon.mod_lesson.detailedstats")),v.lc(3),v.Vc("disabled",!n.loaded),v.lc(1),v.Wc("pullingText",v.Qc(12,10,"core.pulltorefresh")),v.lc(2),v.Vc("hideUntil",n.loaded),v.lc(1),v.Vc("ngIf",n.student))},directives:[h.C,h.Ab,h.m,h.h,h.i,h.yb,k.a,h.v,h.bb,h.cb,I.a,P.t,h.I,M.a,E.a,h.O,R.a,h.lb,h.Ob,D.r,D.u,P.s,h.mb,h.P,h.B,h.hb,h.u,h.n,P.q,h.p,h.r,b.a,L.a,A.a,h.l,h.s,h.d,h.k],pipes:[U.d,T.a],styles:["[_nghost-%COMP%]   .button-disabled[_ngcontent-%COMP%]{opacity:.4}[_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]{--background:var(--primary-tint)}[_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--primary-shade)}[_nghost-%COMP%]   .item-interactive-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{opacity:.5}"]}),AddonModLessonUserRetakePage})();const O=[{path:"",component:w}];let x=(()=>{class AddonModLessonUserRetakePageModule{}return AddonModLessonUserRetakePageModule.ɵmod=v.wc({type:AddonModLessonUserRetakePageModule}),AddonModLessonUserRetakePageModule.ɵinj=v.vc({factory:function AddonModLessonUserRetakePageModule_Factory(e){return new(e||AddonModLessonUserRetakePageModule)},imports:[[t.m.forChild(O),c.a],t.m]}),AddonModLessonUserRetakePageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&v.kd(x,{declarations:[w],imports:[t.m,c.a],exports:[t.m]}))}}]);