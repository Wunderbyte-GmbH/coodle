(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{Vuuv:function(e,n,t){"use strict";t.r(n),t.d(n,"AddonCalendarIndexPageModule",(function(){return Q}));var a=t("tyNb"),o=t("L3Fv"),i=t("9Xwr"),c=t("mrSG"),r=t("GGba"),d=t("fjkH"),s=t("9+EE"),l=t("3LXp"),h=t("ZSwf"),u=t("SmTL"),f=t("Lc7R"),_=t("+lfu"),m=t("n6RP"),g=t("j3ag"),p=t("Yxfl"),v=t("cD/T"),E=t("kLT3"),C=t("pHTc"),b=t("BaYo"),I=t("YyYz"),y=t("fXoL"),x=t("TEn/"),D=t("ACYt"),P=t("3CSS"),O=t("fQ68"),A=t("ofXK"),T=t("8/N+"),w=t("C1x5"),N=t("nt/U"),M=t("yNDK"),S=t("sYmb");function AddonCalendarIndexPage_core_context_menu_item_14_Template(e,n){if(1&e){const e=y.Fc();y.Ec(0,"core-context-menu-item",15),y.Mc("action",(function AddonCalendarIndexPage_core_context_menu_item_14_Template_core_context_menu_item_action_0_listener(){y.fd(e);return y.Oc().toggleDisplay()})),y.Pc(1,"translate"),y.Dc()}2&e&&y.Vc("priority",800)("content",y.Qc(1,2,"addon.calendar.upcomingevents"))}function AddonCalendarIndexPage_core_context_menu_item_15_Template(e,n){if(1&e){const e=y.Fc();y.Ec(0,"core-context-menu-item",16),y.Mc("action",(function AddonCalendarIndexPage_core_context_menu_item_15_Template_core_context_menu_item_action_0_listener(){y.fd(e);return y.Oc().toggleDisplay()})),y.Pc(1,"translate"),y.Dc()}2&e&&y.Vc("priority",800)("content",y.Qc(1,2,"addon.calendar.monthlyview"))}const _c0=function(e){return{$a:e}};function AddonCalendarIndexPage_ion_card_25_Template(e,n){1&e&&(y.Ec(0,"ion-card",17),y.Ec(1,"ion-item"),y.zc(2,"ion-icon",18),y.Ec(3,"ion-label"),y.pd(4),y.Pc(5,"translate"),y.Pc(6,"translate"),y.Dc(),y.Dc(),y.Dc()),2&e&&(y.lc(4),y.qd(y.Rc(5,1,"core.hasdatatosync",y.ad(6,_c0,y.Qc(6,4,"addon.calendar.calendar")))))}function AddonCalendarIndexPage_addon_calendar_upcoming_events_27_Template(e,n){if(1&e){const e=y.Fc();y.Ec(0,"addon-calendar-upcoming-events",19),y.Mc("onEventClicked",(function AddonCalendarIndexPage_addon_calendar_upcoming_events_27_Template_addon_calendar_upcoming_events_onEventClicked_0_listener(n){y.fd(e);return y.Oc().gotoEvent(n)})),y.Dc()}if(2&e){const e=y.Oc();y.Vc("hidden",e.showCalendar)("filter",e.filter)}}function AddonCalendarIndexPage_ion_fab_28_Template(e,n){if(1&e){const e=y.Fc();y.Ec(0,"ion-fab",20),y.Ec(1,"ion-fab-button",21),y.Mc("click",(function AddonCalendarIndexPage_ion_fab_28_Template_ion_fab_button_click_1_listener(){y.fd(e);return y.Oc().openEdit()})),y.Pc(2,"translate"),y.zc(3,"ion-icon",22),y.Ec(4,"span",23),y.pd(5),y.Pc(6,"translate"),y.Dc(),y.Dc(),y.Dc()}2&e&&(y.lc(1),y.mc("aria-label",y.Qc(2,2,"addon.calendar.newevent")),y.lc(4),y.qd(y.Qc(6,4,"addon.calendar.newevent")))}let k=(()=>{class AddonCalendarIndexPage{constructor(e){this.route=e,this.canCreate=!1,this.courses=[],this.loaded=!1,this.hasOffline=!1,this.isOnline=!1,this.syncIcon=b.a.ICON_LOADING,this.showCalendar=!0,this.loadUpcoming=!1,this.filter={filtered:!1,courseId:void 0,categoryId:void 0,course:!0,group:!0,site:!0,user:!0,category:!0},this.currentSiteId=s.b.getCurrentSiteId(),this.newEventObserver=d.b.on(u.c.NEW_EVENT_EVENT,(e=>{e&&e.eventId&&(this.loaded=!1,this.refreshData(!0,!1,!0))}),this.currentSiteId),this.discardedObserver=d.b.on(u.c.NEW_EVENT_DISCARDED_EVENT,(()=>{this.loaded=!1,this.refreshData(!0,!1,!0)}),this.currentSiteId),this.editEventObserver=d.b.on(u.c.EDIT_EVENT_EVENT,(e=>{e&&e.eventId&&(this.loaded=!1,this.refreshData(!0,!1,!0))}),this.currentSiteId),this.syncObserver=d.b.on(_.b.AUTO_SYNCED,(()=>{this.loaded=!1,this.refreshData(!1,!1,!0)}),this.currentSiteId),this.manualSyncObserver=d.b.on(_.b.MANUAL_SYNCED,(e=>{e&&"index"!=e.source&&(this.loaded=!1,this.refreshData(!1,!1,!0))}),this.currentSiteId),this.deleteEventObserver=d.b.on(u.c.DELETED_EVENT_EVENT,(()=>{this.loaded=!1,this.refreshData(!1,!1,!0)}),this.currentSiteId),this.undeleteEventObserver=d.b.on(u.c.UNDELETED_EVENT_EVENT,(()=>Object(c.a)(this,void 0,void 0,(function*(){this.hasOffline=yield f.a.hasOfflineData()}))),this.currentSiteId),this.filterChangedObserver=d.b.on(u.c.FILTER_CHANGED_EVENT,(e=>Object(c.a)(this,void 0,void 0,(function*(){this.filter=e,this.canCreate=yield m.b.canEditEvents(this.filter.courseId)})))),this.onlineObserver=r.a.onChange().subscribe((()=>{g.z.run((()=>{this.isOnline=r.a.isOnline()}))}))}ngOnInit(){this.loadUpcoming=!!C.a.getRouteBooleanParam("upcoming"),this.showCalendar=!this.loadUpcoming,this.route.queryParams.subscribe((()=>Object(c.a)(this,void 0,void 0,(function*(){this.filter.courseId=C.a.getRouteNumberParam("courseId"),this.year=C.a.getRouteNumberParam("year"),this.month=C.a.getRouteNumberParam("month"),this.filter.filtered=!!this.filter.courseId,this.fetchData(!0,!1),void 0!==this.year&&void 0!==this.month&&this.calendarComponent&&this.calendarComponent.viewMonth(this.month,this.year)}))));(new I.a).treatLink()}fetchData(e,n){return Object(c.a)(this,void 0,void 0,(function*(){if(this.syncIcon=b.a.ICON_LOADING,this.isOnline=r.a.isOnline(),e)try{const e=yield _.a.syncEvents();e.warnings&&e.warnings.length&&l.a.showErrorModal(e.warnings[0]),e.updated&&(e.source="index",d.b.trigger(_.b.MANUAL_SYNCED,e,this.currentSiteId))}catch(e){n&&l.a.showErrorModalDefault(e,"core.errorsync",!0)}try{const e=[];this.hasOffline=!1,e.push(h.a.getCoursesForPopover(this.filter.courseId).then((e=>{this.courses=e.courses}))),e.push(m.b.canEditEvents(this.filter.courseId).then((e=>{this.canCreate=e}))),e.push(f.a.hasOfflineData().then((e=>{this.hasOffline=e}))),yield Promise.all(e)}catch(e){l.a.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}this.loaded=!0,this.syncIcon=b.a.ICON_SYNC}))}doRefresh(e,n,t){return Object(c.a)(this,void 0,void 0,(function*(){this.loaded&&(yield this.refreshData(!0,t).finally((()=>{null==e?void 0:e.complete(),n&&n()})))}))}refreshData(e=!1,n=!1,t=!1){return Object(c.a)(this,void 0,void 0,(function*(){this.syncIcon=b.a.ICON_LOADING;const a=[];a.push(u.a.invalidateAllowedEventTypes()),this.showCalendar&&this.calendarComponent?a.push(this.calendarComponent.refreshData(t)):!this.showCalendar&&this.upcomingEventsComponent&&a.push(this.upcomingEventsComponent.refreshData()),yield Promise.all(a).finally((()=>this.fetchData(e,n)))}))}gotoEvent(e){C.a.navigateToSitePath(`/calendar/event/${e}`)}gotoDay(e){const n={day:e.day,month:e.month,year:e.year};Object.keys(this.filter).forEach((e=>{n[e]=this.filter[e]})),C.a.navigateToSitePath("/calendar/day",{params:n})}openFilter(){return Object(c.a)(this,void 0,void 0,(function*(){yield l.a.openSideModal({component:E.a,componentProps:{courses:this.courses,filter:this.filter}})}))}openEdit(e){const n={};e=e||0,this.filter.courseId&&(n.courseId=this.filter.courseId),C.a.navigateToSitePath(`/calendar/edit/${e}`,{params:n})}openSettings(){C.a.navigateToSitePath("/calendar/calendar-settings")}toggleDisplay(){this.showCalendar=!this.showCalendar,this.showCalendar||(this.loadUpcoming=!0)}ngOnDestroy(){var e,n,t,a,o,i,c,r,d;null===(e=this.newEventObserver)||void 0===e?void 0:e.off(),null===(n=this.discardedObserver)||void 0===n||n.off(),null===(t=this.editEventObserver)||void 0===t||t.off(),null===(a=this.deleteEventObserver)||void 0===a||a.off(),null===(o=this.undeleteEventObserver)||void 0===o||o.off(),null===(i=this.syncObserver)||void 0===i||i.off(),null===(c=this.manualSyncObserver)||void 0===c||c.off(),null===(r=this.filterChangedObserver)||void 0===r||r.off(),null===(d=this.onlineObserver)||void 0===d||d.unsubscribe()}}return AddonCalendarIndexPage.ɵfac=function AddonCalendarIndexPage_Factory(e){return new(e||AddonCalendarIndexPage)(y.yc(a.a))},AddonCalendarIndexPage.ɵcmp=y.sc({type:AddonCalendarIndexPage,selectors:[["page-addon-calendar-index"]],viewQuery:function AddonCalendarIndexPage_Query(e,n){var t;(1&e&&(y.ud(p.a,!0),y.ud(v.a,!0)),2&e)&&(y.dd(t=y.Nc())&&(n.calendarComponent=t.first),y.dd(t=y.Nc())&&(n.upcomingEventsComponent=t.first))},decls:29,vars:34,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","fas-filter","aria-hidden","true"],["iconAction","fas-th-list",3,"priority","content","action",4,"ngIf"],["iconAction","fas-calendar-alt",3,"priority","content","action",4,"ngIf"],["iconAction","fas-cogs",3,"priority","content","action"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["class","core-warning-card",4,"ngIf"],[3,"hidden","initialYear","initialMonth","filter","displayNavButtons","onEventClicked","onDayClicked"],[3,"hidden","filter","onEventClicked",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["iconAction","fas-th-list",3,"priority","content","action"],["iconAction","fas-calendar-alt",3,"priority","content","action"],[1,"core-warning-card"],["name","fas-exclamation-triangle","slot","start","aria-hidden","true"],[3,"hidden","filter","onEventClicked"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonCalendarIndexPage_Template(e,n){1&e&&(y.Ec(0,"ion-header"),y.Ec(1,"ion-toolbar"),y.Ec(2,"ion-buttons",0),y.zc(3,"ion-back-button",1),y.Pc(4,"translate"),y.Dc(),y.Ec(5,"ion-title"),y.Ec(6,"h1"),y.pd(7),y.Pc(8,"translate"),y.Dc(),y.Dc(),y.Ec(9,"ion-buttons",2),y.Ec(10,"ion-button",3),y.Mc("click",(function AddonCalendarIndexPage_Template_ion_button_click_10_listener(){return n.openFilter()})),y.Pc(11,"translate"),y.zc(12,"ion-icon",4),y.Dc(),y.Ec(13,"core-context-menu"),y.nd(14,AddonCalendarIndexPage_core_context_menu_item_14_Template,2,4,"core-context-menu-item",5),y.nd(15,AddonCalendarIndexPage_core_context_menu_item_15_Template,2,4,"core-context-menu-item",6),y.Ec(16,"core-context-menu-item",7),y.Mc("action",(function AddonCalendarIndexPage_Template_core_context_menu_item_action_16_listener(){return n.openSettings()})),y.Pc(17,"translate"),y.Dc(),y.Ec(18,"core-context-menu-item",8),y.Mc("action",(function AddonCalendarIndexPage_Template_core_context_menu_item_action_18_listener(e){return n.doRefresh(void 0,e,!0)})),y.Pc(19,"translate"),y.Dc(),y.Dc(),y.zc(20,"core-user-menu-button"),y.Dc(),y.Dc(),y.Dc(),y.Ec(21,"ion-content"),y.Ec(22,"ion-refresher",9),y.Mc("ionRefresh",(function AddonCalendarIndexPage_Template_ion_refresher_ionRefresh_22_listener(e){return n.doRefresh(e.target)})),y.zc(23,"ion-refresher-content",10),y.Pc(24,"translate"),y.Dc(),y.nd(25,AddonCalendarIndexPage_ion_card_25_Template,7,8,"ion-card",11),y.Ec(26,"addon-calendar-calendar",12),y.Mc("onEventClicked",(function AddonCalendarIndexPage_Template_addon_calendar_calendar_onEventClicked_26_listener(e){return n.gotoEvent(e)}))("onDayClicked",(function AddonCalendarIndexPage_Template_addon_calendar_calendar_onDayClicked_26_listener(e){return n.gotoDay(e)})),y.Dc(),y.nd(27,AddonCalendarIndexPage_addon_calendar_upcoming_events_27_Template,1,2,"addon-calendar-upcoming-events",13),y.nd(28,AddonCalendarIndexPage_ion_fab_28_Template,7,6,"ion-fab",14),y.Dc()),2&e&&(y.lc(3),y.Vc("text",y.Qc(4,22,"core.back")),y.lc(4),y.qd(y.Qc(8,24,n.showCalendar?"addon.calendar.calendarevents":"addon.calendar.upcomingevents")),y.lc(3),y.mc("aria-label",y.Qc(11,26,"core.filter")),y.lc(4),y.Vc("ngIf",n.showCalendar),y.lc(1),y.Vc("ngIf",!n.showCalendar),y.lc(1),y.Vc("priority",600)("content",y.Qc(17,28,"core.settings.settings")),y.lc(2),y.Vc("hidden",!n.loaded||!n.hasOffline||!n.isOnline)("priority",400)("content",y.Qc(19,30,"core.settings.synchronizenow"))("iconAction",n.syncIcon)("closeOnClick",!1),y.lc(4),y.Vc("disabled",!n.loaded),y.lc(1),y.Wc("pullingText",y.Qc(24,32,"core.pulltorefresh")),y.lc(2),y.Vc("ngIf",n.hasOffline),y.lc(1),y.Vc("hidden",!n.showCalendar)("initialYear",n.year)("initialMonth",n.month)("filter",n.filter)("displayNavButtons",n.showCalendar),y.lc(1),y.Vc("ngIf",n.loadUpcoming),y.lc(1),y.Vc("ngIf",n.canCreate))},directives:[x.C,x.Ab,x.m,x.h,x.i,x.yb,D.a,x.l,x.D,P.a,O.a,A.t,T.a,w.a,N.a,x.v,x.bb,x.cb,p.a,x.n,x.I,x.O,v.a,x.x,M.a,x.y],pipes:[S.d],encapsulation:2}),AddonCalendarIndexPage})();var V=t("dQ3M");const L=[{path:"",component:k}];let Q=(()=>{class AddonCalendarIndexPageModule{}return AddonCalendarIndexPageModule.ɵmod=y.wc({type:AddonCalendarIndexPageModule}),AddonCalendarIndexPageModule.ɵinj=y.vc({factory:function AddonCalendarIndexPageModule_Factory(e){return new(e||AddonCalendarIndexPageModule)},imports:[[a.m.forChild(L),o.a,i.a,V.a],a.m]}),AddonCalendarIndexPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&y.kd(Q,{declarations:[k],imports:[a.m,o.a,i.a,V.a],exports:[a.m]}))}}]);