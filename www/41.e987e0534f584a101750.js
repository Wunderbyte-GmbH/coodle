(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{YHcW:function(e,t,n){"use strict";n.r(t),n.d(t,"AddonCalendarEditEventPageModule",(function(){return $}));var o=n("tyNb"),i=n("L3Fv"),a=n("ekpb"),r=n("mrSG"),c=n("3Pt+"),d=n("fjkH"),l=n("mWdr"),s=n("9+EE"),m=n("uT8i"),u=n("3LXp"),p=n("Q98t"),_=n("bFG1"),f=n("Xzvb"),h=n("N5Lt"),E=n("SmTL"),g=n("Lc7R"),v=n("n6RP"),C=n("+lfu"),b=n("j3ag"),P=n("D2MD"),D=n("93ts"),y=n("pHTc"),T=n("4reR"),V=n("Pwmz"),I=n("9Pp1"),O=n("f0Wu"),A=n.n(O),w=n("nvXB"),Q=n("fXoL"),F=n("TEn/"),x=n("nt/U"),M=n("PgjG"),k=n("ofXK"),q=n("FasJ"),N=n("FTxb"),S=n("ACYt"),R=n("3CSS"),z=n("3jOR"),G=n("sYmb");const j=["editEventForm"];function AddonCalendarEditEventPage_form_14_p_23_Template(e,t){if(1&e&&(Q.Ec(0,"p",28),Q.pd(1),Q.Pc(2,"translate"),Q.Dc()),2&e){const e=Q.Oc(2);Q.lc(1),Q.qd(Q.Qc(2,1,e.eventTypes[0].name))}}function AddonCalendarEditEventPage_form_14_ion_select_24_ion_select_option_2_Template(e,t){if(1&e&&(Q.Ec(0,"ion-select-option",31),Q.pd(1),Q.Pc(2,"translate"),Q.Dc()),2&e){const e=t.$implicit;Q.Vc("value",e.value),Q.lc(1),Q.rd(" ",Q.Qc(2,2,e.name)," ")}}const _c1=function(e){return{header:e}};function AddonCalendarEditEventPage_form_14_ion_select_24_Template(e,t){if(1&e&&(Q.Ec(0,"ion-select",29),Q.Pc(1,"translate"),Q.nd(2,AddonCalendarEditEventPage_form_14_ion_select_24_ion_select_option_2_Template,3,4,"ion-select-option",30),Q.Dc()),2&e){const e=Q.Oc(2);Q.Vc("interfaceOptions",Q.ad(4,_c1,Q.Qc(1,2,"addon.calendar.eventkind"))),Q.lc(2),Q.Vc("ngForOf",e.eventTypes)}}function AddonCalendarEditEventPage_form_14_ion_item_25_ion_select_option_8_Template(e,t){if(1&e&&(Q.Ec(0,"ion-select-option",31),Q.pd(1),Q.Dc()),2&e){const e=t.$implicit;Q.Vc("value",e.id),Q.lc(1),Q.rd(" ",e.name," ")}}function AddonCalendarEditEventPage_form_14_ion_item_25_Template(e,t){if(1&e&&(Q.Ec(0,"ion-item",9),Q.Ec(1,"ion-label"),Q.Ec(2,"p",11),Q.pd(3),Q.Pc(4,"translate"),Q.Dc(),Q.Dc(),Q.Ec(5,"ion-select",32),Q.Pc(6,"translate"),Q.Pc(7,"translate"),Q.nd(8,AddonCalendarEditEventPage_form_14_ion_item_25_ion_select_option_8_Template,2,2,"ion-select-option",30),Q.Dc(),Q.Dc()),2&e){const e=Q.Oc(2);Q.lc(2),Q.Vc("core-mark-required",!0),Q.lc(1),Q.qd(Q.Qc(4,5,"core.category")),Q.lc(2),Q.Vc("placeholder",Q.Qc(6,7,"core.noselection"))("interfaceOptions",Q.ad(11,_c1,Q.Qc(7,9,"core.category"))),Q.lc(3),Q.Vc("ngForOf",e.categories)}}function AddonCalendarEditEventPage_form_14_ion_item_26_ion_select_option_8_Template(e,t){if(1&e&&(Q.Ec(0,"ion-select-option",31),Q.pd(1),Q.Dc()),2&e){const e=t.$implicit;Q.Vc("value",e.id),Q.lc(1),Q.qd(e.fullname)}}function AddonCalendarEditEventPage_form_14_ion_item_26_Template(e,t){if(1&e&&(Q.Ec(0,"ion-item",9),Q.Ec(1,"ion-label"),Q.Ec(2,"p",11),Q.pd(3),Q.Pc(4,"translate"),Q.Dc(),Q.Dc(),Q.Ec(5,"ion-select",33),Q.Pc(6,"translate"),Q.Pc(7,"translate"),Q.nd(8,AddonCalendarEditEventPage_form_14_ion_item_26_ion_select_option_8_Template,2,2,"ion-select-option",30),Q.Dc(),Q.Dc()),2&e){const e=Q.Oc(2);Q.lc(2),Q.Vc("core-mark-required",!0),Q.lc(1),Q.qd(Q.Qc(4,5,"core.course")),Q.lc(2),Q.Vc("placeholder",Q.Qc(6,7,"core.noselection"))("interfaceOptions",Q.ad(11,_c1,Q.Qc(7,9,"core.course"))),Q.lc(3),Q.Vc("ngForOf",e.courses)}}function AddonCalendarEditEventPage_form_14_ng_container_27_ion_select_option_9_Template(e,t){if(1&e&&(Q.Ec(0,"ion-select-option",31),Q.pd(1),Q.Dc()),2&e){const e=t.$implicit;Q.Vc("value",e.id),Q.lc(1),Q.rd(" ",e.fullname," ")}}function AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_10_Template(e,t){1&e&&(Q.Ec(0,"ion-item",37),Q.Ec(1,"ion-label"),Q.Ec(2,"p"),Q.pd(3),Q.Pc(4,"translate"),Q.Dc(),Q.Dc(),Q.Dc()),2&e&&(Q.lc(3),Q.qd(Q.Qc(4,1,"core.coursenogroups")))}function AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_11_ion_select_option_8_Template(e,t){if(1&e&&(Q.Ec(0,"ion-select-option",31),Q.pd(1),Q.Dc()),2&e){const e=t.$implicit;Q.Vc("value",e.id),Q.lc(1),Q.qd(e.name)}}function AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_11_Template(e,t){if(1&e&&(Q.Ec(0,"ion-item",38),Q.Ec(1,"ion-label"),Q.Ec(2,"p",11),Q.pd(3),Q.Pc(4,"translate"),Q.Dc(),Q.Dc(),Q.Ec(5,"ion-select",39),Q.Pc(6,"translate"),Q.Pc(7,"translate"),Q.nd(8,AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_11_ion_select_option_8_Template,2,2,"ion-select-option",30),Q.Dc(),Q.Dc()),2&e){const e=Q.Oc(3);Q.lc(2),Q.Vc("core-mark-required",!0),Q.lc(1),Q.qd(Q.Qc(4,5,"core.group")),Q.lc(2),Q.Vc("placeholder",Q.Qc(6,7,"core.noselection"))("interfaceOptions",Q.ad(11,_c1,Q.Qc(7,9,"core.group"))),Q.lc(3),Q.Vc("ngForOf",e.groups)}}function AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_12_ion_spinner_2_Template(e,t){1&e&&(Q.zc(0,"ion-spinner"),Q.Pc(1,"translate")),2&e&&Q.mc("aria-label",Q.Qc(1,1,"core.loading"))}function AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_12_Template(e,t){if(1&e&&(Q.Ec(0,"ion-item",9),Q.Ec(1,"ion-label"),Q.nd(2,AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_12_ion_spinner_2_Template,2,3,"ion-spinner",19),Q.Dc(),Q.Dc()),2&e){const e=Q.Oc(3);Q.lc(2),Q.Vc("ngIf",e.loadingGroups)}}function AddonCalendarEditEventPage_form_14_ng_container_27_Template(e,t){if(1&e){const e=Q.Fc();Q.Cc(0),Q.Ec(1,"ion-item",9),Q.Ec(2,"ion-label"),Q.Ec(3,"p",11),Q.pd(4),Q.Pc(5,"translate"),Q.Dc(),Q.Dc(),Q.Ec(6,"ion-select",34),Q.Mc("ionChange",(function AddonCalendarEditEventPage_form_14_ng_container_27_Template_ion_select_ionChange_6_listener(){Q.fd(e);return Q.Oc(2).groupCourseSelected()})),Q.Pc(7,"translate"),Q.Pc(8,"translate"),Q.nd(9,AddonCalendarEditEventPage_form_14_ng_container_27_ion_select_option_9_Template,2,2,"ion-select-option",30),Q.Dc(),Q.Dc(),Q.nd(10,AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_10_Template,5,3,"ion-item",35),Q.nd(11,AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_11_Template,9,13,"ion-item",36),Q.nd(12,AddonCalendarEditEventPage_form_14_ng_container_27_ion_item_12_Template,3,1,"ion-item",18),Q.Bc()}if(2&e){const e=Q.Oc(2);Q.lc(3),Q.Vc("core-mark-required",!0),Q.lc(1),Q.qd(Q.Qc(5,8,"core.course")),Q.lc(2),Q.Vc("placeholder",Q.Qc(7,10,"core.noselection"))("interfaceOptions",Q.ad(14,_c1,Q.Qc(8,12,"core.course"))),Q.lc(3),Q.Vc("ngForOf",e.courses),Q.lc(1),Q.Vc("ngIf",!e.loadingGroups&&e.courseGroupSet&&!e.groups.length),Q.lc(1),Q.Vc("ngIf",!e.loadingGroups&&e.groups.length>0),Q.lc(1),Q.Vc("ngIf",e.loadingGroups)}}function AddonCalendarEditEventPage_form_14_ng_container_28_ion_item_9_Template(e,t){if(1&e){const e=Q.Fc();Q.Ec(0,"ion-item",9),Q.Ec(1,"ion-label"),Q.Ec(2,"p"),Q.pd(3),Q.Dc(),Q.Dc(),Q.Ec(4,"ion-button",41),Q.Mc("click",(function AddonCalendarEditEventPage_form_14_ng_container_28_ion_item_9_Template_ion_button_click_4_listener(){Q.fd(e);const n=t.$implicit;return Q.Oc(3).removeReminder(n)})),Q.Pc(5,"translate"),Q.zc(6,"ion-icon",44),Q.Dc(),Q.Dc()}if(2&e){const e=t.$implicit;Q.lc(3),Q.qd(e.label),Q.lc(1),Q.mc("aria-label",Q.Qc(5,2,"core.delete"))}}function AddonCalendarEditEventPage_form_14_ng_container_28_Template(e,t){if(1&e){const e=Q.Fc();Q.Cc(0),Q.Ec(1,"ion-item-divider",40),Q.Ec(2,"ion-label"),Q.Ec(3,"p",23),Q.pd(4),Q.Pc(5,"translate"),Q.Dc(),Q.Dc(),Q.Ec(6,"ion-button",41),Q.Mc("click",(function AddonCalendarEditEventPage_form_14_ng_container_28_Template_ion_button_click_6_listener(){Q.fd(e);return Q.Oc(2).addReminder()})),Q.Pc(7,"translate"),Q.zc(8,"ion-icon",42),Q.Dc(),Q.Dc(),Q.nd(9,AddonCalendarEditEventPage_form_14_ng_container_28_ion_item_9_Template,7,4,"ion-item",43),Q.Bc()}if(2&e){const e=Q.Oc(2);Q.lc(4),Q.qd(Q.Qc(5,3,"addon.calendar.reminders")),Q.lc(2),Q.mc("aria-label",Q.Qc(7,5,"addon.calendar.setnewreminder")),Q.lc(3),Q.Vc("ngForOf",e.reminders)}}function AddonCalendarEditEventPage_form_14_ion_item_48_Template(e,t){if(1&e&&(Q.Ec(0,"ion-item"),Q.zc(1,"ion-label",10),Q.zc(2,"ion-datetime",45),Q.Pc(3,"translate"),Q.Dc()),2&e){const e=Q.Oc(2);Q.lc(2),Q.Vc("max",e.maxDate)("min",e.minDate)("placeholder",Q.Qc(3,5,"addon.calendar.durationuntil"))("displayFormat",e.dateFormat)("displayTimezone",e.displayTimezone)}}function AddonCalendarEditEventPage_form_14_ion_item_55_Template(e,t){1&e&&(Q.Ec(0,"ion-item"),Q.Ec(1,"ion-label",46),Q.pd(2),Q.Pc(3,"translate"),Q.Dc(),Q.zc(4,"ion-input",47),Q.Pc(5,"translate"),Q.Dc()),2&e&&(Q.lc(2),Q.qd(Q.Qc(3,2,"addon.calendar.durationminutes")),Q.lc(2),Q.Vc("placeholder",Q.Qc(5,4,"addon.calendar.durationminutes")))}function AddonCalendarEditEventPage_form_14_ng_container_56_Template(e,t){if(1&e&&(Q.Cc(0),Q.Ec(1,"ion-item",48),Q.Ec(2,"ion-label"),Q.Ec(3,"p",23),Q.pd(4),Q.Pc(5,"translate"),Q.Dc(),Q.Dc(),Q.zc(6,"ion-checkbox",49),Q.Dc(),Q.Ec(7,"ion-item",9),Q.Ec(8,"ion-label",10),Q.Ec(9,"p",23),Q.pd(10),Q.Pc(11,"translate"),Q.Dc(),Q.Dc(),Q.zc(12,"ion-input",50),Q.Dc(),Q.Bc()),2&e){const e=Q.Oc(2);Q.lc(4),Q.qd(Q.Qc(5,3,"addon.calendar.repeatevent")),Q.lc(6),Q.qd(Q.Qc(11,5,"addon.calendar.repeatweeksl")),Q.lc(2),Q.Vc("disabled",!e.form.controls.repeat.value)}}const _c2=function(e){return{$a:e}};function AddonCalendarEditEventPage_form_14_div_57_Template(e,t){if(1&e&&(Q.Ec(0,"div",20),Q.Ec(1,"ion-radio-group",51),Q.Ec(2,"ion-item-divider",22),Q.Ec(3,"ion-label"),Q.Ec(4,"p",23),Q.pd(5),Q.Pc(6,"translate"),Q.Dc(),Q.Dc(),Q.Dc(),Q.Ec(7,"ion-item"),Q.Ec(8,"ion-label"),Q.Ec(9,"p"),Q.pd(10),Q.Pc(11,"translate"),Q.Dc(),Q.Dc(),Q.zc(12,"ion-radio",52),Q.Dc(),Q.Ec(13,"ion-item"),Q.Ec(14,"ion-label"),Q.Ec(15,"p"),Q.pd(16),Q.Pc(17,"translate"),Q.Dc(),Q.Dc(),Q.zc(18,"ion-radio",53),Q.Dc(),Q.Dc(),Q.Dc()),2&e){const e=Q.Oc(2);Q.lc(5),Q.qd(Q.Qc(6,3,"addon.calendar.repeatedevents")),Q.lc(5),Q.qd(Q.Rc(11,5,"addon.calendar.repeateditall",Q.ad(10,_c2,e.otherEventsCount))),Q.lc(6),Q.qd(Q.Qc(17,8,"addon.calendar.repeateditthis"))}}function AddonCalendarEditEventPage_form_14_Template(e,t){if(1&e&&(Q.Ec(0,"form",7,8),Q.Ec(2,"ion-item",9),Q.Ec(3,"ion-label",10),Q.Ec(4,"p",11),Q.pd(5),Q.Pc(6,"translate"),Q.Dc(),Q.Dc(),Q.zc(7,"ion-input",12),Q.Pc(8,"translate"),Q.zc(9,"core-input-errors",13),Q.Dc(),Q.Ec(10,"ion-item",9),Q.Ec(11,"ion-label",10),Q.Ec(12,"p",11),Q.pd(13),Q.Pc(14,"translate"),Q.Dc(),Q.Dc(),Q.zc(15,"ion-datetime",14),Q.Pc(16,"translate"),Q.zc(17,"core-input-errors",13),Q.Dc(),Q.Ec(18,"ion-item",15),Q.Ec(19,"ion-label"),Q.Ec(20,"p",11),Q.pd(21),Q.Pc(22,"translate"),Q.Dc(),Q.Dc(),Q.nd(23,AddonCalendarEditEventPage_form_14_p_23_Template,3,3,"p",16),Q.nd(24,AddonCalendarEditEventPage_form_14_ion_select_24_Template,3,6,"ion-select",17),Q.Dc(),Q.nd(25,AddonCalendarEditEventPage_form_14_ion_item_25_Template,9,13,"ion-item",18),Q.nd(26,AddonCalendarEditEventPage_form_14_ion_item_26_Template,9,13,"ion-item",18),Q.nd(27,AddonCalendarEditEventPage_form_14_ng_container_27_Template,13,16,"ng-container",19),Q.nd(28,AddonCalendarEditEventPage_form_14_ng_container_28_Template,10,7,"ng-container",19),Q.Ec(29,"div",20),Q.Ec(30,"ion-radio-group",21),Q.Ec(31,"ion-item-divider",22),Q.Ec(32,"ion-label"),Q.Ec(33,"p",23),Q.pd(34),Q.Pc(35,"translate"),Q.Dc(),Q.Dc(),Q.Dc(),Q.Ec(36,"ion-item"),Q.Ec(37,"ion-label"),Q.Ec(38,"p"),Q.pd(39),Q.Pc(40,"translate"),Q.Dc(),Q.Dc(),Q.zc(41,"ion-radio",24),Q.Dc(),Q.Ec(42,"ion-item"),Q.Ec(43,"ion-label"),Q.Ec(44,"p"),Q.pd(45),Q.Pc(46,"translate"),Q.Dc(),Q.Dc(),Q.zc(47,"ion-radio",24),Q.Dc(),Q.nd(48,AddonCalendarEditEventPage_form_14_ion_item_48_Template,4,7,"ion-item",19),Q.Ec(49,"ion-item"),Q.Ec(50,"ion-label"),Q.Ec(51,"p"),Q.pd(52),Q.Pc(53,"translate"),Q.Dc(),Q.Dc(),Q.zc(54,"ion-radio",24),Q.Dc(),Q.nd(55,AddonCalendarEditEventPage_form_14_ion_item_55_Template,6,6,"ion-item",19),Q.Dc(),Q.Dc(),Q.nd(56,AddonCalendarEditEventPage_form_14_ng_container_56_Template,13,7,"ng-container",19),Q.nd(57,AddonCalendarEditEventPage_form_14_div_57_Template,19,12,"div",25),Q.Ec(58,"ion-item",9),Q.Ec(59,"ion-label",10),Q.Ec(60,"p",23),Q.pd(61),Q.Pc(62,"translate"),Q.Dc(),Q.Dc(),Q.zc(63,"core-rich-text-editor",26),Q.Pc(64,"translate"),Q.Pc(65,"translate"),Q.Dc(),Q.Ec(66,"ion-item",9),Q.Ec(67,"ion-label",10),Q.Ec(68,"p",23),Q.pd(69),Q.Pc(70,"translate"),Q.Dc(),Q.Dc(),Q.zc(71,"ion-input",27),Q.Pc(72,"translate"),Q.Dc(),Q.Dc()),2&e){const e=Q.Oc();Q.Vc("formGroup",e.form),Q.lc(4),Q.Vc("core-mark-required",!0),Q.lc(1),Q.qd(Q.Qc(6,43,"addon.calendar.eventname")),Q.lc(2),Q.Vc("placeholder",Q.Qc(8,45,"addon.calendar.eventname")),Q.lc(2),Q.Vc("control",e.form.controls.name)("errorMessages",e.errors),Q.lc(3),Q.Vc("core-mark-required",!0),Q.lc(1),Q.qd(Q.Qc(14,47,"core.date")),Q.lc(2),Q.Vc("placeholder",Q.Qc(16,49,"core.date"))("displayFormat",e.dateFormat)("max",e.maxDate)("min",e.minDate)("displayTimezone",e.displayTimezone),Q.lc(2),Q.Vc("control",e.form.controls.timestart)("errorMessages",e.errors),Q.lc(3),Q.Vc("core-mark-required",!0),Q.lc(1),Q.qd(Q.Qc(22,51,"addon.calendar.eventkind")),Q.lc(2),Q.Vc("ngIf",1==e.eventTypes.length),Q.lc(1),Q.Vc("ngIf",e.eventTypes.length>1),Q.lc(1),Q.Vc("ngIf","category"==e.typeControl.value),Q.lc(1),Q.Vc("ngIf","course"==e.typeControl.value),Q.lc(1),Q.Vc("ngIf","group"==e.typeControl.value),Q.lc(1),Q.Vc("ngIf",e.remindersEnabled&&!e.eventId),Q.lc(6),Q.qd(Q.Qc(35,53,"addon.calendar.eventduration")),Q.lc(5),Q.qd(Q.Qc(40,55,"addon.calendar.durationnone")),Q.lc(2),Q.Vc("value",0),Q.lc(4),Q.qd(Q.Qc(46,57,"addon.calendar.durationuntil")),Q.lc(2),Q.Vc("value",1),Q.lc(1),Q.Vc("ngIf",1===e.form.controls.duration.value),Q.lc(4),Q.qd(Q.Qc(53,59,"addon.calendar.durationminutes")),Q.lc(2),Q.Vc("value",2),Q.lc(1),Q.Vc("ngIf",2===e.form.controls.duration.value),Q.lc(1),Q.Vc("ngIf",!e.eventId||e.eventId<0),Q.lc(1),Q.Vc("ngIf",e.eventRepeatId),Q.lc(4),Q.qd(Q.Qc(62,61,"core.description")),Q.lc(2),Q.Vc("control",e.descriptionControl)("placeholder",Q.Qc(65,65,"core.description"))("component",e.component)("componentId",e.eventId)("autoSave",!1),Q.mc("aria-label",Q.Qc(64,63,"core.description")),Q.lc(6),Q.qd(Q.Qc(70,67,"core.location")),Q.lc(2),Q.Vc("placeholder",Q.Qc(72,69,"core.location"))}}function AddonCalendarEditEventPage_div_15_ion_button_2_Template(e,t){if(1&e){const e=Q.Fc();Q.Ec(0,"ion-button",58),Q.Mc("click",(function AddonCalendarEditEventPage_div_15_ion_button_2_Template_ion_button_click_0_listener(){Q.fd(e);return Q.Oc(2).discard()})),Q.pd(1),Q.Pc(2,"translate"),Q.Dc()}2&e&&(Q.lc(1),Q.rd(" ",Q.Qc(2,1,"core.discard")," "))}function AddonCalendarEditEventPage_div_15_Template(e,t){if(1&e){const e=Q.Fc();Q.Ec(0,"div",54),Q.Ec(1,"div",55),Q.nd(2,AddonCalendarEditEventPage_div_15_ion_button_2_Template,3,3,"ion-button",56),Q.Ec(3,"ion-button",57),Q.Mc("click",(function AddonCalendarEditEventPage_div_15_Template_ion_button_click_3_listener(){Q.fd(e);return Q.Oc().submit()})),Q.pd(4),Q.Pc(5,"translate"),Q.Dc(),Q.Dc(),Q.Dc()}if(2&e){const e=Q.Oc();Q.lc(2),Q.Vc("ngIf",e.hasOffline&&e.eventId&&e.eventId<0),Q.lc(1),Q.Vc("disabled",!e.form.valid),Q.lc(1),Q.rd(" ",Q.Qc(5,3,"core.save")," ")}}let L=(()=>{class AddonCalendarEditEventPage{constructor(e){this.fb=e,this.title="addon.calendar.newevent",this.component=E.c.COMPONENT,this.loaded=!1,this.hasOffline=!1,this.eventTypes=[],this.categories=[],this.courses=[],this.groups=[],this.loadingGroups=!1,this.courseGroupSet=!1,this.error=!1,this.otherEventsCount=0,this.remindersEnabled=!1,this.reminders=[],this.types={},this.showAll=!1,this.isDestroyed=!1,this.gotEventData=!1,this.currentSite=s.b.getRequiredCurrentSite(),this.remindersEnabled=V.a.isEnabled(),this.errors={required:b.I.instant("core.required")},this.dateFormat=p.a.convertPHPToMoment(b.I.instant("core.strftimedatetimeshort")).replace(/[[\]]/g,""),this.displayTimezone=w.b.getForcedTimezone(),this.form=new c.j({}),this.typeControl=this.fb.control("",c.F.required),this.groupControl=this.fb.control(""),this.descriptionControl=this.fb.control(""),this.form.addControl("name",this.fb.control("",c.F.required)),this.form.addControl("eventtype",this.typeControl),this.form.addControl("categoryid",this.fb.control("")),this.form.addControl("groupcourseid",this.fb.control("")),this.form.addControl("groupid",this.groupControl),this.form.addControl("description",this.descriptionControl),this.form.addControl("location",this.fb.control("")),this.form.addControl("duration",this.fb.control(0)),this.form.addControl("timedurationminutes",this.fb.control("")),this.form.addControl("repeat",this.fb.control(!1)),this.form.addControl("repeats",this.fb.control("1")),this.form.addControl("repeateditall",this.fb.control(1)),this.maxDate=p.a.getDatetimeDefaultMax(),this.minDate=p.a.getDatetimeDefaultMin()}ngOnInit(){this.eventId=y.a.getRouteNumberParam("eventId")||void 0,this.courseId=y.a.getRouteNumberParam("courseId")||0,this.title=this.eventId?"addon.calendar.editevent":"addon.calendar.newevent";const e=y.a.getRouteNumberParam("timestamp"),t=p.a.toDatetimeFormat(e);this.form.addControl("timestart",this.fb.control(t,c.F.required)),this.form.addControl("timedurationuntil",this.fb.control(t)),this.form.addControl("courseid",this.fb.control(this.courseId)),this.initReminders(),this.fetchData().finally((()=>{this.originalData=_.a.clone(this.form.value),this.loaded=!0}))}fetchData(){return Object(r.a)(this,void 0,void 0,(function*(){this.error=!1;try{const[e,t]=yield Promise.all([E.a.getAllowedEventTypes(this.courseId),_.a.ignoreErrors(E.a.getAccessInformation(this.courseId),{canmanageentries:!1,canmanageownentries:!1,canmanagegroupentries:!1})]);this.types=e;const n=[],o=v.b.getEventTypeOptions(this.types);if(!o.length)throw new D.a(b.I.instant("addon.calendar.nopermissiontoupdatecalendar"));if(this.eventId&&!this.gotEventData){const e=this.eventId;n.push(C.a.waitForSync(C.b.SYNC_ID).then((()=>Object(r.a)(this,void 0,void 0,(function*(){let t;!this.isDestroyed&&this.eventId&&m.a.blockOperation(E.c.COMPONENT,e);try{t=yield g.a.getEvent(e),this.hasOffline=!0}catch(e){this.hasOffline=!1}if(e>0){const n=yield E.a.getEventById(e);t||(t=n),this.eventRepeatId=null==n?void 0:n.repeatid,this.eventRepeatId&&(this.otherEventsCount=n.eventcount?n.eventcount-1:0)}if(this.gotEventData=!0,t)return this.loadEventData(t,this.hasOffline)})))))}this.types.category&&n.push(this.fetchCategories()),this.showAll=_.a.isTrueOrOne(this.currentSite.getStoredConfig("calendar_adminseesall"))&&t.canmanageentries,(this.types.course||this.types.groups)&&n.push(this.fetchCourses()),yield Promise.all(n),this.typeControl.value||this.typeControl.setValue(this.types.course?E.b.COURSE:o[0].value),this.eventTypes=o}catch(e){u.a.showErrorModalDefault(e,"Error getting data."),this.error=!0}}))}fetchCategories(){return Object(r.a)(this,void 0,void 0,(function*(){this.categories=yield f.a.getCategories(0,!0)}))}fetchCourses(){return Object(r.a)(this,void 0,void 0,(function*(){let e=yield this.showAll?f.a.getCoursesByField():f.a.getUserCourses();if(e.length<0)return this.courses=[],void 0;const courseFillFullname=e=>Object(r.a)(this,void 0,void 0,(function*(){try{const t=yield P.a.getFiltersAndFormatText(e.fullname,"course",e.id);e.fullname=t.text}catch(e){}}));if(this.showAll){const t=s.b.getCurrentSiteHomeId();e=("contacts"in e[0],e.filter((e=>e.id!=t)))}"contacts"in e[0],yield Promise.all(e.map(courseFillFullname)),this.courses=e.sort(((e,t)=>{const n=e.fullname.toLowerCase(),o=t.fullname.toLowerCase();return n.localeCompare(o)}))}))}loadEventData(e,t){var n;return Object(r.a)(this,void 0,void 0,(function*(){if(!e)return;const o=e,i=e,a=t?o.courseid:null===(n=i.course)||void 0===n?void 0:n.id;this.form.controls.name.setValue(e.name),this.form.controls.timestart.setValue(p.a.toDatetimeFormat(1e3*e.timestart)),this.form.controls.eventtype.setValue(e.eventtype),this.form.controls.categoryid.setValue(e.categoryid||""),this.form.controls.courseid.setValue(a||""),this.form.controls.groupcourseid.setValue(a||""),this.form.controls.groupid.setValue(e.groupid||""),this.form.controls.description.setValue(e.description),this.form.controls.location.setValue(e.location),t?(this.form.controls.duration.setValue(o.duration),this.form.controls.timedurationuntil.setValue(p.a.toDatetimeFormat(1e3*(o.timedurationuntil||0)||Date.now())),this.form.controls.timedurationminutes.setValue(o.timedurationminutes||""),this.form.controls.repeat.setValue(!!o.repeat),this.form.controls.repeats.setValue(o.repeats||"1"),this.form.controls.repeateditall.setValue(o.repeateditall||1)):(i.timeduration>0?(this.form.controls.duration.setValue(1),this.form.controls.timedurationuntil.setValue(p.a.toDatetimeFormat(1e3*(i.timestart+i.timeduration)))):(this.form.controls.duration.setValue(0),this.form.controls.timedurationuntil.setValue(p.a.toDatetimeFormat())),this.form.controls.timedurationminutes.setValue(""),this.form.controls.repeat.setValue(!!i.repeatid),this.form.controls.repeats.setValue(i.eventcount||"1"),this.form.controls.repeateditall.setValue(1)),e.eventtype==E.b.GROUP&&a&&(yield this.loadGroups(a))}))}refreshData(e){const t=[E.a.invalidateAccessInformation(this.courseId),E.a.invalidateAllowedEventTypes(this.courseId)];this.types&&(this.types.category&&t.push(f.a.invalidateCategories(0,!0)),(this.types.course||this.types.groups)&&t.push(this.showAll?f.a.invalidateCoursesByField():f.a.invalidateUserCourses())),Promise.all(t).finally((()=>{this.fetchData().finally((()=>{null==e?void 0:e.complete()}))}))}groupCourseSelected(){return Object(r.a)(this,void 0,void 0,(function*(){const e=this.form.controls.groupcourseid.value;if(!e)return;const t=yield u.a.showModalLoading();try{yield this.loadGroups(e),this.groupControl.setValue("")}catch(e){u.a.showErrorModalDefault(e,"Error getting data.")}t.dismiss()}))}loadGroups(e){return Object(r.a)(this,void 0,void 0,(function*(){this.loadingGroups=!0;try{this.groups=yield l.a.getUserGroupsInCourse(e),this.courseGroupSet=!0}finally{this.loadingGroups=!1}}))}selectDuration(e){this.form.controls.duration.setValue(e)}submit(){return Object(r.a)(this,void 0,void 0,(function*(){const e=this.form.value,t=A()(e.timestart).unix(),n=A()(e.timedurationuntil).unix(),o=parseInt(e.timedurationminutes||"",10);let i;if((e.eventtype!==E.b.COURSE||e.courseid)&&(e.eventtype!==E.b.GROUP||e.groupcourseid)?e.eventtype!==E.b.GROUP||e.groupid?e.eventtype!==E.b.CATEGORY||e.categoryid?1===e.duration&&t>n?i="addon.calendar.invalidtimedurationuntil":2===e.duration&&(isNaN(o)||o<1)&&(i="addon.calendar.invalidtimedurationminutes"):i="core.selectacategory":i="core.selectagroup":i="core.selectacourse",i)return u.a.showErrorModal(b.I.instant(i)),void 0;const a={name:e.name,eventtype:e.eventtype,timestart:t,description:{text:e.description||"",format:1,itemid:0},location:e.location,duration:e.duration,repeat:e.repeat};e.eventtype==E.b.COURSE?a.courseid=e.courseid:e.eventtype==E.b.GROUP?(a.groupcourseid=e.groupcourseid,a.groupid=e.groupid):e.eventtype==E.b.CATEGORY&&(a.categoryid=e.categoryid),1==e.duration?a.timedurationuntil=n:2==e.duration&&(a.timedurationminutes=e.timedurationminutes),e.repeat&&(a.repeats=Number(e.repeats)),this.eventRepeatId&&(a.repeatid=this.eventRepeatId,a.repeateditall=e.repeateditall);const r=yield u.a.showModalLoading("core.sending",!0);let c;try{const t=yield E.a.submitEvent(this.eventId,a,{reminders:this.eventId?[]:this.reminders});if(c=t.event,T.a.triggerFormSubmittedEvent(this.formElement,t.sent,this.currentSite.getId()),t.sent){const n=e.repeat?e.repeats:a.repeateditall&&this.otherEventsCount?this.otherEventsCount+1:1;try{yield v.b.refreshAfterChangeEvent(t.event,n)}catch(e){}}this.returnToList(c)}catch(i){u.a.showErrorModalDefault(i,"Error sending data.")}r.dismiss()}))}returnToList(e){this.unblockSync(),this.eventId&&this.eventId>0?d.b.trigger(E.c.EDIT_EVENT_EVENT,{eventId:this.eventId},this.currentSite.getId()):e?d.b.trigger(E.c.NEW_EVENT_EVENT,{eventId:e.id,oldEventId:this.eventId},this.currentSite.getId()):d.b.trigger(E.c.NEW_EVENT_DISCARDED_EVENT,{},this.currentSite.getId()),this.originalData=void 0,y.a.back()}discard(){return Object(r.a)(this,void 0,void 0,(function*(){if(this.eventId)try{yield u.a.showConfirm(b.I.instant("core.areyousure"));try{yield g.a.deleteEvent(this.eventId),T.a.triggerFormCancelledEvent(this.formElement,this.currentSite.getId()),this.returnToList()}catch(e){u.a.showErrorModal("Error discarding event.")}}catch(e){}}))}canLeave(){return Object(r.a)(this,void 0,void 0,(function*(){return v.b.hasEventDataChanged(this.form.value,this.originalData)&&(yield u.a.showConfirm(b.I.instant("core.confirmcanceledit"))),T.a.triggerFormCancelledEvent(this.formElement,this.currentSite.getId()),!0}))}unblockSync(){this.eventId&&m.a.unblockOperation(E.c.COMPONENT,this.eventId)}initReminders(){return Object(r.a)(this,void 0,void 0,(function*(){if(!this.remindersEnabled||this.eventId)return;const e=yield V.a.getDefaultNotificationTime(this.currentSite.getId());if(e===V.b.DISABLED)return;const t=V.b.convertSecondsToValueAndUnit(e);this.reminders.push({value:t.value,unit:t.unit,label:V.a.getUnitValueLabel(t.value,t.unit,!0)})}))}addReminder(){return Object(r.a)(this,void 0,void 0,(function*(){const e=p.a.convertToTimestamp(this.form.value.timestart,!0),t=yield u.a.openPopover({component:I.a,componentProps:{eventTime:e}});if(void 0===t)return;const n=V.b.convertSecondsToValueAndUnit(t.timeBefore);this.reminders.push({time:t.timeBefore,value:n.value,unit:n.unit,label:V.a.getUnitValueLabel(n.value,n.unit)})}))}removeReminder(e){const t=this.reminders.indexOf(e);-1!==t&&this.reminders.splice(t,1)}ngOnDestroy(){this.unblockSync(),this.isDestroyed=!0}}return AddonCalendarEditEventPage.ɵfac=function AddonCalendarEditEventPage_Factory(e){return new(e||AddonCalendarEditEventPage)(Q.yc(c.f))},AddonCalendarEditEventPage.ɵcmp=Q.sc({type:AddonCalendarEditEventPage,selectors:[["page-addon-calendar-edit-event"]],viewQuery:function AddonCalendarEditEventPage_Query(e,t){var n;(1&e&&(Q.ud(h.a,!0),Q.ud(j,!0)),2&e)&&(Q.dd(n=Q.Nc())&&(t.descriptionEditor=n.first),Q.dd(n=Q.Nc())&&(t.formElement=n.first))},decls:16,vars:13,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[3,"formGroup",4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],[3,"formGroup"],["editEventForm",""],[1,"ion-text-wrap"],["position","stacked"],[1,"item-heading",3,"core-mark-required"],["type","text","name","name","formControlName","name",3,"placeholder"],[3,"control","errorMessages"],["formControlName","timestart",3,"placeholder","displayFormat","max","min","displayTimezone"],[1,"ion-text-wrap","addon-calendar-eventtype-container"],["slot","end",4,"ngIf"],["formControlName","eventtype","interface","action-sheet",3,"interfaceOptions",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],[4,"ngIf"],[1,"ion-text-wrap","addon-calendar-radio-container"],["formControlName","duration"],[1,"addon-calendar-radio-title"],[1,"item-heading"],["slot","end",3,"value"],["class","ion-text-wrap addon-calendar-radio-container",4,"ngIf"],["name","description",3,"control","placeholder","component","componentId","autoSave"],["type","text","name","location","formControlName","location",3,"placeholder"],["slot","end"],["formControlName","eventtype","interface","action-sheet",3,"interfaceOptions"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","categoryid","interface","action-sheet",3,"placeholder","interfaceOptions"],["formControlName","courseid","interface","action-sheet",3,"placeholder","interfaceOptions"],["formControlName","groupcourseid","interface","action-sheet",3,"placeholder","interfaceOptions","ionChange"],["class","ion-text-wrap core-danger-item",4,"ngIf"],["class","ion-text-wrap core-edit-set-group",4,"ngIf"],[1,"ion-text-wrap","core-danger-item"],[1,"ion-text-wrap","core-edit-set-group"],["formControlName","groupid","interface","action-sheet",3,"placeholder","interfaceOptions"],[1,"addon-calendar-reminders-title"],["fill","clear","slot","end",3,"click"],["name","fas-plus","slot","icon-only","aria-hidden","true"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["name","fas-trash","color","danger","slot","icon-only","aria-hidden","true"],["formControlName","timedurationuntil",3,"max","min","placeholder","displayFormat","displayTimezone"],[1,"sr-only"],["type","number","name","timedurationminutes","slot","end","formControlName","timedurationminutes",3,"placeholder"],[1,"ion-text-wrap","divider"],["slot","end","formControlName","repeat"],["type","number","name","repeats","formControlName","repeats",3,"disabled"],["formControlName","repeateditall"],["slot","end","value","1"],["slot","end","value","0"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"list-item-limited-width","adaptable-buttons-row"],["expand","block","fill","outline","class","ion-margin ion-text-wrap",3,"click",4,"ngIf"],["expand","block","type","submit",1,"ion-margin","ion-text-wrap",3,"disabled","click"],["expand","block","fill","outline",1,"ion-margin","ion-text-wrap",3,"click"]],template:function AddonCalendarEditEventPage_Template(e,t){1&e&&(Q.Ec(0,"ion-header"),Q.Ec(1,"ion-toolbar"),Q.Ec(2,"ion-buttons",0),Q.zc(3,"ion-back-button",1),Q.Pc(4,"translate"),Q.Dc(),Q.Ec(5,"ion-title"),Q.Ec(6,"h1"),Q.pd(7),Q.Pc(8,"translate"),Q.Dc(),Q.Dc(),Q.Dc(),Q.Dc(),Q.Ec(9,"ion-content"),Q.Ec(10,"ion-refresher",2),Q.Mc("ionRefresh",(function AddonCalendarEditEventPage_Template_ion_refresher_ionRefresh_10_listener(e){return t.refreshData(e.target)})),Q.zc(11,"ion-refresher-content",3),Q.Pc(12,"translate"),Q.Dc(),Q.Ec(13,"core-loading",4),Q.nd(14,AddonCalendarEditEventPage_form_14_Template,73,71,"form",5),Q.nd(15,AddonCalendarEditEventPage_div_15_Template,6,5,"div",6),Q.Dc(),Q.Dc()),2&e&&(Q.lc(3),Q.Vc("text",Q.Qc(4,7,"core.back")),Q.lc(4),Q.qd(Q.Qc(8,9,t.title)),Q.lc(3),Q.Vc("disabled",!t.loaded),Q.lc(1),Q.Wc("pullingText",Q.Qc(12,11,"core.pulltorefresh")),Q.lc(2),Q.Vc("hideUntil",t.loaded),Q.lc(1),Q.Vc("ngIf",!t.error),Q.lc(1),Q.Vc("ngIf",t.loaded&&!t.error))},directives:[F.C,F.Ab,F.m,F.h,F.i,F.yb,x.a,F.v,F.bb,F.cb,M.a,k.t,c.H,c.s,c.k,F.I,F.O,q.a,F.H,F.Pb,c.r,c.i,N.a,F.w,F.Ob,F.Z,F.J,F.Y,F.Mb,h.a,F.lb,k.s,F.mb,F.qb,S.a,F.l,F.D,R.a,F.Jb,F.s,F.d,z.a],pipes:[G.d],styles:["[_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{opacity:1}[_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]::part(icon){display:none}"]}),AddonCalendarEditEventPage})();var U=n("MLi9");const B=[{path:"",component:L,canDeactivate:[U.a]}];let $=(()=>{class AddonCalendarEditEventPageModule{}return AddonCalendarEditEventPageModule.ɵmod=Q.wc({type:AddonCalendarEditEventPageModule}),AddonCalendarEditEventPageModule.ɵinj=Q.vc({factory:function AddonCalendarEditEventPageModule_Factory(e){return new(e||AddonCalendarEditEventPageModule)},imports:[[o.m.forChild(B),i.a,a.a],o.m]}),AddonCalendarEditEventPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&Q.kd($,{declarations:[L],imports:[o.m,i.a,a.a],exports:[o.m]}))}}]);