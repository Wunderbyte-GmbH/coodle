(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{"+T7f":function(e,s,t){"use strict";t.r(s),t.d(s,"AddonMessagesSearchPageModule",(function(){return R}));var n=t("tyNb"),a=t("Y+03"),c=t("vY5A"),o=t("muSn"),i=t("L3Fv"),r=t("PM4H"),l=t("mrSG"),g=t("fjkH"),_=t("9+EE"),d=t("KMk0"),h=t("3LXp"),m=t("nvXB"),u=t("pHTc"),p=t("46ml"),M=t("fXoL"),f=t("TEn/"),S=t("fQ68"),P=t("nt/U"),b=t("9zps"),A=t("PgjG"),T=t("ofXK"),v=t("xpMl"),E=t("r8G5"),y=t("FeAf"),C=t("hMzs"),I=t("3CSS"),O=t("ACYt"),k=t("sYmb"),x=t("Cg42");function AddonMessagesSearchPage_ion_list_16_ng_container_1_Template(e,s){1&e&&M.Ac(0)}function AddonMessagesSearchPage_ion_list_16_ng_container_2_Template(e,s){1&e&&M.Ac(0)}function AddonMessagesSearchPage_ion_list_16_ng_container_3_Template(e,s){1&e&&M.Ac(0)}const _c0=function(e){return{item:e}};function AddonMessagesSearchPage_ion_list_16_Template(e,s){if(1&e){const e=M.Fc();M.Ec(0,"ion-list"),M.nd(1,AddonMessagesSearchPage_ion_list_16_ng_container_1_Template,1,0,"ng-container",8),M.nd(2,AddonMessagesSearchPage_ion_list_16_ng_container_2_Template,1,0,"ng-container",8),M.nd(3,AddonMessagesSearchPage_ion_list_16_ng_container_3_Template,1,0,"ng-container",8),M.Ec(4,"core-infinite-loading",9),M.Mc("action",(function AddonMessagesSearchPage_ion_list_16_Template_core_infinite_loading_action_4_listener(s){M.fd(e);const t=M.Oc();return t.search(t.query,"messages",s)})),M.Dc(),M.Dc()}if(2&e){const e=M.Oc(),s=M.ed(19);M.lc(1),M.Vc("ngTemplateOutlet",s)("ngTemplateOutletContext",M.ad(8,_c0,e.contacts)),M.lc(1),M.Vc("ngTemplateOutlet",s)("ngTemplateOutletContext",M.ad(10,_c0,e.nonContacts)),M.lc(1),M.Vc("ngTemplateOutlet",s)("ngTemplateOutletContext",M.ad(12,_c0,e.messages)),M.lc(1),M.Vc("enabled",e.messages.canLoadMore)("error",e.messages.loadMoreError)}}function AddonMessagesSearchPage_core_empty_box_17_Template(e,s){1&e&&(M.zc(0,"core-empty-box",10),M.Pc(1,"translate")),2&e&&M.Vc("message",M.Qc(1,1,"core.noresults"))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_icon_5_Template(e,s){1&e&&(M.zc(0,"ion-icon",21),M.Pc(1,"translate")),2&e&&M.mc("aria-label",M.Qc(1,1,"addon.messages.contactblocked"))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_note_6_Template(e,s){if(1&e&&(M.Ec(0,"ion-note"),M.pd(1),M.Pc(2,"coreDateDayOrTime"),M.Dc()),2&e){const e=M.Oc().$implicit;M.lc(1),M.rd(" ",M.Qc(2,1,e.lastmessagedate)," ")}}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_span_8_Template(e,s){1&e&&(M.Ec(0,"span",22),M.pd(1),M.Pc(2,"translate"),M.Dc()),2&e&&(M.lc(1),M.rd(" ",M.Qc(2,1,"addon.messages.you")," "))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_Template(e,s){if(1&e){const e=M.Fc();M.Ec(0,"ion-item",13),M.Mc("click",(function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_Template_ion_item_click_0_listener(){M.fd(e);const t=s.$implicit;return M.Oc(3).openConversation(t)})),M.zc(1,"core-user-avatar",14),M.Ec(2,"ion-label"),M.Ec(3,"p",15),M.zc(4,"core-format-text",16),M.nd(5,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_icon_5_Template,2,3,"ion-icon",17),M.Dc(),M.nd(6,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_note_6_Template,3,3,"ion-note",5),M.Ec(7,"p",18),M.nd(8,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_span_8_Template,3,3,"span",19),M.zc(9,"core-format-text",20),M.Dc(),M.Dc(),M.Dc()}if(2&e){const e=s.$implicit,t=M.Oc(3);M.mc("aria-label",e.fullname)("aria-current",e==t.selectedResult?"page":"false"),M.lc(1),M.Vc("user",e)("checkOnline",!0)("linkProfile",!1),M.lc(3),M.Vc("text",e.fullname)("highlight",e.highlightName)("filter",!1),M.lc(1),M.Vc("ngIf",e.isblocked),M.lc(1),M.Vc("ngIf",e.lastmessagedate>0),M.lc(2),M.Vc("ngIf",e.sentfromcurrentuser),M.lc(1),M.Vc("text",e.lastmessage)("highlight",e.highlightMessage)("contextInstanceId",0)}}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_1_Template(e,s){if(1&e){const e=M.Fc();M.Ec(0,"div",25),M.Ec(1,"ion-button",26),M.Mc("click",(function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_1_Template_ion_button_click_1_listener(){M.fd(e);const s=M.Oc(3).item,t=M.Oc();return t.search(t.query,s.type)})),M.pd(2),M.Pc(3,"translate"),M.Dc(),M.Dc()}2&e&&(M.lc(2),M.rd(" ",M.Qc(3,1,"core.loadmore")," "))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_2_Template(e,s){1&e&&(M.Ec(0,"div",27),M.zc(1,"ion-spinner"),M.Pc(2,"translate"),M.Dc()),2&e&&(M.lc(1),M.mc("aria-label",M.Qc(2,1,"core.loading")))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_Template(e,s){if(1&e&&(M.Cc(0),M.nd(1,AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_1_Template,4,3,"div",23),M.nd(2,AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_2_Template,3,3,"div",24),M.Bc()),2&e){const e=M.Oc(2).item;M.lc(1),M.Vc("ngIf",e.canLoadMore&&!e.loadingMore),M.lc(1),M.Vc("ngIf",e.loadingMore)}}function AddonMessagesSearchPage_ng_template_18_ng_container_0_Template(e,s){if(1&e&&(M.Cc(0),M.Ec(1,"ion-item-divider",11),M.Ec(2,"ion-label"),M.Ec(3,"h2"),M.pd(4),M.Pc(5,"translate"),M.Dc(),M.Dc(),M.Dc(),M.nd(6,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_Template,10,14,"ion-item",12),M.nd(7,AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_Template,3,2,"ng-container",5),M.Bc()),2&e){const e=M.Oc().item;M.lc(4),M.qd(M.Qc(5,3,e.titleString)),M.lc(2),M.Vc("ngForOf",e.results),M.lc(1),M.Vc("ngIf","messages"!=e.type)}}function AddonMessagesSearchPage_ng_template_18_Template(e,s){if(1&e&&M.nd(0,AddonMessagesSearchPage_ng_template_18_ng_container_0_Template,8,5,"ng-container",5),2&e){M.Vc("ngIf",s.item.results.length>0)}}let D=(()=>{class AddonMessagesSearchPage{constructor(){this.disableSearch=!1,this.displaySearching=!1,this.displayResults=!1,this.query="",this.contacts={type:"contacts",titleString:"addon.messages.contacts",results:[],canLoadMore:!1,loadingMore:!1},this.nonContacts={type:"noncontacts",titleString:"addon.messages.noncontacts",results:[],canLoadMore:!1,loadingMore:!1},this.messages={type:"messages",titleString:"addon.messages.messages",results:[],canLoadMore:!1,loadingMore:!1,loadMoreError:!1},this.memberInfoObserver=g.b.on(d.b.MEMBER_INFO_CHANGED_EVENT,(e=>{if(!e.userBlocked&&!e.userUnblocked)return;const s=this.contacts.results.find((s=>s.id==e.userId));if(s)s.isblocked=!!e.userBlocked;else{const s=this.nonContacts.results.find((s=>s.id==e.userId));s&&(s.isblocked=!!e.userBlocked)}this.messages.results.forEach((s=>{s.userid==e.userId&&(s.isblocked=!!e.userBlocked)}))}),_.b.getCurrentSiteId())}clearSearch(){this.query="",this.displayResults=!1;const e=u.a.getRelativePathToParent("/messages/search");e&&u.a.navigate(e)}search(e,s,t){return Object(l.a)(this,void 0,void 0,(function*(){m.a.closeKeyboard(),this.query=e,this.disableSearch=!0,this.displaySearching=!s;const n=[];let a=[],c=[],o=[],i=!1,r=!1,l=!1;if(!s||"contacts"==s||"noncontacts"==s){const t=s?d.b.LIMIT_SEARCH:d.b.LIMIT_INITIAL_USER_SEARCH;let o=0;"contacts"==s?(o=this.contacts.results.length,this.contacts.loadingMore=!0):"noncontacts"==s&&(o=this.nonContacts.results.length,this.nonContacts.loadingMore=!0),n.push(d.a.searchUsers(e,o,t).then((e=>{s&&"contacts"!=s||(a=e.contacts,i=e.canLoadMoreContacts),s&&"noncontacts"!=s||(c=e.nonContacts,r=e.canLoadMoreNonContacts)})))}if(!s||"messages"==s){let t=0;"messages"==s&&(t=this.messages.results.length,this.messages.loadingMore=!0),n.push(d.a.searchMessages(e,void 0,t).then((e=>{o=e.messages,l=e.canLoadMore})))}try{yield Promise.all(n),s||(this.contacts.results=[],this.nonContacts.results=[],this.messages.results=[]),this.displayResults=!0,s&&"contacts"!=s||(this.contacts.results.push(...a),this.contacts.canLoadMore=i,this.setHighlight(a,!0)),s&&"noncontacts"!=s||(this.nonContacts.results.push(...c),this.nonContacts.canLoadMore=r,this.setHighlight(c,!0)),s&&"messages"!=s||(this.messages.results.push(...o),this.messages.canLoadMore=l,this.messages.loadMoreError=!1,this.setHighlight(o,!1)),s||(this.contacts.results.length>0?this.openConversation(this.contacts.results[0],!0):this.nonContacts.results.length>0?this.openConversation(this.nonContacts.results[0],!0):this.messages.results.length>0&&this.openConversation(this.messages.results[0],!0))}catch(e){h.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingusers",!0),"messages"==s&&(this.messages.loadMoreError=!0)}finally{this.disableSearch=!1,this.displaySearching=!1,"contacts"==s?this.contacts.loadingMore=!1:"noncontacts"==s?this.nonContacts.loadingMore=!1:"messages"==s&&(this.messages.loadingMore=!1),t&&t()}}))}openConversation(e,s=!1){if(!s||a.a.isTablet){let s,t;this.selectedResult=e,"conversationid"in e?s=e.conversationid:t=e.id;const n=u.a.getRelativePathToParent("/messages/search")+"discussion/"+(s||`user/${t}`);u.a.navigate(n,{reset:a.a.isTablet&&!!this.splitView&&!this.splitView.isNested})}}setHighlight(e,s=!1){e.forEach((e=>{e.highlightName=s?this.query:void 0,e.highlightMessage=s?void 0:this.query}))}ngOnDestroy(){var e;null===(e=this.memberInfoObserver)||void 0===e?void 0:e.off()}}return AddonMessagesSearchPage.ɵfac=function AddonMessagesSearchPage_Factory(e){return new(e||AddonMessagesSearchPage)},AddonMessagesSearchPage.ɵcmp=M.sc({type:AddonMessagesSearchPage,selectors:[["page-addon-messages-search"]],viewQuery:function AddonMessagesSearchPage_Query(e,s){var t;(1&e&&M.ud(p.a,!0),2&e)&&(M.dd(t=M.Nc())&&(s.splitView=t.first))},decls:20,vars:16,consts:[["slot","start"],[3,"text"],["slot","end"],["autocorrect","off","searchArea","AddonMessagesSearch",3,"disabled","spellcheck","autoFocus","lengthCheck","onSubmit","onClear"],[3,"hideUntil","message"],[4,"ngIf"],["icon","fas-search",3,"message",4,"ngIf"],["resultsTemplate",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"enabled","error","action"],["icon","fas-search",3,"message"],[1,"ion-text-wrap"],["class","addon-message-discussion ion-text-wrap","detail","true","button","",3,"click",4,"ngFor","ngForOf"],["detail","true","button","",1,"addon-message-discussion","ion-text-wrap",3,"click"],["slot","start",3,"user","checkOnline","linkProfile"],[1,"item-heading"],[3,"text","highlight","filter"],["name","fas-ban",4,"ngIf"],[1,"addon-message-last-message"],["class","addon-message-last-message-user",4,"ngIf"],["clean","true","singleLine","true","contextLevel","system",1,"addon-message-last-message-text",3,"text","highlight","contextInstanceId"],["name","fas-ban"],[1,"addon-message-last-message-user"],["class","ion-padding-horizontal",4,"ngIf"],["class","ion-padding ion-text-center",4,"ngIf"],[1,"ion-padding-horizontal"],["expand","block","fill","outline",3,"click"],[1,"ion-padding","ion-text-center"]],template:function AddonMessagesSearchPage_Template(e,s){1&e&&(M.Ec(0,"ion-header"),M.Ec(1,"ion-toolbar"),M.Ec(2,"ion-buttons",0),M.zc(3,"ion-back-button",1),M.Pc(4,"translate"),M.Dc(),M.Ec(5,"ion-title"),M.Ec(6,"h1"),M.pd(7),M.Pc(8,"translate"),M.Dc(),M.Dc(),M.Ec(9,"ion-buttons",2),M.zc(10,"core-context-menu"),M.Dc(),M.Dc(),M.Dc(),M.Ec(11,"ion-content"),M.Ec(12,"core-split-view"),M.Ec(13,"core-search-box",3),M.Mc("onSubmit",(function AddonMessagesSearchPage_Template_core_search_box_onSubmit_13_listener(e){return s.search(e)}))("onClear",(function AddonMessagesSearchPage_Template_core_search_box_onClear_13_listener(){return s.clearSearch()})),M.Dc(),M.Ec(14,"core-loading",4),M.Pc(15,"translate"),M.nd(16,AddonMessagesSearchPage_ion_list_16_Template,5,14,"ion-list",5),M.nd(17,AddonMessagesSearchPage_core_empty_box_17_Template,2,3,"core-empty-box",6),M.Dc(),M.Dc(),M.Dc(),M.nd(18,AddonMessagesSearchPage_ng_template_18_Template,1,1,"ng-template",null,7,M.od)),2&e&&(M.lc(3),M.Vc("text",M.Qc(4,10,"core.back")),M.lc(4),M.qd(M.Qc(8,12,"addon.messages.searchcombined")),M.lc(6),M.Vc("disabled",s.disableSearch)("spellcheck",!1)("autoFocus",!0)("lengthCheck",1),M.lc(1),M.Vc("hideUntil",!s.displaySearching)("message",M.Qc(15,14,"core.searching")),M.lc(2),M.Vc("ngIf",s.displayResults),M.lc(1),M.Vc("ngIf",s.displayResults&&!s.contacts.results.length&&!s.nonContacts.results.length&&!s.messages.results.length))},directives:[f.C,f.Ab,f.m,f.h,f.i,f.yb,S.a,P.a,f.v,p.a,b.a,A.a,T.t,f.P,T.A,v.a,E.a,f.J,f.O,T.s,f.I,y.a,C.a,f.D,I.a,f.W,O.a,f.l,f.qb],pipes:[k.d,x.a],encapsulation:2}),AddonMessagesSearchPage})();const V=[{path:"",component:D},...o.DISCUSSION_ROUTES],w=[{path:"",component:D,children:o.DISCUSSION_ROUTES}],L=[...Object(c.c)(V,(()=>a.a.isMobile)),...Object(c.c)(w,(()=>a.a.isTablet))];let R=(()=>{class AddonMessagesSearchPageModule{}return AddonMessagesSearchPageModule.ɵmod=M.wc({type:AddonMessagesSearchPageModule}),AddonMessagesSearchPageModule.ɵinj=M.vc({factory:function AddonMessagesSearchPageModule_Factory(e){return new(e||AddonMessagesSearchPageModule)},imports:[[n.m.forChild(L),i.a,r.a],n.m]}),AddonMessagesSearchPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&M.kd(R,{declarations:[D],imports:[n.m,i.a,r.a],exports:[n.m]}))}}]);