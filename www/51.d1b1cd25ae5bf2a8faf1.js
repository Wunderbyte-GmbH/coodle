(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{twN0:function(e,n,t){"use strict";t.r(n),t.d(n,"AddonMessagesGroupConversationsPageModule",(function(){return $}));var s=t("tyNb"),o=t("vY5A"),a=t("muSn"),i=t("Y+03"),r=t("L3Fv"),d=t("mrSG"),c=t("TEn/"),l=t("fjkH"),g=t("9+EE"),u=t("KMk0"),_=t("nopL"),p=t("3LXp"),m=t("4pns"),v=t("2eZG"),f=t("j3ag"),h=t("bFG1"),C=t("pHTc"),M=t("YyYz"),P=t("r2Z7"),O=t("46ml"),b=t("fXoL"),E=t("ACYt"),T=t("3CSS"),A=t("fQ68"),x=t("C1x5"),I=t("nt/U"),G=t("PgjG"),D=t("ofXK"),y=t("xpMl"),V=t("hMzs"),k=t("NcPy"),N=t("FeAf"),w=t("sYmb"),S=t("Cg42");const R=["favlist"],L=["grouplist"],U=["indlist"];function AddonMessagesGroupConversationsPage_ion_badge_31_Template(e,n){if(1&e&&(b.Ec(0,"ion-badge",29),b.pd(1),b.Dc()),2&e){const e=b.Oc();b.lc(1),b.qd(e.contactRequestsCount)}}const _c3=function(e){return{$a:e}};function AddonMessagesGroupConversationsPage_span_32_Template(e,n){if(1&e&&(b.Ec(0,"span",30),b.pd(1),b.Pc(2,"translate"),b.Dc()),2&e){const e=b.Oc();b.lc(1),b.rd(" ",b.Rc(2,1,"addon.messages.pendingcontactrequests",b.ad(4,_c3,e.contactRequestsCount))," ")}}function AddonMessagesGroupConversationsPage_ion_badge_40_Template(e,n){if(1&e&&(b.Ec(0,"ion-badge",29),b.pd(1),b.Dc()),2&e){const e=b.Oc();b.lc(1),b.qd(e.favourites.unread)}}function AddonMessagesGroupConversationsPage_span_41_Template(e,n){if(1&e&&(b.Ec(0,"span",30),b.pd(1),b.Pc(2,"translate"),b.Dc()),2&e){const e=b.Oc();b.lc(1),b.rd(" ",b.Rc(2,1,"addon.messages.unreadconversations",b.ad(4,_c3,e.favourites.unread))," ")}}function AddonMessagesGroupConversationsPage_ng_container_44_Template(e,n){1&e&&b.Ac(0)}function AddonMessagesGroupConversationsPage_ion_item_46_Template(e,n){1&e&&(b.Ec(0,"ion-item",31),b.Ec(1,"ion-label"),b.Ec(2,"p"),b.pd(3),b.Pc(4,"translate"),b.Dc(),b.Dc(),b.Dc()),2&e&&(b.lc(3),b.qd(b.Qc(4,1,"addon.messages.nofavourites")))}function AddonMessagesGroupConversationsPage_ion_item_47_Template(e,n){1&e&&(b.Ec(0,"ion-item",32),b.Ec(1,"ion-label"),b.zc(2,"ion-spinner"),b.Pc(3,"translate"),b.Dc(),b.Dc()),2&e&&(b.lc(2),b.mc("aria-label",b.Qc(3,1,"core.loading")))}function AddonMessagesGroupConversationsPage_ion_badge_55_Template(e,n){if(1&e&&(b.Ec(0,"ion-badge",29),b.pd(1),b.Dc()),2&e){const e=b.Oc();b.lc(1),b.qd(e.group.unread)}}function AddonMessagesGroupConversationsPage_span_56_Template(e,n){if(1&e&&(b.Ec(0,"span",30),b.pd(1),b.Pc(2,"translate"),b.Dc()),2&e){const e=b.Oc();b.lc(1),b.rd(" ",b.Rc(2,1,"addon.messages.unreadconversations",b.ad(4,_c3,e.group.unread))," ")}}function AddonMessagesGroupConversationsPage_ng_container_59_Template(e,n){1&e&&b.Ac(0)}function AddonMessagesGroupConversationsPage_ion_item_61_Template(e,n){1&e&&(b.Ec(0,"ion-item",31),b.Ec(1,"ion-label"),b.Ec(2,"p"),b.pd(3),b.Pc(4,"translate"),b.Dc(),b.Dc(),b.Dc()),2&e&&(b.lc(3),b.qd(b.Qc(4,1,"addon.messages.nogroupconversations")))}function AddonMessagesGroupConversationsPage_ion_item_62_Template(e,n){1&e&&(b.Ec(0,"ion-item",32),b.Ec(1,"ion-label"),b.zc(2,"ion-spinner"),b.Pc(3,"translate"),b.Dc(),b.Dc()),2&e&&(b.lc(2),b.mc("aria-label",b.Qc(3,1,"core.loading")))}function AddonMessagesGroupConversationsPage_ion_badge_70_Template(e,n){if(1&e&&(b.Ec(0,"ion-badge",29),b.pd(1),b.Dc()),2&e){const e=b.Oc();b.lc(1),b.qd(e.individual.unread)}}function AddonMessagesGroupConversationsPage_span_71_Template(e,n){if(1&e&&(b.Ec(0,"span",30),b.pd(1),b.Pc(2,"translate"),b.Dc()),2&e){const e=b.Oc();b.lc(1),b.rd(" ",b.Rc(2,1,"addon.messages.unreadconversations",b.ad(4,_c3,e.individual.unread))," ")}}function AddonMessagesGroupConversationsPage_ng_container_74_Template(e,n){1&e&&b.Ac(0)}function AddonMessagesGroupConversationsPage_ion_item_76_Template(e,n){1&e&&(b.Ec(0,"ion-item",31),b.Ec(1,"ion-label"),b.Ec(2,"p"),b.pd(3),b.Pc(4,"translate"),b.Dc(),b.Dc(),b.Dc()),2&e&&(b.lc(3),b.qd(b.Qc(4,1,"addon.messages.noindividualconversations")))}function AddonMessagesGroupConversationsPage_ion_item_77_Template(e,n){1&e&&(b.Ec(0,"ion-item",32),b.Ec(1,"ion-label"),b.zc(2,"ion-spinner"),b.Pc(3,"translate"),b.Dc(),b.Dc()),2&e&&(b.lc(2),b.mc("aria-label",b.Qc(3,1,"core.loading")))}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_avatar_1_Template(e,n){if(1&e&&(b.Ec(0,"ion-avatar",0),b.zc(1,"img",46),b.Dc()),2&e){const e=b.Oc().$implicit;b.lc(1),b.Vc("src",e.imageurl,b.id)("alt",e.name)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_core_user_avatar_2_Template(e,n){if(1&e&&b.zc(0,"core-user-avatar",47),2&e){const e=b.Oc().$implicit;b.Vc("user",e.otherUser)("linkProfile",!1)("checkOnline",e.showonlinestatus)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_icon_7_Template(e,n){1&e&&(b.zc(0,"ion-icon",48),b.Pc(1,"translate")),2&e&&b.Vc("title",b.Qc(1,1,"addon.messages.contactblocked"))}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_icon_8_Template(e,n){1&e&&(b.zc(0,"ion-icon",49),b.Pc(1,"translate")),2&e&&b.Vc("title",b.Qc(1,1,"addon.messages.mutedconversation"))}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_span_1_Template(e,n){if(1&e&&(b.Ec(0,"span",52),b.pd(1),b.Pc(2,"coreDateDayOrTime"),b.Dc()),2&e){const e=b.Oc(2).$implicit;b.lc(1),b.rd(" ",b.Qc(2,1,e.lastmessagedate)," ")}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_ion_badge_2_Template(e,n){if(1&e&&(b.Ec(0,"ion-badge",53),b.pd(1),b.Dc()),2&e){const e=b.Oc(2).$implicit;b.lc(1),b.qd(e.unreadcount)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_span_3_Template(e,n){if(1&e&&(b.Ec(0,"span",30),b.pd(1),b.Pc(2,"translate"),b.Dc()),2&e){const e=b.Oc(2).$implicit;b.lc(1),b.rd(" ",b.Rc(2,1,"addon.messages.unreadmessages",b.ad(4,_c3,e.unreadcount))," ")}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_Template(e,n){if(1&e&&(b.Ec(0,"ion-note"),b.nd(1,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_span_1_Template,3,3,"span",50),b.nd(2,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_ion_badge_2_Template,2,1,"ion-badge",51),b.nd(3,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_span_3_Template,3,6,"span",13),b.Dc()),2&e){const e=b.Oc().$implicit;b.lc(1),b.Vc("ngIf",e.lastmessagedate>0),b.lc(1),b.Vc("ngIf",e.unreadcount>0),b.lc(1),b.Vc("ngIf",e.unreadcount>0)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_p_10_Template(e,n){if(1&e&&(b.Ec(0,"p"),b.zc(1,"core-format-text",39),b.Dc()),2&e){const e=b.Oc().$implicit;b.lc(1),b.Vc("text",e.subname)("contextInstanceId",0)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_span_12_Template(e,n){1&e&&(b.Ec(0,"span",54),b.pd(1),b.Pc(2,"translate"),b.Dc()),2&e&&(b.lc(1),b.rd(" ",b.Qc(2,1,"addon.messages.you")," "))}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_span_13_Template(e,n){if(1&e&&(b.Ec(0,"span",54),b.pd(1),b.Dc()),2&e){const e=b.Oc().$implicit;b.lc(1),b.qd(e.members[0].fullname+":")}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_Template(e,n){if(1&e){const e=b.Fc();b.Ec(0,"ion-item",34),b.Mc("click",(function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_Template_ion_item_click_0_listener(){b.fd(e);const t=n.$implicit;return b.Oc(2).gotoConversation(t.id,t.userid)})),b.nd(1,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_avatar_1_Template,2,2,"ion-avatar",35),b.nd(2,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_core_user_avatar_2_Template,1,3,"core-user-avatar",36),b.Ec(3,"ion-label"),b.Ec(4,"div",37),b.Ec(5,"p",38),b.zc(6,"core-format-text",39),b.nd(7,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_icon_7_Template,2,3,"ion-icon",40),b.nd(8,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_icon_8_Template,2,3,"ion-icon",41),b.Dc(),b.nd(9,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_Template,4,3,"ion-note",42),b.Dc(),b.nd(10,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_p_10_Template,2,2,"p",42),b.Ec(11,"p",43),b.nd(12,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_span_12_Template,3,3,"span",44),b.nd(13,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_span_13_Template,2,1,"span",44),b.zc(14,"core-format-text",45),b.Dc(),b.Dc(),b.Dc()}if(2&e){const e=n.$implicit,t=b.Oc(2);b.Xc("id","addon-message-conversation-",e.id?e.id:"user-"+e.userid,""),b.mc("aria-current",e.id&&e.id==t.selectedConversationId||e.userid&&e.userid==t.selectedUserId?"page":"false")("aria-label",e.name),b.lc(1),b.Vc("ngIf",e.type==t.typeGroup),b.lc(1),b.Vc("ngIf",e.type!=t.typeGroup),b.lc(4),b.Vc("text",e.name)("contextInstanceId",0),b.lc(1),b.Vc("ngIf",e.isblocked),b.lc(1),b.Vc("ngIf",e.ismuted),b.lc(1),b.Vc("ngIf",e.lastmessagedate>0||e.unreadcount),b.lc(1),b.Vc("ngIf",e.subname),b.lc(2),b.Vc("ngIf",e.sentfromcurrentuser),b.lc(1),b.Vc("ngIf",!e.sentfromcurrentuser&&e.type==t.typeGroup&&e.members[0]),b.lc(1),b.Vc("text",e.lastmessage)("contextInstanceId",0)}}function AddonMessagesGroupConversationsPage_ng_template_78_Template(e,n){if(1&e&&b.nd(0,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_Template,15,15,"ion-item",33),2&e){b.Vc("ngForOf",n.conversations)}}const _c4=function(e){return{conversations:e}};let Q=(()=>{class AddonMessagesGroupConversationsPage{constructor(e){this.route=e,this.loaded=!1,this.contactRequestsCount=0,this.favourites={type:void 0,favourites:!0,count:0,unread:0,conversations:[]},this.group={type:u.b.MESSAGE_CONVERSATION_TYPE_GROUP,favourites:!1,count:0,unread:0,conversations:[]},this.individual={type:u.b.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL,favourites:!1,count:0,unread:0,conversations:[]},this.typeGroup=u.b.MESSAGE_CONVERSATION_TYPE_GROUP,this.loadingMessage=f.I.instant("core.loading"),this.siteId=g.b.getCurrentSiteId(),this.currentUserId=g.b.getCurrentSiteUserId(),this.newMessagesObserver=l.b.on(u.b.NEW_MESSAGE_EVENT,(e=>{var n;const t=this.getExpandedOption();if(t!=this.getConversationOption(e))return;const s=this.findConversation(e.conversationId,e.userId,t);if(void 0===s)return this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0})),void 0;if(s.lastmessage!=e.message||s.lastmessagedate!=e.timecreated/1e3){const t=e.timecreated/1e3>(s.lastmessagedate||0);s.lastmessage=e.message,s.lastmessagedate=e.timecreated/1e3;const o=this.getConversationOption(s);o.conversations=u.a.sortConversations(o.conversations||[]),t&&(null===(n=this.content)||void 0===n||n.scrollToTop())}}),this.siteId),this.readChangedObserver=l.b.on(u.b.READ_CHANGED_EVENT,(e=>{if(e.conversationId){const n=this.findConversation(e.conversationId);void 0!==n&&(n.unreadcount=0,u.a.invalidateConversations(this.siteId),u.a.refreshUnreadConversationCounts(this.siteId))}}),this.siteId),this.openConversationObserver=l.b.on(u.b.OPEN_CONVERSATION_EVENT,(e=>{(e.conversationId||e.userId)&&this.gotoConversation(e.conversationId,e.userId)}),this.siteId),this.appResumeSubscription=P.a.resume.subscribe((()=>{this.loaded&&(this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0})))})),this.updateConversationListObserver=l.b.on(u.b.UPDATE_CONVERSATION_LIST_EVENT,(e=>{if(e&&"mute"==e.action){const n=this.getExpandedOption();if(n&&n.conversations){const t=this.findConversation(e.conversationId,void 0,n);t&&(t.ismuted=!!e.value)}}else this.refreshData()}),this.siteId),this.pushObserver=v.a.on("receive").subscribe((e=>{h.a.isFalseOrZero(e.notif)&&e.site==this.siteId&&this.refreshData(void 0,!1)})),this.cronObserver=l.b.on(u.b.UNREAD_CONVERSATION_COUNTS_EVENT,(e=>{this.favourites.unread=e.favourites,this.individual.unread=e.individual+e.self,this.group.unread=e.group}),this.siteId),this.contactRequestsCountObserver=l.b.on(u.b.CONTACT_REQUESTS_COUNT_EVENT,(e=>{this.contactRequestsCount=e.count}),this.siteId),this.memberInfoObserver=l.b.on(u.b.MEMBER_INFO_CHANGED_EVENT,(e=>{if(!e.userBlocked&&!e.userUnblocked)return;const n=this.getExpandedOption();if(n==this.individual||n==this.favourites){if(!n.conversations||n.conversations.length<=0)return;const t=this.findConversation(void 0,e.userId,n);t&&(t.isblocked=e.userBlocked)}}),this.siteId)}ngOnInit(){return Object(d.a)(this,void 0,void 0,(function*(){this.route.queryParams.subscribe((e=>Object(d.a)(this,void 0,void 0,(function*(){const n=C.a.getRouteNumberParam("conversationId",{params:e}),t=C.a.getRouteNumberParam("userId",{params:e});(n||t)&&(this.selectedConversationId=n,this.selectedUserId=t)}))));const e=new M.a;if(yield this.fetchData(),!this.selectedConversationId&&!this.selectedUserId&&i.a.isTablet){let e;const n=this.getExpandedOption();n&&n.conversations.length&&(e=n.conversations[0],e&&(yield this.gotoConversation(e.id)))}e.treatLink()}))}fetchData(e=!0){return Object(d.a)(this,void 0,void 0,(function*(){const n=[];n.push(this.fetchConversationCounts()),n.push(u.a.getContactRequestsCount(this.siteId)),e&&n.push(u.a.refreshUnreadConversationCounts(this.siteId));try{if(yield Promise.all(n),void 0===this.favourites.expanded&&(this.selectedConversationId||this.selectedUserId)){const e=[];e.push(this.fetchDataForOption(this.favourites,!1)),e.push(this.fetchDataForOption(this.group,!1)),e.push(this.fetchDataForOption(this.individual,!1)),yield Promise.all(e);const n=this.findConversation(this.selectedConversationId,this.selectedUserId);if(n){const e=this.getConversationOption(n);return yield this.expandOption(e),this.loaded=!0,void 0}}yield this.fetchDataForExpandedOption()}catch(e){p.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingdiscussions",!0)}this.loaded=!0}))}fetchDataForExpandedOption(){return Object(d.a)(this,void 0,void 0,(function*(){void 0===this.favourites.expanded&&(this.favourites.expanded=0!=this.favourites.count&&!this.group.unread&&!this.individual.unread,this.group.expanded=!this.favourites.expanded&&0!=this.group.count&&!this.individual.unread,this.individual.expanded=!this.favourites.expanded&&!this.group.expanded),this.loadCurrentListElement();const e=this.getExpandedOption();e&&(yield this.fetchDataForOption(e,!1))}))}fetchDataForOption(e,n=!1,t=!1){return Object(d.a)(this,void 0,void 0,(function*(){e.loadMoreError=!1;const s=n?e.conversations.length:0,o=[];let a={conversations:[],canLoadMore:!1},i=[];o.push(u.a.invalidateConversations(this.siteId).then((()=>Object(d.a)(this,void 0,void 0,(function*(){a=yield u.a.getConversations(e.type,e.favourites,s,this.siteId)}))))),n||o.push(_.a.getAllMessages().then((e=>{i=e}))),t&&(o.push(this.fetchConversationCounts()),o.push(u.a.refreshUnreadConversationCounts(this.siteId))),yield Promise.all(o),n?(e.conversations=e.conversations.concat(a.conversations),e.canLoadMore=a.canLoadMore):(e.conversations=a.conversations,e.canLoadMore=a.canLoadMore,i&&i.length&&(yield this.loadOfflineMessages(e,i),e.conversations=u.a.sortConversations(e.conversations)))}))}fetchConversationCounts(){return Object(d.a)(this,void 0,void 0,(function*(){yield u.a.invalidateConversationCounts(this.siteId);const e=yield u.a.getConversationCounts(this.siteId);this.favourites.count=e.favourites,this.individual.count=e.individual+e.self,this.group.count=e.group}))}findConversation(e,n,t){if(e){return(t?t.conversations:this.favourites.conversations.concat(this.group.conversations).concat(this.individual.conversations)).find((n=>n.id==e))}return(t?t.conversations:this.favourites.conversations.concat(this.individual.conversations)).find((e=>e.userid==n))}getExpandedOption(){return this.favourites.expanded?this.favourites:this.group.expanded?this.group:this.individual.expanded?this.individual:void 0}gotoContacts(){C.a.navigateToSitePath("contacts")}gotoConversation(e,n,t){return Object(d.a)(this,void 0,void 0,(function*(){this.selectedConversationId=e,this.selectedUserId=n;const s={};t&&(s.message=t);const o=C.a.getRelativePathToParent("/messages/group-conversations")+"discussion/"+(e||`user/${n}`);yield C.a.navigate(o,{params:s,reset:i.a.isTablet&&!!this.splitView&&!this.splitView.isNested})}))}gotoSettings(){C.a.navigateToSitePath("message-settings")}loadMoreConversations(e,n){return Object(d.a)(this,void 0,void 0,(function*(){try{yield this.fetchDataForOption(e,!0)}catch(n){p.a.showErrorModalDefault(n,"addon.messages.errorwhileretrievingdiscussions",!0),e.loadMoreError=!0}n&&n()}))}loadOfflineMessages(e,n){return Object(d.a)(this,void 0,void 0,(function*(){const t=[];n.forEach((n=>{var s,o,a,i,r,d,c,l,g,_;if("conversationid"in n){let t=this.findConversation(n.conversationid,void 0,e);t?(null==t.lastmessage||!t.lastmessagepending||(t.lastmessagedate||0)<=n.timecreated/1e3)&&this.addLastOfflineMessage(t,n):(t={id:n.conversationid,type:(null===(s=n.conversation)||void 0===s?void 0:s.type)||u.b.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL,membercount:(null===(o=n.conversation)||void 0===o?void 0:o.membercount)||0,ismuted:(null===(a=n.conversation)||void 0===a?void 0:a.ismuted)||!1,isfavourite:(null===(i=n.conversation)||void 0===i?void 0:i.isfavourite)||!1,isread:(null===(r=n.conversation)||void 0===r?void 0:r.isread)||!1,members:(null===(d=n.conversation)||void 0===d?void 0:d.members)||[],messages:(null===(c=n.conversation)||void 0===c?void 0:c.messages)||[],candeletemessagesforallusers:(null===(l=n.conversation)||void 0===l?void 0:l.candeletemessagesforallusers)||!1,userid:0,name:null===(g=n.conversation)||void 0===g?void 0:g.name,imageurl:(null===(_=n.conversation)||void 0===_?void 0:_.imageurl)||""},this.getConversationOption(t)==e&&(this.addLastOfflineMessage(t,n),this.addOfflineConversation(t)))}else if(e.type==u.b.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL){const s=this.findConversation(void 0,n.touserid,e);n.text=n.smallmessage,s?(s.lastmessagedate||0)<=n.timecreated/1e3&&this.addLastOfflineMessage(s,n):t.push(m.a.getProfile(n.touserid,void 0,!0).catch((()=>{})).then((e=>{const t={id:0,type:u.b.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL,membercount:0,ismuted:!1,isfavourite:!1,isread:!1,members:[],messages:[],candeletemessagesforallusers:!1,userid:n.touserid,name:e?e.fullname:String(n.touserid),imageurl:e?e.profileimageurl:""};this.addLastOfflineMessage(t,n),this.addOfflineConversation(t)})))}})),yield Promise.all(t)}))}addOfflineConversation(e){this.getConversationOption(e).conversations.unshift(e)}addLastOfflineMessage(e,n){e.lastmessage=n.text,e.lastmessagedate=n.timecreated/1e3,e.lastmessagepending=!0,e.sentfromcurrentuser=!0}getConversationOption(e){return e.isfavourite?this.favourites:e.type==u.b.MESSAGE_CONVERSATION_TYPE_GROUP?this.group:this.individual}refreshData(e,n=!0){return Object(d.a)(this,void 0,void 0,(function*(){try{yield u.a.invalidateContactRequestsCountCache(this.siteId)}finally{try{yield this.fetchData(n)}finally{e&&(null==e?void 0:e.complete())}}}))}toggle(e){e.expanded?(e.expanded=!1,this.loadCurrentListElement()):this.expandOption(e,!0).catch((e=>{p.a.showErrorModalDefault(e,"addon.messages.errorwhileretrievingdiscussions",!0)}))}expandOption(e,n=!1){return Object(d.a)(this,void 0,void 0,(function*(){this.favourites.expanded=!1,this.group.expanded=!1,this.individual.expanded=!1,e.expanded=!0,e.loading=!0;try{yield this.fetchDataForOption(e,!1,n),this.loadCurrentListElement()}catch(n){throw e.expanded=!1,n}finally{e.loading=!1}}))}loadCurrentListElement(){this.currentListEl=this.favourites.expanded?this.favListEl&&this.favListEl.nativeElement:this.group.expanded?this.groupListEl&&this.groupListEl.nativeElement:this.individual.expanded?this.indListEl&&this.indListEl.nativeElement:void 0}gotoSearch(){C.a.navigateToSitePath("search")}ngOnDestroy(){var e,n,t,s,o,a,i,r,d;null===(e=this.newMessagesObserver)||void 0===e?void 0:e.off(),null===(n=this.appResumeSubscription)||void 0===n||n.unsubscribe(),null===(t=this.pushObserver)||void 0===t||t.unsubscribe(),null===(s=this.readChangedObserver)||void 0===s||s.off(),null===(o=this.cronObserver)||void 0===o||o.off(),null===(a=this.openConversationObserver)||void 0===a||a.off(),null===(i=this.updateConversationListObserver)||void 0===i||i.off(),null===(r=this.contactRequestsCountObserver)||void 0===r||r.off(),null===(d=this.memberInfoObserver)||void 0===d||d.off()}}return AddonMessagesGroupConversationsPage.ɵfac=function AddonMessagesGroupConversationsPage_Factory(e){return new(e||AddonMessagesGroupConversationsPage)(b.yc(s.a))},AddonMessagesGroupConversationsPage.ɵcmp=b.sc({type:AddonMessagesGroupConversationsPage,selectors:[["page-addon-messages-group-conversations"]],viewQuery:function AddonMessagesGroupConversationsPage_Query(e,n){var t;(1&e&&(b.ud(O.a,!0),b.ud(c.v,!0),b.ud(R,!0),b.ud(L,!0),b.ud(U,!0)),2&e)&&(b.dd(t=b.Nc())&&(n.splitView=t.first),b.dd(t=b.Nc())&&(n.content=t.first),b.dd(t=b.Nc())&&(n.favListEl=t.first),b.dd(t=b.Nc())&&(n.groupListEl=t.first),b.dd(t=b.Nc())&&(n.indListEl=t.first))},decls:80,vars:86,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["name","fas-search","slot","icon-only","aria-hidden","true"],[3,"click"],["name","fas-cog","slot","icon-only","aria-hidden","true"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil","message"],["detail","true","button","",1,"ion-text-wrap","addon-message-discussion",3,"click"],["name","fas-address-book","slot","start","aria-hidden","true"],["slot","end","aria-hidden","true",4,"ngIf"],["class","sr-only",4,"ngIf"],["button","","sticky","true","aria-controls","addon-messages-groupconversations-favourite","role","heading","detail","false",1,"ion-text-wrap","divider",3,"click"],["name","fas-chevron-right","flip-rtl","","slot","start","aria-hidden","true",1,"expandable-status-icon"],["id","addon-messages-groupconversations-favourite",3,"hidden"],["favlist",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"enabled","error","action"],["class","ion-text-wrap",4,"ngIf"],["class","ion-text-center",4,"ngIf"],["button","","sticky","true","aria-controls","addon-messages-groupconversations-group","role","heading","detail","false",1,"divider","ion-text-wrap",3,"click"],["id","addon-messages-groupconversations-group",3,"hidden"],["grouplist",""],["button","","sticky","true","aria-controls","addon-messages-groupconversations-individual","role","heading","detail","false",1,"divider","ion-text-wrap",3,"click"],["id","addon-messages-groupconversations-individual",3,"hidden"],["indlist",""],["conversationsTemplate",""],["slot","end","aria-hidden","true"],[1,"sr-only"],[1,"ion-text-wrap"],[1,"ion-text-center"],["class","ion-text-wrap addon-message-discussion","button","","detail","false",3,"id","click",4,"ngFor","ngForOf"],["button","","detail","false",1,"ion-text-wrap","addon-message-discussion",3,"id","click"],["slot","start",4,"ngIf"],["core-user-avatar","","slot","start",3,"user","linkProfile","checkOnline",4,"ngIf"],[1,"flex-row","ion-justify-content-between"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId"],["name","fas-user-slash",3,"title",4,"ngIf"],["name","fas-volume-mute",3,"title",4,"ngIf"],[4,"ngIf"],[1,"addon-message-last-message"],["class","addon-message-last-message-user",4,"ngIf"],["clean","true","singleLine","true","contextLevel","system",1,"addon-message-last-message-text",3,"text","contextInstanceId"],["core-external-content","","onError","this.src='assets/img/group-avatar.svg'",3,"src","alt"],["core-user-avatar","","slot","start",3,"user","linkProfile","checkOnline"],["name","fas-user-slash",3,"title"],["name","fas-volume-mute",3,"title"],["class","addon-message-last-message-date",4,"ngIf"],["aria-label","true",4,"ngIf"],[1,"addon-message-last-message-date"],["aria-label","true"],[1,"addon-message-last-message-user"]],template:function AddonMessagesGroupConversationsPage_Template(e,n){if(1&e&&(b.Ec(0,"ion-header"),b.Ec(1,"ion-toolbar"),b.Ec(2,"ion-buttons",0),b.zc(3,"ion-back-button",1),b.Pc(4,"translate"),b.Dc(),b.Ec(5,"ion-title"),b.Ec(6,"h1"),b.pd(7),b.Pc(8,"translate"),b.Dc(),b.Dc(),b.Ec(9,"ion-buttons",2),b.Ec(10,"ion-button",3),b.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_button_click_10_listener(){return n.gotoSearch()})),b.Pc(11,"translate"),b.zc(12,"ion-icon",4),b.Dc(),b.Ec(13,"ion-button",5),b.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_button_click_13_listener(){return n.gotoSettings()})),b.Pc(14,"translate"),b.zc(15,"ion-icon",6),b.Dc(),b.zc(16,"core-context-menu"),b.zc(17,"core-user-menu-button"),b.Dc(),b.Dc(),b.Dc(),b.Ec(18,"ion-content"),b.Ec(19,"core-split-view"),b.Ec(20,"ion-refresher",7),b.Mc("ionRefresh",(function AddonMessagesGroupConversationsPage_Template_ion_refresher_ionRefresh_20_listener(e){return n.refreshData(e.target)})),b.zc(21,"ion-refresher-content",8),b.Pc(22,"translate"),b.Dc(),b.Ec(23,"core-loading",9),b.Ec(24,"ion-list"),b.Ec(25,"ion-item",10),b.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_25_listener(){return n.gotoContacts()})),b.zc(26,"ion-icon",11),b.Ec(27,"ion-label"),b.Ec(28,"h2"),b.pd(29),b.Pc(30,"translate"),b.Dc(),b.Dc(),b.nd(31,AddonMessagesGroupConversationsPage_ion_badge_31_Template,2,1,"ion-badge",12),b.nd(32,AddonMessagesGroupConversationsPage_span_32_Template,3,6,"span",13),b.Dc(),b.Ec(33,"ion-item",14),b.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_33_listener(){return n.toggle(n.favourites)})),b.Pc(34,"translate"),b.zc(35,"ion-icon",15),b.Ec(36,"ion-label"),b.Ec(37,"h2"),b.pd(38),b.Pc(39,"translate"),b.Dc(),b.Dc(),b.nd(40,AddonMessagesGroupConversationsPage_ion_badge_40_Template,2,1,"ion-badge",12),b.nd(41,AddonMessagesGroupConversationsPage_span_41_Template,3,6,"span",13),b.Dc(),b.Ec(42,"div",16,17),b.nd(44,AddonMessagesGroupConversationsPage_ng_container_44_Template,1,0,"ng-container",18),b.Ec(45,"core-infinite-loading",19),b.Mc("action",(function AddonMessagesGroupConversationsPage_Template_core_infinite_loading_action_45_listener(e){return n.loadMoreConversations(n.favourites,e)})),b.Dc(),b.nd(46,AddonMessagesGroupConversationsPage_ion_item_46_Template,5,3,"ion-item",20),b.Dc(),b.nd(47,AddonMessagesGroupConversationsPage_ion_item_47_Template,4,3,"ion-item",21),b.Ec(48,"ion-item",22),b.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_48_listener(){return n.toggle(n.group)})),b.Pc(49,"translate"),b.zc(50,"ion-icon",15),b.Ec(51,"ion-label"),b.Ec(52,"h2"),b.pd(53),b.Pc(54,"translate"),b.Dc(),b.Dc(),b.nd(55,AddonMessagesGroupConversationsPage_ion_badge_55_Template,2,1,"ion-badge",12),b.nd(56,AddonMessagesGroupConversationsPage_span_56_Template,3,6,"span",13),b.Dc(),b.Ec(57,"div",23,24),b.nd(59,AddonMessagesGroupConversationsPage_ng_container_59_Template,1,0,"ng-container",18),b.Ec(60,"core-infinite-loading",19),b.Mc("action",(function AddonMessagesGroupConversationsPage_Template_core_infinite_loading_action_60_listener(e){return n.loadMoreConversations(n.group,e)})),b.Dc(),b.nd(61,AddonMessagesGroupConversationsPage_ion_item_61_Template,5,3,"ion-item",20),b.Dc(),b.nd(62,AddonMessagesGroupConversationsPage_ion_item_62_Template,4,3,"ion-item",21),b.Ec(63,"ion-item",25),b.Mc("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_63_listener(){return n.toggle(n.individual)})),b.Pc(64,"translate"),b.zc(65,"ion-icon",15),b.Ec(66,"ion-label"),b.Ec(67,"h2"),b.pd(68),b.Pc(69,"translate"),b.Dc(),b.Dc(),b.nd(70,AddonMessagesGroupConversationsPage_ion_badge_70_Template,2,1,"ion-badge",12),b.nd(71,AddonMessagesGroupConversationsPage_span_71_Template,3,6,"span",13),b.Dc(),b.Ec(72,"div",26,27),b.nd(74,AddonMessagesGroupConversationsPage_ng_container_74_Template,1,0,"ng-container",18),b.Ec(75,"core-infinite-loading",19),b.Mc("action",(function AddonMessagesGroupConversationsPage_Template_core_infinite_loading_action_75_listener(e){return n.loadMoreConversations(n.individual,e)})),b.Dc(),b.nd(76,AddonMessagesGroupConversationsPage_ion_item_76_Template,5,3,"ion-item",20),b.Dc(),b.nd(77,AddonMessagesGroupConversationsPage_ion_item_77_Template,4,3,"ion-item",21),b.Dc(),b.Dc(),b.Dc(),b.Dc(),b.nd(78,AddonMessagesGroupConversationsPage_ng_template_78_Template,1,1,"ng-template",null,28,b.od)),2&e){const e=b.ed(79);b.lc(3),b.Vc("text",b.Qc(4,56,"core.back")),b.lc(4),b.qd(b.Qc(8,58,"addon.messages.messages")),b.lc(3),b.mc("aria-label",b.Qc(11,60,"addon.messages.searchcombined")),b.lc(3),b.mc("aria-label",b.Qc(14,62,"addon.messages.messagepreferences")),b.lc(7),b.Vc("disabled",!n.loaded||!n.currentListEl),b.lc(1),b.Wc("pullingText",b.Qc(22,64,"core.pulltorefresh")),b.lc(2),b.Vc("hideUntil",n.loaded)("message",n.loadingMessage),b.lc(6),b.qd(b.Qc(30,66,"addon.messages.contacts")),b.lc(2),b.Vc("ngIf",n.contactRequestsCount>0),b.lc(1),b.Vc("ngIf",n.contactRequestsCount>0),b.lc(1),b.mc("aria-label",b.Qc(34,68,n.favourites.expanded?"core.collapse":"core.expand"))("aria-expanded",n.favourites.expanded),b.lc(2),b.qc("expandable-status-icon-expanded",n.favourites.expanded),b.lc(3),b.sd("",b.Qc(39,70,"core.favourites")," (",n.favourites.count,")"),b.lc(2),b.Vc("ngIf",n.favourites.unread),b.lc(1),b.Vc("ngIf",n.favourites.unread),b.lc(1),b.Vc("hidden",!n.favourites.conversations||!n.favourites.expanded||n.favourites.loading),b.lc(2),b.Vc("ngTemplateOutlet",e)("ngTemplateOutletContext",b.ad(80,_c4,n.favourites.conversations)),b.lc(1),b.Vc("enabled",n.favourites.canLoadMore)("error",n.favourites.loadMoreError),b.lc(1),b.Vc("ngIf",n.favourites.conversations&&0==n.favourites.conversations.length),b.lc(1),b.Vc("ngIf",n.favourites.loading),b.lc(1),b.mc("aria-label",b.Qc(49,72,n.group.expanded?"core.collapse":"core.expand"))("aria-expanded",n.group.expanded),b.lc(2),b.qc("expandable-status-icon-expanded",n.group.expanded),b.lc(3),b.sd("",b.Qc(54,74,"addon.messages.groupconversations")," (",n.group.count,")"),b.lc(2),b.Vc("ngIf",n.group.unread),b.lc(1),b.Vc("ngIf",n.group.unread),b.lc(1),b.Vc("hidden",!n.group.conversations||!n.group.expanded||n.group.loading),b.lc(2),b.Vc("ngTemplateOutlet",e)("ngTemplateOutletContext",b.ad(82,_c4,n.group.conversations)),b.lc(1),b.Vc("enabled",n.group.canLoadMore)("error",n.group.loadMoreError),b.lc(1),b.Vc("ngIf",n.group.conversations&&0==n.group.conversations.length),b.lc(1),b.Vc("ngIf",n.group.loading),b.lc(1),b.mc("aria-label",b.Qc(64,76,n.individual.expanded?"core.collapse":"core.expand"))("aria-expanded",n.individual.expanded),b.lc(2),b.qc("expandable-status-icon-expanded",n.individual.expanded),b.lc(3),b.sd("",b.Qc(69,78,"addon.messages.individualconversations")," (",n.individual.count,")"),b.lc(2),b.Vc("ngIf",n.individual.unread),b.lc(1),b.Vc("ngIf",n.individual.unread),b.lc(1),b.Vc("hidden",!n.individual.conversations||!n.individual.expanded||n.individual.loading),b.lc(2),b.Vc("ngTemplateOutlet",e)("ngTemplateOutletContext",b.ad(84,_c4,n.individual.conversations)),b.lc(1),b.Vc("enabled",n.individual.canLoadMore)("error",n.individual.loadMoreError),b.lc(1),b.Vc("ngIf",n.individual.conversations&&0==n.individual.conversations.length),b.lc(1),b.Vc("ngIf",n.individual.loading)}},directives:[c.C,c.Ab,c.m,c.h,c.i,c.yb,E.a,c.l,c.D,T.a,A.a,x.a,I.a,c.v,O.a,c.bb,c.cb,G.a,c.P,c.I,c.O,D.t,D.A,y.a,c.k,c.qb,D.s,V.a,c.g,k.a,N.a,c.W],pipes:[w.d,S.a],styles:["[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-left:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:2px;margin-inline-start:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-right:2px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:2px;margin-inline-end:2px}}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesGroupConversationsPage})();var q=t("OQOI"),z=t("dQ3M");const j=[{path:"",data:{mainMenuTabRoot:q.b.PAGE_NAME},component:Q},...a.DISCUSSION_ROUTES],F=[{path:"",data:{mainMenuTabRoot:q.b.PAGE_NAME},component:Q,children:a.DISCUSSION_ROUTES}],Y=[...Object(o.c)(j,(()=>i.a.isMobile)),...Object(o.c)(F,(()=>i.a.isTablet))];let $=(()=>{class AddonMessagesGroupConversationsPageModule{}return AddonMessagesGroupConversationsPageModule.ɵmod=b.wc({type:AddonMessagesGroupConversationsPageModule}),AddonMessagesGroupConversationsPageModule.ɵinj=b.vc({factory:function AddonMessagesGroupConversationsPageModule_Factory(e){return new(e||AddonMessagesGroupConversationsPageModule)},imports:[[s.m.forChild(Y),r.a,z.a],s.m]}),AddonMessagesGroupConversationsPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&b.kd($,{declarations:[Q],imports:[s.m,r.a,z.a],exports:[s.m]}))}}]);