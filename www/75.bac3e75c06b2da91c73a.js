(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{hehu:function(t,e,i){"use strict";i.r(e),i.d(e,"AddonModQuizAttemptPageModule",(function(){return Q}));var o=i("tyNb"),d=i("L3Fv"),n=i("mrSG"),a=i("93ts"),c=i("pHTc"),s=i("3LXp"),m=i("bFG1"),r=i("j3ag"),l=i("Ohwm"),p=i("+8pu"),u=i("fXoL"),_=i("TEn/"),h=i("ofXK"),f=i("nt/U"),A=i("PgjG"),z=i("hMzs"),g=i("3jOR"),I=i("ACYt"),b=i("3CSS"),v=i("sYmb");function AddonModQuizAttemptPage_core_format_text_7_Template(t,e){if(1&t&&u.zc(0,"core-format-text",9),2&t){const t=u.Oc();u.Vc("text",t.quiz.name)("contextInstanceId",t.quiz.coursemodule)("courseId",t.courseId)}}function AddonModQuizAttemptPage_ion_list_13_p_6_Template(t,e){1&t&&(u.Ec(0,"p"),u.pd(1),u.Pc(2,"translate"),u.Dc()),2&t&&(u.lc(1),u.qd(u.Qc(2,1,"addon.mod_quiz.preview")))}function AddonModQuizAttemptPage_ion_list_13_p_7_Template(t,e){if(1&t&&(u.Ec(0,"p"),u.pd(1),u.Dc()),2&t){const t=u.Oc(2);u.lc(1),u.qd(t.attempt.attempt)}}function AddonModQuizAttemptPage_ion_list_13_p_13_Template(t,e){if(1&t&&(u.Ec(0,"p"),u.pd(1),u.Dc()),2&t){const t=e.$implicit;u.lc(1),u.qd(t)}}function AddonModQuizAttemptPage_ion_list_13_ion_item_14_Template(t,e){if(1&t&&(u.Ec(0,"ion-item",10),u.Ec(1,"ion-label"),u.Ec(2,"p",11),u.pd(3),u.Pc(4,"translate"),u.Dc(),u.Ec(5,"p"),u.pd(6),u.Dc(),u.Dc(),u.Dc()),2&t){const t=u.Oc(2);u.lc(3),u.sd("",u.Qc(4,3,"addon.mod_quiz.marks")," / ",t.quiz.sumGradesFormatted,""),u.lc(3),u.qd(t.attempt.readableMark)}}function AddonModQuizAttemptPage_ion_list_13_ion_item_15_Template(t,e){if(1&t&&(u.Ec(0,"ion-item",10),u.Ec(1,"ion-label"),u.Ec(2,"p",11),u.pd(3),u.Pc(4,"translate"),u.Dc(),u.Ec(5,"p"),u.pd(6),u.Dc(),u.Dc(),u.Dc()),2&t){const t=u.Oc(2);u.lc(3),u.sd("",u.Qc(4,3,"addon.mod_quiz.grade")," / ",t.quiz.gradeFormatted,""),u.lc(3),u.qd(t.attempt.readableGrade)}}function AddonModQuizAttemptPage_ion_list_13_ion_item_16_Template(t,e){if(1&t&&(u.Ec(0,"ion-item",10),u.Ec(1,"ion-label"),u.Ec(2,"p",11),u.pd(3),u.Pc(4,"translate"),u.Dc(),u.Ec(5,"p"),u.zc(6,"core-format-text",15),u.Dc(),u.Dc(),u.Dc()),2&t){const t=u.Oc(2);u.lc(3),u.qd(u.Qc(4,6,"addon.mod_quiz.feedback")),u.lc(3),u.Vc("component",t.component)("componentId",t.componentId)("text",t.feedback)("contextInstanceId",t.cmId)("courseId",t.courseId)}}function AddonModQuizAttemptPage_ion_list_13_ion_item_17_Template(t,e){1&t&&(u.Ec(0,"ion-item",16),u.Ec(1,"ion-label"),u.Ec(2,"p"),u.pd(3),u.Pc(4,"translate"),u.Dc(),u.Dc(),u.Dc()),2&t&&(u.lc(3),u.qd(u.Qc(4,1,"addon.mod_quiz.noreviewattempt")))}function AddonModQuizAttemptPage_ion_list_13_Template(t,e){if(1&t&&(u.Ec(0,"ion-list"),u.Ec(1,"ion-item",10),u.Ec(2,"ion-label"),u.Ec(3,"p",11),u.pd(4),u.Pc(5,"translate"),u.Dc(),u.nd(6,AddonModQuizAttemptPage_ion_list_13_p_6_Template,3,3,"p",7),u.nd(7,AddonModQuizAttemptPage_ion_list_13_p_7_Template,2,1,"p",7),u.Dc(),u.Dc(),u.Ec(8,"ion-item",10),u.Ec(9,"ion-label"),u.Ec(10,"p",11),u.pd(11),u.Pc(12,"translate"),u.Dc(),u.nd(13,AddonModQuizAttemptPage_ion_list_13_p_13_Template,2,1,"p",12),u.Dc(),u.Dc(),u.nd(14,AddonModQuizAttemptPage_ion_list_13_ion_item_14_Template,7,5,"ion-item",13),u.nd(15,AddonModQuizAttemptPage_ion_list_13_ion_item_15_Template,7,5,"ion-item",13),u.nd(16,AddonModQuizAttemptPage_ion_list_13_ion_item_16_Template,7,8,"ion-item",13),u.nd(17,AddonModQuizAttemptPage_ion_list_13_ion_item_17_Template,5,3,"ion-item",14),u.Dc()),2&t){const t=u.Oc();u.lc(4),u.qd(u.Qc(5,9,"addon.mod_quiz.attemptnumber")),u.lc(2),u.Vc("ngIf",t.attempt.preview),u.lc(1),u.Vc("ngIf",!t.attempt.preview),u.lc(4),u.qd(u.Qc(12,11,"addon.mod_quiz.attemptstate")),u.lc(2),u.Vc("ngForOf",t.attempt.readableState),u.lc(1),u.Vc("ngIf",t.quiz.showMarkColumn&&""!==t.attempt.readableMark),u.lc(1),u.Vc("ngIf",t.quiz.showGradeColumn&&""!==t.attempt.readableGrade),u.lc(1),u.Vc("ngIf",t.quiz.showFeedbackColumn&&t.feedback),u.lc(1),u.Vc("ngIf",!t.showReviewColumn)}}function AddonModQuizAttemptPage_div_14_Template(t,e){if(1&t){const t=u.Fc();u.Ec(0,"div",17),u.Ec(1,"div",18),u.Ec(2,"ion-button",19),u.Mc("click",(function AddonModQuizAttemptPage_div_14_Template_ion_button_click_2_listener(){u.fd(t);return u.Oc().reviewAttempt()})),u.zc(3,"ion-icon",20),u.pd(4),u.Pc(5,"translate"),u.Dc(),u.Dc(),u.Dc()}2&t&&(u.lc(4),u.rd(" ",u.Qc(5,1,"addon.mod_quiz.review")," "))}let M=(()=>{class AddonModQuizAttemptPage{constructor(){this.component=l.b.COMPONENT,this.loaded=!1,this.showReviewColumn=!1}ngOnInit(){try{this.cmId=c.a.getRequiredRouteNumberParam("cmId"),this.courseId=c.a.getRequiredRouteNumberParam("courseId"),this.attemptId=c.a.getRequiredRouteNumberParam("attemptId")}catch(t){return s.a.showErrorModal(t),c.a.back(),void 0}this.fetchQuizData().finally((()=>{this.loaded=!0}))}doRefresh(t){this.refreshData().finally((()=>{t.complete()}))}fetchQuizData(){return Object(n.a)(this,void 0,void 0,(function*(){try{this.quiz=yield l.a.getQuiz(this.courseId,this.cmId),this.componentId=this.quiz.coursemodule;const[t,e,i]=yield Promise.all([l.a.getCombinedReviewOptions(this.quiz.id,{cmId:this.quiz.coursemodule}),this.fetchAccessInfo(),this.fetchAttempt()]);this.showReviewColumn=e.canreviewmyattempts,p.a.setQuizCalculatedData(this.quiz,t),this.attempt=yield p.a.setAttemptCalculatedData(this.quiz,i,!1,void 0,!0);const o=Number(this.attempt.rescaledGrade);if(this.quiz.showFeedbackColumn&&l.a.isAttemptFinished(this.attempt.state)&&t.someoptions.overallfeedback&&!isNaN(o)){const t=yield l.a.getFeedbackForGrade(this.quiz.id,o,{cmId:this.quiz.coursemodule});this.feedback=t.feedbacktext}else delete this.feedback}catch(t){s.a.showErrorModalDefault(t,"addon.mod_quiz.errorgetattempt",!0)}}))}fetchAttempt(){return Object(n.a)(this,void 0,void 0,(function*(){const t=(yield l.a.getUserAttempts(this.quiz.id,{cmId:this.cmId})).find((t=>t.id==this.attemptId));if(!t)throw this.attempt=void 0,new a.a(r.I.instant("addon.mod_quiz.errorgetattempt"));return t}))}fetchAccessInfo(){return Object(n.a)(this,void 0,void 0,(function*(){const t=yield l.a.getQuizAccessInformation(this.quiz.id,{cmId:this.cmId});if(!t.canreviewmyattempts)return t;yield m.a.ignoreErrors(l.a.invalidateAttemptReviewForPage(this.attemptId,-1));try{yield l.a.getAttemptReview(this.attemptId,{page:-1,cmId:this.quiz.coursemodule})}catch(e){t.canreviewmyattempts=!1}return t}))}refreshData(){return Object(n.a)(this,void 0,void 0,(function*(){const t=[];t.push(l.a.invalidateQuizData(this.courseId)),t.push(l.a.invalidateAttemptReview(this.attemptId)),this.quiz&&(t.push(l.a.invalidateUserAttemptsForUser(this.quiz.id)),t.push(l.a.invalidateQuizAccessInformation(this.quiz.id)),t.push(l.a.invalidateCombinedReviewOptionsForUser(this.quiz.id)),this.attempt&&void 0!==this.feedback&&t.push(l.a.invalidateFeedback(this.quiz.id))),yield m.a.ignoreErrors(Promise.all(t)),yield this.fetchQuizData()}))}reviewAttempt(){return Object(n.a)(this,void 0,void 0,(function*(){c.a.navigate(`../../review/${this.attempt.id}`)}))}}return AddonModQuizAttemptPage.ɵfac=function AddonModQuizAttemptPage_Factory(t){return new(t||AddonModQuizAttemptPage)},AddonModQuizAttemptPage.ɵcmp=u.sc({type:AddonModQuizAttemptPage,selectors:[["page-addon-mod-quiz-attempt"]],decls:15,vars:11,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId",4,"ngIf"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId"],[1,"ion-text-wrap"],[1,"item-heading"],[4,"ngFor","ngForOf"],["class","ion-text-wrap",4,"ngIf"],["class","ion-text-wrap core-danger-item",4,"ngIf"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[1,"ion-text-wrap","core-danger-item"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"list-item-limited-width"],["expand","block",1,"ion-margin","ion-text-wrap",3,"click"],["name","fas-search","slot","start","aria-hidden","true"]],template:function AddonModQuizAttemptPage_Template(t,e){1&t&&(u.Ec(0,"ion-header"),u.Ec(1,"ion-toolbar"),u.Ec(2,"ion-buttons",0),u.zc(3,"ion-back-button",1),u.Pc(4,"translate"),u.Dc(),u.Ec(5,"ion-title"),u.Ec(6,"h1"),u.nd(7,AddonModQuizAttemptPage_core_format_text_7_Template,1,3,"core-format-text",2),u.Dc(),u.Dc(),u.Dc(),u.Dc(),u.Ec(8,"ion-content",3),u.Ec(9,"ion-refresher",4),u.Mc("ionRefresh",(function AddonModQuizAttemptPage_Template_ion_refresher_ionRefresh_9_listener(t){return e.doRefresh(t.target)})),u.zc(10,"ion-refresher-content",5),u.Pc(11,"translate"),u.Dc(),u.Ec(12,"core-loading",6),u.nd(13,AddonModQuizAttemptPage_ion_list_13_Template,18,13,"ion-list",7),u.nd(14,AddonModQuizAttemptPage_div_14_Template,6,3,"div",8),u.Dc(),u.Dc()),2&t&&(u.lc(3),u.Vc("text",u.Qc(4,7,"core.back")),u.lc(4),u.Vc("ngIf",e.quiz),u.lc(2),u.Vc("disabled",!e.loaded),u.lc(1),u.Wc("pullingText",u.Qc(11,9,"core.pulltorefresh")),u.lc(2),u.Vc("hideUntil",e.loaded),u.lc(1),u.Vc("ngIf",e.attempt),u.lc(1),u.Vc("ngIf",e.loaded&&e.attempt&&e.showReviewColumn&&e.attempt.finished))},directives:[_.C,_.Ab,_.m,_.h,_.i,_.yb,h.t,f.a,_.v,_.bb,_.cb,A.a,z.a,_.P,_.I,_.O,h.s,g.a,I.a,_.l,_.D,b.a],pipes:[v.d],encapsulation:2}),AddonModQuizAttemptPage})();const P=[{path:"",component:M}];let Q=(()=>{class AddonModQuizAttemptPageModule{}return AddonModQuizAttemptPageModule.ɵmod=u.wc({type:AddonModQuizAttemptPageModule}),AddonModQuizAttemptPageModule.ɵinj=u.vc({factory:function AddonModQuizAttemptPageModule_Factory(t){return new(t||AddonModQuizAttemptPageModule)},imports:[[o.m.forChild(P),d.a],o.m]}),AddonModQuizAttemptPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&u.kd(Q,{declarations:[M],imports:[o.m,d.a],exports:[o.m]}))}}]);